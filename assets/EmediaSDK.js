/*! For license information please see EmediaSDK.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.EmediaSDK=t():e.EmediaSDK=t()}(self,(function(){return(()=>{var e={3133:(e,t,n)=>{e.exports=n(7185)},4422:(e,t,n)=>{e.exports=n(3285)},3029:(e,t,n)=>{e.exports=n(4779)},4720:(e,t,n)=>{e.exports=n(2742)},6406:(e,t,n)=>{e.exports=n(6981)},200:(e,t,n)=>{e.exports=n(5627)},8548:(e,t,n)=>{e.exports=n(3391)},4100:(e,t,n)=>{e.exports=n(381)},3929:(e,t,n)=>{e.exports=n(8613)},4255:(e,t,n)=>{e.exports=n(433)},9204:(e,t,n)=>{e.exports=n(1955)},4504:(e,t,n)=>{e.exports=n(7794)},5682:(e,t,n)=>{e.exports=n(112)},3497:(e,t,n)=>{e.exports=n(8318)},7219:(e,t,n)=>{e.exports=n(25)},7544:(e,t,n)=>{e.exports=n(2392)},490:(e,t,n)=>{e.exports=n(5666)},6754:()=>{window.emedia={}},7185:(e,t,n)=>{n(1867),n(2586),e.exports=n(4579).Array.from},3285:(e,t,n)=>{n(8691),e.exports=n(4579).Array.isArray},4779:(e,t,n)=>{n(961),e.exports=n(4579).Date.now},2742:(e,t,n)=>{var r=n(4579),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},6981:(e,t,n)=>{n(2699),e.exports=n(4579).Object.assign},5627:(e,t,n)=>{n(6760);var r=n(4579).Object;e.exports=function(e,t){return r.create(e,t)}},3391:(e,t,n)=>{n(1477);var r=n(4579).Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},381:(e,t,n)=>{n(7220),e.exports=n(4579).Object.getPrototypeOf},8613:(e,t,n)=>{n(6203),e.exports=n(4579).Object.keys},433:(e,t,n)=>{n(9349),e.exports=n(4579).Object.setPrototypeOf},1955:(e,t,n)=>{n(3136),e.exports=n(4579).parseFloat},7794:(e,t,n)=>{n(7609),e.exports=n(4579).parseInt},112:(e,t,n)=>{n(4058),n(1867),n(3871),n(2878),n(5971),n(2526),e.exports=n(4579).Promise},8318:(e,t,n)=>{n(9650),e.exports=n(4579).Reflect.construct},25:(e,t,n)=>{n(6840),n(4058),n(8174),n(6461),e.exports=n(4579).Symbol},2392:(e,t,n)=>{n(1867),n(3871),e.exports=n(5103).f("iterator")},5663:e=>{e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},9003:e=>{e.exports=function(){}},9142:e=>{e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},2159:(e,t,n)=>{var r=n(6727);e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},7428:(e,t,n)=>{var r=n(7932),i=n(8728),o=n(6531);e.exports=function(e){return function(t,n,s){var a,c=r(t),u=i(c.length),d=o(s,u);if(e&&n!=n){for(;u>d;)if((a=c[d++])!=a)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}}},4094:(e,t,n)=>{"use strict";var r=n(5663),i=n(6727),o=n(6778),s=[].slice,a={},c=function(e,t,n){if(!(t in a)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";a[t]=Function("F,a","return new F("+r.join(",")+")")}return a[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=s.call(arguments,1),a=function(){var r=n.concat(s.call(arguments));return this instanceof a?c(t,r.length,r):o(t,r,e)};return i(t.prototype)&&(a.prototype=t.prototype),a}},4677:(e,t,n)=>{var r=n(2894),i=n(2939)("toStringTag"),o="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?n:o?r(t):"Object"==(s=r(t))&&"function"==typeof t.callee?"Arguments":s}},2894:e=>{var t={}.toString;e.exports=function(e){return t.call(e).slice(8,-1)}},4579:e=>{var t=e.exports={version:"2.6.12"};"number"==typeof __e&&(__e=t)},2445:(e,t,n)=>{"use strict";var r=n(4743),i=n(3101);e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},9216:(e,t,n)=>{var r=n(5663);e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},8333:e=>{e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},9666:(e,t,n)=>{e.exports=!n(7929)((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},7467:(e,t,n)=>{var r=n(6727),i=n(3938).document,o=r(i)&&r(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},3338:e=>{e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},337:(e,t,n)=>{var r=n(6162),i=n(8195),o=n(6274);e.exports=function(e){var t=r(e),n=i.f;if(n)for(var s,a=n(e),c=o.f,u=0;a.length>u;)c.call(e,s=a[u++])&&t.push(s);return t}},3856:(e,t,n)=>{var r=n(3938),i=n(4579),o=n(9216),s=n(1818),a=n(7069),c=function(e,t,n){var u,d,l,f=e&c.F,p=e&c.G,h=e&c.S,m=e&c.P,v=e&c.B,_=e&c.W,g=p?i:i[t]||(i[t]={}),y=g.prototype,b=p?r:h?r[t]:(r[t]||{}).prototype;for(u in p&&(n=t),n)(d=!f&&b&&void 0!==b[u])&&a(g,u)||(l=d?b[u]:n[u],g[u]=p&&"function"!=typeof b[u]?n[u]:v&&d?o(l,r):_&&b[u]==l?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(l):m&&"function"==typeof l?o(Function.call,l):l,m&&((g.virtual||(g.virtual={}))[u]=l,e&c.R&&y&&!y[u]&&s(y,u,l)))};c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,e.exports=c},7929:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},5576:(e,t,n)=>{var r=n(9216),i=n(5602),o=n(5991),s=n(2159),a=n(8728),c=n(3728),u={},d={},l=e.exports=function(e,t,n,l,f){var p,h,m,v,_=f?function(){return e}:c(e),g=r(n,l,t?2:1),y=0;if("function"!=typeof _)throw TypeError(e+" is not iterable!");if(o(_)){for(p=a(e.length);p>y;y++)if((v=t?g(s(h=e[y])[0],h[1]):g(e[y]))===u||v===d)return v}else for(m=_.call(e);!(h=m.next()).done;)if((v=i(m,g,h.value,t))===u||v===d)return v};l.BREAK=u,l.RETURN=d},3938:e=>{var t=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=t)},7069:e=>{var t={}.hasOwnProperty;e.exports=function(e,n){return t.call(e,n)}},1818:(e,t,n)=>{var r=n(4743),i=n(3101);e.exports=n(9666)?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},4881:(e,t,n)=>{var r=n(3938).document;e.exports=r&&r.documentElement},3758:(e,t,n)=>{e.exports=!n(9666)&&!n(7929)((function(){return 7!=Object.defineProperty(n(7467)("div"),"a",{get:function(){return 7}}).a}))},6778:e=>{e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},799:(e,t,n)=>{var r=n(2894);e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},5991:(e,t,n)=>{var r=n(5449),i=n(2939)("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[i]===e)}},1421:(e,t,n)=>{var r=n(2894);e.exports=Array.isArray||function(e){return"Array"==r(e)}},6727:e=>{e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},5602:(e,t,n)=>{var r=n(2159);e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(t){var o=e.return;throw void 0!==o&&r(o.call(e)),t}}},3945:(e,t,n)=>{"use strict";var r=n(526),i=n(3101),o=n(5378),s={};n(1818)(s,n(2939)("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(s,{next:i(1,n)}),o(e,t+" Iterator")}},5700:(e,t,n)=>{"use strict";var r=n(6227),i=n(3856),o=n(7470),s=n(1818),a=n(5449),c=n(3945),u=n(5378),d=n(5089),l=n(2939)("iterator"),f=!([].keys&&"next"in[].keys()),p="keys",h="values",m=function(){return this};e.exports=function(e,t,n,v,_,g,y){c(n,t,v);var b,S,C,w=function(e){if(!f&&e in R)return R[e];switch(e){case p:case h:return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",I=_==h,x=!1,R=e.prototype,M=R[l]||R["@@iterator"]||_&&R[_],T=M||w(_),E=_?I?w("entries"):T:void 0,P="Array"==t&&R.entries||M;if(P&&(C=d(P.call(new e)))!==Object.prototype&&C.next&&(u(C,k,!0),r||"function"==typeof C[l]||s(C,l,m)),I&&M&&M.name!==h&&(x=!0,T=function(){return M.call(this)}),r&&!y||!f&&!x&&R[l]||s(R,l,T),a[t]=T,a[k]=m,_)if(b={values:I?T:w(h),keys:g?T:w(p),entries:E},y)for(S in b)S in R||o(R,S,b[S]);else i(i.P+i.F*(f||x),t,b);return b}},6630:(e,t,n)=>{var r=n(2939)("iterator"),i=!1;try{var o=[7][r]();o.return=function(){i=!0},Array.from(o,(function(){throw 2}))}catch(e){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var o=[7],s=o[r]();s.next=function(){return{done:n=!0}},o[r]=function(){return s},e(o)}catch(e){}return n}},5084:e=>{e.exports=function(e,t){return{value:t,done:!!e}}},5449:e=>{e.exports={}},6227:e=>{e.exports=!0},7177:(e,t,n)=>{var r=n(5730)("meta"),i=n(6727),o=n(7069),s=n(4743).f,a=0,c=Object.isExtensible||function(){return!0},u=!n(7929)((function(){return c(Object.preventExtensions({}))})),d=function(e){s(e,r,{value:{i:"O"+ ++a,w:{}}})},l=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!o(e,r)){if(!c(e))return"F";if(!t)return"E";d(e)}return e[r].i},getWeak:function(e,t){if(!o(e,r)){if(!c(e))return!0;if(!t)return!1;d(e)}return e[r].w},onFreeze:function(e){return u&&l.NEED&&c(e)&&!o(e,r)&&d(e),e}}},1601:(e,t,n)=>{var r=n(3938),i=n(2569).set,o=r.MutationObserver||r.WebKitMutationObserver,s=r.process,a=r.Promise,c="process"==n(2894)(s);e.exports=function(){var e,t,n,u=function(){var r,i;for(c&&(r=s.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(r){throw e?n():t=void 0,r}}t=void 0,r&&r.enter()};if(c)n=function(){s.nextTick(u)};else if(!o||r.navigator&&r.navigator.standalone)if(a&&a.resolve){var d=a.resolve(void 0);n=function(){d.then(u)}}else n=function(){i.call(r,u)};else{var l=!0,f=document.createTextNode("");new o(u).observe(f,{characterData:!0}),n=function(){f.data=l=!l}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},9304:(e,t,n)=>{"use strict";var r=n(5663);function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},8082:(e,t,n)=>{"use strict";var r=n(9666),i=n(6162),o=n(8195),s=n(6274),a=n(6530),c=n(799),u=Object.assign;e.exports=!u||n(7929)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r}))?function(e,t){for(var n=a(e),u=arguments.length,d=1,l=o.f,f=s.f;u>d;)for(var p,h=c(arguments[d++]),m=l?i(h).concat(l(h)):i(h),v=m.length,_=0;v>_;)p=m[_++],r&&!f.call(h,p)||(n[p]=h[p]);return n}:u},526:(e,t,n)=>{var r=n(2159),i=n(7856),o=n(3338),s=n(8989)("IE_PROTO"),a=function(){},c=function(){var e,t=n(7467)("iframe"),r=o.length;for(t.style.display="none",n(4881).appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),c=e.F;r--;)delete c.prototype[o[r]];return c()};e.exports=Object.create||function(e,t){var n;return null!==e?(a.prototype=r(e),n=new a,a.prototype=null,n[s]=e):n=c(),void 0===t?n:i(n,t)}},4743:(e,t,n)=>{var r=n(2159),i=n(3758),o=n(3206),s=Object.defineProperty;t.f=n(9666)?Object.defineProperty:function(e,t,n){if(r(e),t=o(t,!0),r(n),i)try{return s(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},7856:(e,t,n)=>{var r=n(4743),i=n(2159),o=n(6162);e.exports=n(9666)?Object.defineProperties:function(e,t){i(e);for(var n,s=o(t),a=s.length,c=0;a>c;)r.f(e,n=s[c++],t[n]);return e}},6183:(e,t,n)=>{var r=n(6274),i=n(3101),o=n(7932),s=n(3206),a=n(7069),c=n(3758),u=Object.getOwnPropertyDescriptor;t.f=n(9666)?u:function(e,t){if(e=o(e),t=s(t,!0),c)try{return u(e,t)}catch(e){}if(a(e,t))return i(!r.f.call(e,t),e[t])}},4368:(e,t,n)=>{var r=n(7932),i=n(3230).f,o={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return s&&"[object Window]"==o.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(r(e))}},3230:(e,t,n)=>{var r=n(2963),i=n(3338).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},8195:(e,t)=>{t.f=Object.getOwnPropertySymbols},5089:(e,t,n)=>{var r=n(7069),i=n(6530),o=n(8989)("IE_PROTO"),s=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,o)?e[o]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},2963:(e,t,n)=>{var r=n(7069),i=n(7932),o=n(7428)(!1),s=n(8989)("IE_PROTO");e.exports=function(e,t){var n,a=i(e),c=0,u=[];for(n in a)n!=s&&r(a,n)&&u.push(n);for(;t.length>c;)r(a,n=t[c++])&&(~o(u,n)||u.push(n));return u}},6162:(e,t,n)=>{var r=n(2963),i=n(3338);e.exports=Object.keys||function(e){return r(e,i)}},6274:(e,t)=>{t.f={}.propertyIsEnumerable},2584:(e,t,n)=>{var r=n(3856),i=n(4579),o=n(7929);e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],s={};s[e]=t(n),r(r.S+r.F*o((function(){n(1)})),"Object",s)}},9592:(e,t,n)=>{var r=n(3938).parseFloat,i=n(2422).trim;e.exports=1/r(n(9617)+"-0")!=-1/0?function(e){var t=i(String(e),3),n=r(t);return 0===n&&"-"==t.charAt(0)?-0:n}:r},9115:(e,t,n)=>{var r=n(3938).parseInt,i=n(2422).trim,o=n(9617),s=/^[-+]?0[xX]/;e.exports=8!==r(o+"08")||22!==r(o+"0x16")?function(e,t){var n=i(String(e),3);return r(n,t>>>0||(s.test(n)?16:10))}:r},931:e=>{e.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},7790:(e,t,n)=>{var r=n(2159),i=n(6727),o=n(9304);e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=o.f(e);return(0,n.resolve)(t),n.promise}},3101:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},8144:(e,t,n)=>{var r=n(1818);e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},7470:(e,t,n)=>{e.exports=n(1818)},2906:(e,t,n)=>{var r=n(6727),i=n(2159),o=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n(9216)(Function.call,n(6183).f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(e){t=!0}return function(e,n){return o(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:o}},9967:(e,t,n)=>{"use strict";var r=n(3938),i=n(4579),o=n(4743),s=n(9666),a=n(2939)("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];s&&t&&!t[a]&&o.f(t,a,{configurable:!0,get:function(){return this}})}},5378:(e,t,n)=>{var r=n(4743).f,i=n(7069),o=n(2939)("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,o)&&r(e,o,{configurable:!0,value:t})}},8989:(e,t,n)=>{var r=n(250)("keys"),i=n(5730);e.exports=function(e){return r[e]||(r[e]=i(e))}},250:(e,t,n)=>{var r=n(4579),i=n(3938),o="__core-js_shared__",s=i[o]||(i[o]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n(6227)?"pure":"global",copyright:"© 2020 Denis Pushkarev (zloirock.ru)"})},2707:(e,t,n)=>{var r=n(2159),i=n(5663),o=n(2939)("species");e.exports=function(e,t){var n,s=r(e).constructor;return void 0===s||null==(n=r(s)[o])?t:i(n)}},510:(e,t,n)=>{var r=n(1052),i=n(8333);e.exports=function(e){return function(t,n){var o,s,a=String(i(t)),c=r(n),u=a.length;return c<0||c>=u?e?"":void 0:(o=a.charCodeAt(c))<55296||o>56319||c+1===u||(s=a.charCodeAt(c+1))<56320||s>57343?e?a.charAt(c):o:e?a.slice(c,c+2):s-56320+(o-55296<<10)+65536}}},2422:(e,t,n)=>{var r=n(3856),i=n(8333),o=n(7929),s=n(9617),a="["+s+"]",c=RegExp("^"+a+a+"*"),u=RegExp(a+a+"*$"),d=function(e,t,n){var i={},a=o((function(){return!!s[e]()||"​"!="​"[e]()})),c=i[e]=a?t(l):s[e];n&&(i[n]=c),r(r.P+r.F*a,"String",i)},l=d.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=d},9617:e=>{e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},2569:(e,t,n)=>{var r,i,o,s=n(9216),a=n(6778),c=n(4881),u=n(7467),d=n(3938),l=d.process,f=d.setImmediate,p=d.clearImmediate,h=d.MessageChannel,m=d.Dispatch,v=0,_={},g=function(){var e=+this;if(_.hasOwnProperty(e)){var t=_[e];delete _[e],t()}},y=function(e){g.call(e.data)};f&&p||(f=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return _[++v]=function(){a("function"==typeof e?e:Function(e),t)},r(v),v},p=function(e){delete _[e]},"process"==n(2894)(l)?r=function(e){l.nextTick(s(g,e,1))}:m&&m.now?r=function(e){m.now(s(g,e,1))}:h?(o=(i=new h).port2,i.port1.onmessage=y,r=s(o.postMessage,o,1)):d.addEventListener&&"function"==typeof postMessage&&!d.importScripts?(r=function(e){d.postMessage(e+"","*")},d.addEventListener("message",y,!1)):r="onreadystatechange"in u("script")?function(e){c.appendChild(u("script")).onreadystatechange=function(){c.removeChild(this),g.call(e)}}:function(e){setTimeout(s(g,e,1),0)}),e.exports={set:f,clear:p}},6531:(e,t,n)=>{var r=n(1052),i=Math.max,o=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):o(e,t)}},1052:e=>{var t=Math.ceil,n=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?n:t)(e)}},7932:(e,t,n)=>{var r=n(799),i=n(8333);e.exports=function(e){return r(i(e))}},8728:(e,t,n)=>{var r=n(1052),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},6530:(e,t,n)=>{var r=n(8333);e.exports=function(e){return Object(r(e))}},3206:(e,t,n)=>{var r=n(6727);e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},5730:e=>{var t=0,n=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++t+n).toString(36))}},6640:(e,t,n)=>{var r=n(3938).navigator;e.exports=r&&r.userAgent||""},6347:(e,t,n)=>{var r=n(3938),i=n(4579),o=n(6227),s=n(5103),a=n(4743).f;e.exports=function(e){var t=i.Symbol||(i.Symbol=o?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||a(t,e,{value:s.f(e)})}},5103:(e,t,n)=>{t.f=n(2939)},2939:(e,t,n)=>{var r=n(250)("wks"),i=n(5730),o=n(3938).Symbol,s="function"==typeof o;(e.exports=function(e){return r[e]||(r[e]=s&&o[e]||(s?o:i)("Symbol."+e))}).store=r},3728:(e,t,n)=>{var r=n(4677),i=n(2939)("iterator"),o=n(5449);e.exports=n(4579).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||o[r(e)]}},2586:(e,t,n)=>{"use strict";var r=n(9216),i=n(3856),o=n(6530),s=n(5602),a=n(5991),c=n(8728),u=n(2445),d=n(3728);i(i.S+i.F*!n(6630)((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,l,f=o(e),p="function"==typeof this?this:Array,h=arguments.length,m=h>1?arguments[1]:void 0,v=void 0!==m,_=0,g=d(f);if(v&&(m=r(m,h>2?arguments[2]:void 0,2)),null==g||p==Array&&a(g))for(n=new p(t=c(f.length));t>_;_++)u(n,_,v?m(f[_],_):f[_]);else for(l=g.call(f),n=new p;!(i=l.next()).done;_++)u(n,_,v?s(l,m,[i.value,_],!0):i.value);return n.length=_,n}})},8691:(e,t,n)=>{var r=n(3856);r(r.S,"Array",{isArray:n(1421)})},3882:(e,t,n)=>{"use strict";var r=n(9003),i=n(5084),o=n(5449),s=n(7932);e.exports=n(5700)(Array,"Array",(function(e,t){this._t=s(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),o.Arguments=o.Array,r("keys"),r("values"),r("entries")},961:(e,t,n)=>{var r=n(3856);r(r.S,"Date",{now:function(){return(new Date).getTime()}})},2699:(e,t,n)=>{var r=n(3856);r(r.S+r.F,"Object",{assign:n(8082)})},6760:(e,t,n)=>{var r=n(3856);r(r.S,"Object",{create:n(526)})},1477:(e,t,n)=>{var r=n(3856);r(r.S+r.F*!n(9666),"Object",{defineProperty:n(4743).f})},7220:(e,t,n)=>{var r=n(6530),i=n(5089);n(2584)("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},6203:(e,t,n)=>{var r=n(6530),i=n(6162);n(2584)("keys",(function(){return function(e){return i(r(e))}}))},9349:(e,t,n)=>{var r=n(3856);r(r.S,"Object",{setPrototypeOf:n(2906).set})},4058:()=>{},3136:(e,t,n)=>{var r=n(3856),i=n(9592);r(r.G+r.F*(parseFloat!=i),{parseFloat:i})},7609:(e,t,n)=>{var r=n(3856),i=n(9115);r(r.G+r.F*(parseInt!=i),{parseInt:i})},2878:(e,t,n)=>{"use strict";var r,i,o,s,a=n(6227),c=n(3938),u=n(9216),d=n(4677),l=n(3856),f=n(6727),p=n(5663),h=n(9142),m=n(5576),v=n(2707),_=n(2569).set,g=n(1601)(),y=n(9304),b=n(931),S=n(6640),C=n(7790),w="Promise",k=c.TypeError,I=c.process,x=I&&I.versions,R=x&&x.v8||"",M=c.Promise,T="process"==d(I),E=function(){},P=i=y.f,A=!!function(){try{var e=M.resolve(1),t=(e.constructor={})[n(2939)("species")]=function(e){e(E,E)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(E)instanceof t&&0!==R.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(e){}}(),O=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},j=function(e,t){if(!e._n){e._n=!0;var n=e._c;g((function(){for(var r=e._v,i=1==e._s,o=0,s=function(t){var n,o,s,a=i?t.ok:t.fail,c=t.resolve,u=t.reject,d=t.domain;try{a?(i||(2==e._h&&V(e),e._h=1),!0===a?n=r:(d&&d.enter(),n=a(r),d&&(d.exit(),s=!0)),n===t.promise?u(k("Promise-chain cycle")):(o=O(n))?o.call(n,c,u):c(n)):u(r)}catch(e){d&&!s&&d.exit(),u(e)}};n.length>o;)s(n[o++]);e._c=[],e._n=!1,t&&!e._h&&L(e)}))}},L=function(e){_.call(c,(function(){var t,n,r,i=e._v,o=D(e);if(o&&(t=b((function(){T?I.emit("unhandledRejection",i,e):(n=c.onunhandledrejection)?n({promise:e,reason:i}):(r=c.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=T||D(e)?2:1),e._a=void 0,o&&t.e)throw t.v}))},D=function(e){return 1!==e._h&&0===(e._a||e._c).length},V=function(e){_.call(c,(function(){var t;T?I.emit("rejectionHandled",e):(t=c.onrejectionhandled)&&t({promise:e,reason:e._v})}))},F=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),j(t,!0))},N=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw k("Promise can't be resolved itself");(t=O(e))?g((function(){var r={_w:n,_d:!1};try{t.call(e,u(N,r,1),u(F,r,1))}catch(e){F.call(r,e)}})):(n._v=e,n._s=1,j(n,!1))}catch(e){F.call({_w:n,_d:!1},e)}}};A||(M=function(e){h(this,M,w,"_h"),p(e),r.call(this);try{e(u(N,this,1),u(F,this,1))}catch(e){F.call(this,e)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n(8144)(M.prototype,{then:function(e,t){var n=P(v(this,M));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?I.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&j(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),o=function(){var e=new r;this.promise=e,this.resolve=u(N,e,1),this.reject=u(F,e,1)},y.f=P=function(e){return e===M||e===s?new o(e):i(e)}),l(l.G+l.W+l.F*!A,{Promise:M}),n(5378)(M,w),n(9967)(w),s=n(4579).Promise,l(l.S+l.F*!A,w,{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),l(l.S+l.F*(a||!A),w,{resolve:function(e){return C(a&&this===s?M:this,e)}}),l(l.S+l.F*!(A&&n(6630)((function(e){M.all(e).catch(E)}))),w,{all:function(e){var t=this,n=P(t),r=n.resolve,i=n.reject,o=b((function(){var n=[],o=0,s=1;m(e,!1,(function(e){var a=o++,c=!1;n.push(void 0),s++,t.resolve(e).then((function(e){c||(c=!0,n[a]=e,--s||r(n))}),i)})),--s||r(n)}));return o.e&&i(o.v),n.promise},race:function(e){var t=this,n=P(t),r=n.reject,i=b((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},9650:(e,t,n)=>{var r=n(3856),i=n(526),o=n(5663),s=n(2159),a=n(6727),c=n(7929),u=n(4094),d=(n(3938).Reflect||{}).construct,l=c((function(){function e(){}return!(d((function(){}),[],e)instanceof e)})),f=!c((function(){d((function(){}))}));r(r.S+r.F*(l||f),"Reflect",{construct:function(e,t){o(e),s(t);var n=arguments.length<3?e:o(arguments[2]);if(f&&!l)return d(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(u.apply(e,r))}var c=n.prototype,p=i(a(c)?c:Object.prototype),h=Function.apply.call(e,p,t);return a(h)?h:p}})},1867:(e,t,n)=>{"use strict";var r=n(510)(!0);n(5700)(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},6840:(e,t,n)=>{"use strict";var r=n(3938),i=n(7069),o=n(9666),s=n(3856),a=n(7470),c=n(7177).KEY,u=n(7929),d=n(250),l=n(5378),f=n(5730),p=n(2939),h=n(5103),m=n(6347),v=n(337),_=n(1421),g=n(2159),y=n(6727),b=n(6530),S=n(7932),C=n(3206),w=n(3101),k=n(526),I=n(4368),x=n(6183),R=n(8195),M=n(4743),T=n(6162),E=x.f,P=M.f,A=I.f,O=r.Symbol,j=r.JSON,L=j&&j.stringify,D=p("_hidden"),V=p("toPrimitive"),F={}.propertyIsEnumerable,N=d("symbol-registry"),W=d("symbols"),U=d("op-symbols"),B=Object.prototype,G="function"==typeof O&&!!R.f,q=r.QObject,z=!q||!q.prototype||!q.prototype.findChild,H=o&&u((function(){return 7!=k(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=E(B,t);r&&delete B[t],P(e,t,n),r&&e!==B&&P(B,t,r)}:P,J=function(e){var t=W[e]=k(O.prototype);return t._k=e,t},$=G&&"symbol"==typeof O.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof O},Y=function(e,t,n){return e===B&&Y(U,t,n),g(e),t=C(t,!0),g(n),i(W,t)?(n.enumerable?(i(e,D)&&e[D][t]&&(e[D][t]=!1),n=k(n,{enumerable:w(0,!1)})):(i(e,D)||P(e,D,w(1,{})),e[D][t]=!0),H(e,t,n)):P(e,t,n)},X=function(e,t){g(e);for(var n,r=v(t=S(t)),i=0,o=r.length;o>i;)Y(e,n=r[i++],t[n]);return e},K=function(e){var t=F.call(this,e=C(e,!0));return!(this===B&&i(W,e)&&!i(U,e))&&(!(t||!i(this,e)||!i(W,e)||i(this,D)&&this[D][e])||t)},Q=function(e,t){if(e=S(e),t=C(t,!0),e!==B||!i(W,t)||i(U,t)){var n=E(e,t);return!n||!i(W,t)||i(e,D)&&e[D][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=A(S(e)),r=[],o=0;n.length>o;)i(W,t=n[o++])||t==D||t==c||r.push(t);return r},ee=function(e){for(var t,n=e===B,r=A(n?U:S(e)),o=[],s=0;r.length>s;)!i(W,t=r[s++])||n&&!i(B,t)||o.push(W[t]);return o};G||(O=function(){if(this instanceof O)throw TypeError("Symbol is not a constructor!");var e=f(arguments.length>0?arguments[0]:void 0),t=function(n){this===B&&t.call(U,n),i(this,D)&&i(this[D],e)&&(this[D][e]=!1),H(this,e,w(1,n))};return o&&z&&H(B,e,{configurable:!0,set:t}),J(e)},a(O.prototype,"toString",(function(){return this._k})),x.f=Q,M.f=Y,n(3230).f=I.f=Z,n(6274).f=K,R.f=ee,o&&!n(6227)&&a(B,"propertyIsEnumerable",K,!0),h.f=function(e){return J(p(e))}),s(s.G+s.W+s.F*!G,{Symbol:O});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)p(te[ne++]);for(var re=T(p.store),ie=0;re.length>ie;)m(re[ie++]);s(s.S+s.F*!G,"Symbol",{for:function(e){return i(N,e+="")?N[e]:N[e]=O(e)},keyFor:function(e){if(!$(e))throw TypeError(e+" is not a symbol!");for(var t in N)if(N[t]===e)return t},useSetter:function(){z=!0},useSimple:function(){z=!1}}),s(s.S+s.F*!G,"Object",{create:function(e,t){return void 0===t?k(e):X(k(e),t)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var oe=u((function(){R.f(1)}));s(s.S+s.F*oe,"Object",{getOwnPropertySymbols:function(e){return R.f(b(e))}}),j&&s(s.S+s.F*(!G||u((function(){var e=O();return"[null]"!=L([e])||"{}"!=L({a:e})||"{}"!=L(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(y(t)||void 0!==e)&&!$(e))return _(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!$(t))return t}),r[1]=t,L.apply(j,r)}}),O.prototype[V]||n(1818)(O.prototype,V,O.prototype.valueOf),l(O,"Symbol"),l(Math,"Math",!0),l(r.JSON,"JSON",!0)},5971:(e,t,n)=>{"use strict";var r=n(3856),i=n(4579),o=n(3938),s=n(2707),a=n(7790);r(r.P+r.R,"Promise",{finally:function(e){var t=s(this,i.Promise||o.Promise),n="function"==typeof e;return this.then(n?function(n){return a(t,e()).then((function(){return n}))}:e,n?function(n){return a(t,e()).then((function(){throw n}))}:e)}})},2526:(e,t,n)=>{"use strict";var r=n(3856),i=n(9304),o=n(931);r(r.S,"Promise",{try:function(e){var t=i.f(this),n=o(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},8174:(e,t,n)=>{n(6347)("asyncIterator")},6461:(e,t,n)=>{n(6347)("observable")},3871:(e,t,n)=>{n(3882);for(var r=n(3938),i=n(1818),o=n(5449),s=n(2939)("toStringTag"),a="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),c=0;c<a.length;c++){var u=a[c],d=r[u],l=d&&d.prototype;l&&!l[s]&&i(l,s,u),o[u]=o.Array}},5666:e=>{var t=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},o=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",a=i.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,o=Object.create(i.prototype),s=new M(r||[]);return o._invoke=function(e,t,n){var r=l;return function(i,o){if(r===p)throw new Error("Generator is already running");if(r===h){if("throw"===i)throw o;return E()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var a=I(s,n);if(a){if(a===m)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===l)throw r=h,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=p;var c=d(e,t,n);if("normal"===c.type){if(r=n.done?h:f,c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(r=h,n.method="throw",n.arg=c.arg)}}}(e,n,s),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=u;var l="suspendedStart",f="suspendedYield",p="executing",h="completed",m={};function v(){}function _(){}function g(){}var y={};y[o]=function(){return this};var b=Object.getPrototypeOf,S=b&&b(b(T([])));S&&S!==n&&r.call(S,o)&&(y=S);var C=g.prototype=v.prototype=Object.create(y);function w(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function n(i,o,s,a){var c=d(e[i],e,o);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&r.call(l,"__await")?t.resolve(l.__await).then((function(e){n("next",e,s,a)}),(function(e){n("throw",e,s,a)})):t.resolve(l).then((function(e){u.value=e,s(u)}),(function(e){return n("throw",e,s,a)}))}a(c.arg)}var i;this._invoke=function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}}function I(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,I(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=d(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var o=i.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function M(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function T(e){if(e){var n=e[o];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return s.next=s}}return{next:E}}function E(){return{value:t,done:!0}}return _.prototype=C.constructor=g,g.constructor=_,_.displayName=c(g,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===_||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,c(e,a,"GeneratorFunction")),e.prototype=Object.create(C),e},e.awrap=function(e){return{__await:e}},w(k.prototype),k.prototype[s]=function(){return this},e.AsyncIterator=k,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var s=new k(u(t,n,r,i),o);return e.isGeneratorFunction(n)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},w(C),c(C,a,"Generator"),C[o]=function(){return this},C.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=T,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(R),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return a.type="throw",a.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var o=this.tryEntries.length-1;o>=0;--o){var s=this.tryEntries[o],a=s.completion;if("root"===s.tryLoc)return i("end");if(s.tryLoc<=this.prev){var c=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return i(s.catchLoc,!0);if(this.prev<s.finallyLoc)return i(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return i(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return i(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var o=i;break}}o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc&&(o=null);var s=o?o.completion:{};return s.type=e,s.arg=t,o?(this.method="next",this.next=o.finallyLoc,m):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;R(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:T(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=t}catch(e){Function("r","regeneratorRuntime = r")(t)}},7539:e=>{"use strict";const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substr(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],i=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&i?{usernameFragment:r.substr(12),password:i.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");for(let i=3;i<r.length;i++){const o=r[i],s=t.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){const r=t.parseRtpMap(s),i=t.matchPrefix(e,"a=fmtp:"+o+" ");switch(r.parameters=i.length?t.parseFmtp(i[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let i=0;return n.codecs.forEach((e=>{e.maxptime>i&&(i=e.maxptime)})),i>0&&(r+="a=maxptime:"+i+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),i=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=s.length>0&&s[0].ssrc;let c;const u=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substr(17).split(" ").map((e=>parseInt(e,10)))));u.length>0&&u[0].length>1&&u[0][0]===a&&(c=u[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),i&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:o?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const i=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=i.length>0,n.compound=0===i.length;const o=t.matchPrefix(e,"a=rtcp-mux");return n.mux=o.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substr(7).split(" "),{stream:n[0],track:n[1]};const i=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return i.length>0?(n=i[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let i;r.length>0&&(i=parseInt(r[0].substr(19),10)),isNaN(i)&&(i=65536);const o=t.matchPrefix(e,"a=sctp-port:");if(o.length>0)return{port:parseInt(o[0].substr(12),10),protocol:n.fmt,maxMessageSize:i};const s=t.matchPrefix(e,"a=sctpmap:");if(s.length>0){const e=s[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:i}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,r){let i;const o=void 0!==n?n:2;return i=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+i+" "+o+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var o=t[r]={exports:{}};return e[r](o,o.exports,n),o.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";n.d(r,{default:()=>Xo});var e={};n.r(e),n.d(e,{fixNegotiationNeeded:()=>q,shimAddTrackRemoveTrack:()=>B,shimAddTrackRemoveTrackWithNative:()=>U,shimGetDisplayMedia:()=>L,shimGetSendersWithDtmf:()=>F,shimGetStats:()=>N,shimGetUserMedia:()=>j,shimMediaStream:()=>D,shimOnTrack:()=>V,shimPeerConnection:()=>G,shimSenderReceiverGetStats:()=>W});var t={};n.r(t),n.d(t,{shimAddTransceiver:()=>Z,shimCreateAnswer:()=>ne,shimCreateOffer:()=>te,shimGetDisplayMedia:()=>H,shimGetParameters:()=>ee,shimGetUserMedia:()=>z,shimOnTrack:()=>J,shimPeerConnection:()=>$,shimRTCDataChannel:()=>Q,shimReceiverGetStats:()=>X,shimRemoveStream:()=>K,shimSenderGetStats:()=>Y});var i={};n.r(i),n.d(i,{shimAudioContext:()=>le,shimCallbacksAPI:()=>oe,shimConstraints:()=>ae,shimCreateOfferLegacy:()=>de,shimGetUserMedia:()=>se,shimLocalStreamsAPI:()=>re,shimRTCIceServerUrls:()=>ce,shimRemoteStreamsAPI:()=>ie,shimTrackEventTransceiver:()=>ue});var o={};function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.r(o),n.d(o,{removeExtmapAllowMixed:()=>ge,shimAddIceCandidateNullOrEmpty:()=>ye,shimConnectionState:()=>_e,shimMaxMessageSize:()=>me,shimParameterlessSetLocalDescription:()=>be,shimRTCIceCandidate:()=>he,shimSendThrowTypeError:()=>ve});var a=n(8548);function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),a(e,r.key,r)}}function u(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function d(e,t,n){return t in e?a(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var l=n(6406),f=n.n(l),p={clientType:"WEB",LOG_LEVEL:0,version:"0.0.1",autoSub:!0,onlyEnter:!1,reconnect:13,reconnectDelay:3e3,getCopyIntervalMillis:3e4,checkConnectIntervalMillis:1e3,iceRebuildCount:3,iceRebuildIntervalMillis:500,enterTimeout:2e4,useRTCCfgIfServerReturn:!1,forceUseRTCCfgIfServerReturnWhenP2P:!0,allowRepeatAudioMixerPublish:!1,logVolumeWhenInstantGE:.5,getMediaMeterIntervalMillis:400,_useRequestAnimationFrame:!1,meterWithTrackAudioLevel:!1,judgeTalkingByInstantGE:.05,_printSoundData:!1,trackBufferSize:20,allowSendWhenLessThan:4,disableTrack:!1,ctrlCheckIntervalMillis:1e4,ctrlTimeoutMillis:3e4,_printDebugStats:!1,statsSeconds:10,remainLastStatsCount:120,loglastConfrCount:2,loglastStoreArray:!0,consoleLogger:!0,printStatsWhenPCClose:!0,rebuildPeerConnectionWhenNetworkChanaged:!0,rtcStatsTypeMath:function(e,t){switch(e.type){case"remote-candidate":case"local-candidate":case"track":case"stream":case"inbound-rtp":case"outbound-rtp":case"transport":return!0}return!1},baseAcptOps:[102,104,105,106,107,300,302,303,304,301,204,206,400,401,1001,100201,100202,100203],acptOps:[100230,100205,1003,1004],globalConstraints:{}},h=n(7219),m=n(7544);function v(e){return v="function"==typeof h&&"symbol"==typeof m?function(e){return typeof e}:function(e){return e&&"function"==typeof h&&e.constructor===h&&e!==h.prototype?"symbol":typeof e},v(e)}var _=n(4504),g=n.n(_),y=n(9204),b=n.n(y);let S=!0,C=!0;function w(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function k(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);const o=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,o),i.apply(this,[e,o])};const o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return o.apply(this,arguments);if(!this._eventMap[t].has(n))return o.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function I(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(S=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function x(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(C=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function R(){if("object"==typeof window){if(S)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function M(e,t){C&&console.warn(e+" is deprecated, please use "+t+" instead.")}function T(e){return"[object Object]"===Object.prototype.toString.call(e)}function E(e){return T(e)?Object.keys(e).reduce((function(t,n){const r=T(e[n]),i=r?E(e[n]):e[n],o=r&&!Object.keys(i).length;return void 0===i||o?t:Object.assign(t,{[n]:i})}),{}):e}function P(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?P(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{P(e,e.get(t),n)}))})))}function A(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;const o=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)})),o.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&P(e,n,i)}))})),i}const O=R;function j(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const i=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[i("min",n)]=r.ideal,t.optional.push(e),e={},e[i("max",n)]=r.ideal,t.optional.push(e)):(e[i("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[i("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[i(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},i=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});const s=t.version<66;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||s)){let t;if(delete e.video.facingMode,"environment"===o.exact||"environment"===o.ideal?t=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let s=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!s&&n.length&&t.includes("back")&&(s=n[n.length-1]),s&&(e.video.deviceId=o.exact?{exact:s.deviceId}:{ideal:s.deviceId}),e.video=r(e.video),O("chrome: "+JSON.stringify(e)),i(e)}))}e.video=r(e.video)}return O("chrome: "+JSON.stringify(e)),i(e)},o=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){i(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(o(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return i(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(o(e))))))}}}function L(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,i=n.video&&n.video.height,o=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:o||3}},r&&(n.video.mandatory.maxWidth=r),i&&(n.video.mandatory.maxHeight=i),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function D(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function V(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const i=new Event("track");i.track=n.track,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const i=new Event("track");i.track=n,i.receiver=r,i.transceiver={receiver:r},i.streams=[t.stream],this.dispatchEvent(i)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else k(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function F(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let i=n.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function N(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const i=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},o=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(o(i(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(o(i(t)))},n])})).then(n,r)}}function W(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>A(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),k(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>A(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function U(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),i.apply(this,arguments)}}function B(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return U(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const i=e.RTCPeerConnection.prototype.removeStream;function o(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}function s(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},i.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const i=this.getSenders().find((e=>e.track===t));if(i)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const o=this._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=o(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>o(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=s(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function G(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function q(e,t){k(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function z(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){M("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function H(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function J(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function $(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,i,o]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!i)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(i,o)}}function Y(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function X(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),k(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function K(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){M("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function Q(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function Z(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],n=e&&"sendEncodings"in e;n&&e.sendEncodings.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function ee(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function te(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function ne(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function re(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function ie(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function oe(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,i=t.setLocalDescription,o=t.setRemoteDescription,s=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],i=n.apply(this,[r]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i};let a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function se(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(ae(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function ae(e){return e&&void 0!==e.video?Object.assign({},e,{video:E(e.video)}):e}function ce(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(M("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function ue(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function de(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function le(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var fe=n(7539),pe=n.n(fe);function he(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const n=new t(e),r=pe().parseCandidate(e.candidate),i=Object.assign(n,r);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,k(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function me(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=function(e){if(!e||!e.sdp)return!1;const t=pe().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=pe().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},r=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n},i=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n},o=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const i=pe().matchPrefix(e.sdp,"a=max-message-size:");return i.length>0?r=parseInt(i[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r},s=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const e=r(arguments[0]),t=i(e),n=o(arguments[0],e);let s;s=0===t&&0===n?Number.POSITIVE_INFINITY:0===t||0===n?Math.max(t,n):Math.min(t,n);const a={};Object.defineProperty(a,"maxMessageSize",{get:()=>s}),this._sctp=a}return s.apply(this,arguments)}}function ve(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},k(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function _e(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function ge(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function ye(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function be(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return n.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>n.apply(this,[e])))})}const Se=function({window:n}={},r={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const s=R,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=w(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=w(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=w(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(n),c={browserDetails:a,commonShim:o,extractVersion:w,disableLog:I,disableWarnings:x,sdp:fe};switch(a.browser){case"chrome":if(!e||!G||!r.shimChrome)return s("Chrome shim is not included in this adapter release."),c;if(null===a.version)return s("Chrome shim can not determine version, not shimming."),c;s("adapter.js shimming chrome."),c.browserShim=e,ye(n,a),be(n),j(n,a),D(n),G(n,a),V(n),B(n,a),F(n),N(n),W(n),q(n,a),he(n),_e(n),me(n,a),ve(n),ge(n,a);break;case"firefox":if(!t||!$||!r.shimFirefox)return s("Firefox shim is not included in this adapter release."),c;s("adapter.js shimming firefox."),c.browserShim=t,ye(n,a),be(n),z(n,a),$(n,a),J(n),K(n),Y(n),X(n),Q(n),Z(n),ee(n),te(n),ne(n),he(n),_e(n),me(n,a),ve(n);break;case"safari":if(!i||!r.shimSafari)return s("Safari shim is not included in this adapter release."),c;s("adapter.js shimming safari."),c.browserShim=i,ye(n,a),be(n),ce(n),de(n),oe(n),re(n),ie(n),ue(n),se(n),le(n),he(n),me(n,a),ve(n),ge(n,a);break;default:s("Unsupported browser!")}return c}({window:"undefined"==typeof window?void 0:window}),Ce=Se;var we=Ce.browserDetails.browser,ke=Ce.browserDetails.version;"Not a supported browser."===we&&console.error("Not a supported browser"),console.info("Current browser",we,ke);var Ie,xe="firefox"===we,Re="chrome"===we,Me="safari"===we,Te="edge"===we,Ee=(window.RTCPeerConnection&&/^https\:$/.test(window.location.protocol),window.AudioContext||window.webkitAudioContext);function Pe(e){var t=e.getBoundingClientRect();return{x:t.left+(window.pageXOffset||window.document.documentElement.scrollLeft),y:t.top+(window.pageYOffset||window.document.documentElement.scrollTop),width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}}(Re||Me)&&(Ie=!0),Ie=!1;var Ae="object"===("undefined"==typeof HTMLElement?"undefined":v(HTMLElement))?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"===v(e)&&1===e.nodeType&&"string"==typeof e.nodeName};n(6754);var Oe=n(4720),je=n.n(Oe),Le=n(3133),De=n.n(Le);const Ve="object"==typeof global&&global&&global.Object===Object&&global;var Fe="object"==typeof self&&self&&self.Object===Object&&self;const Ne=Ve||Fe||Function("return this")(),We=Ne.Symbol;var Ue=Object.prototype,Be=Ue.hasOwnProperty,Ge=Ue.toString,qe=We?We.toStringTag:void 0;var ze=Object.prototype.toString;var He=We?We.toStringTag:void 0;const Je=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":He&&He in Object(e)?function(e){var t=Be.call(e,qe),n=e[qe];try{e[qe]=void 0;var r=!0}catch(e){}var i=Ge.call(e);return r&&(t?e[qe]=n:delete e[qe]),i}(e):function(e){return ze.call(e)}(e)},$e=function(e,t){return function(n){return e(t(n))}},Ye=$e(Object.getPrototypeOf,Object),Xe=function(e){return null!=e&&"object"==typeof e};var Ke=Function.prototype,Qe=Object.prototype,Ze=Ke.toString,et=Qe.hasOwnProperty,tt=Ze.call(Object);const nt=function(e){if(!Xe(e)||"[object Object]"!=Je(e))return!1;var t=Ye(e);if(null===t)return!0;var n=et.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Ze.call(n)==tt};function rt(){if(!(emedia._logContextIndex<0)&&emedia._logContext&&emedia._logContext instanceof Array){var e=emedia._logContextIndex%emedia._logContext.length,t=emedia._logContext[e];t&&t instanceof Array||(t=emedia._logContext[e]=[]);var n=[];n.push(emedia._logContextIndex);var r,i=new Date;"function"==typeof i.toLocaleString?n.push(i.toLocaleString()):i.toJSON?n.push(i.toJSON()):i.toISOString?n.push(i.toISOString()):n.push(i+"");for(var o=0;o<arguments.length;o++){var s=arguments[o];"string"!=typeof s&&s?"string"!=typeof s.message?"function"!=typeof s.message?"string"!=typeof s.stack?s.event&&"function"==typeof s.event.toString||s.event&&"function"==typeof s.event.toString?n.push(s.event.toString()):"string"!=typeof s.candidate?"string"!=typeof s.sdp?nt(s)?n.push(je()(s)):n.push(String(s)):n.push(s.sdp):n.push(s.candidate):n.push(s.stack):n.push(s.message()):n.push(s.message):n.push(s)}if(p.loglastStoreArray&&t.push(r=n.join(" ")),"function"==typeof emedia.config.onSdkLog)try{r||(r=n.join(" ")),emedia.config.onSdkLog(r)}catch(e){console.error(e)}}}function it(){try{rt.apply(null,arguments)}catch(e){console.warn(e)}}function ot(e,t,n){try{if(emedia&&emedia.LOG_LEVEL&&e<emedia.LOG_LEVEL)return;var r=[];r.push(e),n.tag&&r.push(n.tag),De()(t).forEach((function(e,t){r.push(e&&e._toString?e._toString.call(e):e)})),n._log.apply(n,r)}catch(e){throw e}}var st=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"EMEDIA";s(this,e),d(this,"LogLevel",{TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5}),d(this,"LogLevelName",["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"]),this.tag=t,p.loglastConfrCount&&(this._logContext=new Array(p.loglastConfrCount),this._logContextIndex=-1)}return u(e,[{key:"_log",value:function(){var e=arguments[0];e=arguments[0]=this.LogLevelName[e],this._logContext&&it.apply(null,arguments),!0===emedia.config.consoleLogger&&console&&e&&(console[e.toLowerCase()]||console.warn).apply(console,arguments)}},{key:"log",value:function(){ot(this.LogLevel.INFO,arguments,this)}},{key:"trace",value:function(){ot(this.LogLevel.TRACE,arguments,this)}},{key:"debug",value:function(){ot(this.LogLevel.DEBUG,arguments,this)}},{key:"info",value:function(){ot(this.LogLevel.INFO,arguments,this)}},{key:"warn",value:function(){ot(this.LogLevel.WARN,arguments,this)}},{key:"error",value:function(){ot(this.LogLevel.ERROR,arguments,this)}},{key:"fatal",value:function(){ot(this.LogLevel.FATAL,arguments,this)}},{key:"count",value:function(){if(emedia._logContext){emedia._logContextIndex++;var e=emedia._logContextIndex%emedia._logContext.length;0===e&&0!==emedia._logContextIndex&&(emedia._logContext.loadlogs=emedia._logContext[e]),emedia._logContext[e]=[]}}}]),e}(),at=function(e){return new st(e)};const ct=new st;var ut=n(4422),dt=n.n(ut);function lt(){}lt.prototype.extend=function(){var e,t,n,r,i,o,s=this,a=arguments[0]||{},c=1,u=arguments.length,d=!1;for("boolean"==typeof a&&(d=a,a=arguments[c]||{},c++),"object"===v(a)||s.isFunction(a)||(a={}),c===u&&(a=this,c--);c<u;c++)if(null!=(e=arguments[c]))for(t in e)n=a[t],a!==(r=e[t])&&(d&&r&&(nt(r)||(i=dt()(r)))?(i?(i=!1,o=n&&dt()(n)?n:[]):o=n&&nt(n)?n:{},a[t]=s.extend(d,o,r)):void 0!==r&&(a[t]=r));return a},lt.prototype.prototypeExtend=lt.prototype.classExtend=function(){var e=this;function t(){for(var t=0;t<arguments.length;t++){var n=arguments[t]||{};e.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var n=0;n<arguments.length;n++){var r=arguments[n]||{};"function"==typeof r&&(r=r.prototype),e.extend(!0,t.prototype,r)}return t.extend||(t.extend=function(n){return e.prototypeExtend(t,n)}),t};const ft=new lt;function pt(e){return Number(e)===e&&e%1!=0}function ht(e,t){if(null!=e){var n=e[t];return delete e[t],n}}function mt(e,t){if(e&&!(dt()(e)&&0===e.length||void 0!==e.length&&0===e.length))if(e.length)for(var n=0;n<e.length;n++)t(n,e[n]);else if(e&&!function(e){var t;for(t in e)return!1;return!0}(e)){e=e||{};var r=f()({},e);for(var i in r)t(i,e[i])}}const vt=function(e,t,n){for(var r=-1,i=Object(e),o=n(e),s=o.length;s--;){var a=o[++r];if(!1===t(i[a],a,i))break}return e},_t=function(e){return e},gt=function(e){return Xe(e)&&"[object Arguments]"==Je(e)};var yt=Object.prototype,bt=yt.hasOwnProperty,St=yt.propertyIsEnumerable,Ct=gt(function(){return arguments}())?gt:function(e){return Xe(e)&&bt.call(e,"callee")&&!St.call(e,"callee")};const wt=Ct,kt=Array.isArray;var It="object"==typeof exports&&exports&&!exports.nodeType&&exports,xt=It&&"object"==typeof module&&module&&!module.nodeType&&module,Rt=xt&&xt.exports===It?Ne.Buffer:void 0;const Mt=(Rt?Rt.isBuffer:void 0)||function(){return!1};var Tt=/^(?:0|[1-9]\d*)$/;const Et=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&Tt.test(e))&&e>-1&&e%1==0&&e<t},Pt=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var At={};At["[object Float32Array]"]=At["[object Float64Array]"]=At["[object Int8Array]"]=At["[object Int16Array]"]=At["[object Int32Array]"]=At["[object Uint8Array]"]=At["[object Uint8ClampedArray]"]=At["[object Uint16Array]"]=At["[object Uint32Array]"]=!0,At["[object Arguments]"]=At["[object Array]"]=At["[object ArrayBuffer]"]=At["[object Boolean]"]=At["[object DataView]"]=At["[object Date]"]=At["[object Error]"]=At["[object Function]"]=At["[object Map]"]=At["[object Number]"]=At["[object Object]"]=At["[object RegExp]"]=At["[object Set]"]=At["[object String]"]=At["[object WeakMap]"]=!1;const Ot=function(e){return function(t){return e(t)}};var jt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Lt=jt&&"object"==typeof module&&module&&!module.nodeType&&module,Dt=Lt&&Lt.exports===jt&&Ve.process;const Vt=function(){try{return Lt&&Lt.require&&Lt.require("util").types||Dt&&Dt.binding&&Dt.binding("util")}catch(e){}}();var Ft=Vt&&Vt.isTypedArray;const Nt=Ft?Ot(Ft):function(e){return Xe(e)&&Pt(e.length)&&!!At[Je(e)]};var Wt=Object.prototype.hasOwnProperty;const Ut=function(e,t){var n=kt(e),r=!n&&wt(e),i=!n&&!r&&Mt(e),o=!n&&!r&&!i&&Nt(e),s=n||r||i||o,a=s?function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}(e.length,String):[],c=a.length;for(var u in e)!t&&!Wt.call(e,u)||s&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Et(u,c))||a.push(u);return a},Bt=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};var Gt=Object.prototype;const qt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Gt)};var zt=Object.prototype.hasOwnProperty;const Ht=function(e){if(!Bt(e))return function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}(e);var t=qt(e),n=[];for(var r in e)("constructor"!=r||!t&&zt.call(e,r))&&n.push(r);return n},Jt=function(e){if(!Bt(e))return!1;var t=Je(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},$t=function(e){return null!=e&&Pt(e.length)&&!Jt(e)},Yt=function(e){return $t(e)?Ut(e,!0):Ht(e)},Xt=function(e,t){return null==e?e:vt(e,"function"==typeof(n=t)?n:_t,Yt);var n};var Kt=at("PCStats"),Qt=ft.prototypeExtend({__init__:function(){this._webrtc||this._stream&&(this._webrtc=this._stream._webrtc),this.samplesDatas={},this.gatherResults={},this._bysamples={},!1!==this._inbound_&&(this._bysamples["inbound-rtp"]=["bytesRateReceived","packageLossRate","bytesReceived","packetsLost","packetsReceived","pliCount","framesDecoded"]),!1!==this._outbound_&&(this._bysamples["outbound-rtp"]=["bytesRateSent","bytesSent","packetsSent","qpSum","pliCount"])},_onGatherResult:function(e,t,n,r){var i=this;if(i._service&&i._service.current&&emedia.config.remainLastStatsCount){var o=i._service.current._trackStats;o||(o=i._service.current._trackStats={});var s=(o[e]||(o[e]={}))[t];s||(s=o[e][t]={});var a=s[n];a||(a=s[n]=new Array(emedia.config.remainLastStatsCount)),void 0===a.curIndex&&(a.curIndex=0),a[a.curIndex]={data:r,timestamp:new Date},a.curIndex=(a.curIndex+1)%emedia.config.remainLastStatsCount}"function"==typeof this.onGatherResult&&this.onGatherResult(e,t,n,r)},stats:function(e){if(this._webrtc&&this._webrtc._rtcPeerConnection)return this._webrtc._rtcPeerConnection.getStats(e);Kt.warn("not found webrtc or peer connection")},statsOfTrack:function(e){if(!e instanceof window.MediaStreamTrack)throw Kt.error("selector not a MediaStreamTrack"),"selector not a MediaStreamTrack";return this.stats(e)},audioTrack:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0]:void 0},videoTrack:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0]:void 0},gatherTrack:function(e,t){var n=this;t=(t=e.kind||t)&&t.toLowerCase();var r=e.id;this.statsOfTrack(e).then((function(i){n.samplesDatas[r]||(n.samplesDatas[r]={});var o=n.samplesDatas[r];i.forEach((function(r,i){var s=n._bysamples[r.type],a=r.mediaType||i.indexOf("ideo")>=0&&"video"||i.indexOf("udio")>=0&&"audio"||void 0;if(s&&s.length&&(emedia.config._printDebugStats,!a||a===t)){var c=o[r.type]||(o[r.type]={});s.forEach((function(n){var i=c[n]||(c[n]=[]),o={timestamp:r.timestamp,kind:r.mediaType||e.kind||t};o[n]="packageLossRate"===n?{packetsLost:r.packetsLost,packetsReceived:r.packetsReceived}:"bytesRateReceived"===n?r.bytesReceived:"bytesRateSent"===n?r.bytesSent:r[n],i.push(o)}))}}))}))},gatherWebrtcMediaStream:function(e,t){var n=this;t?"audio"!==t.toLowerCase()?"video"!==t.toLowerCase()||e.getVideoTracks().forEach((function(e){n.gatherTrack(e,e.kind||t.toLowerCase())})):e.getAudioTracks().forEach((function(e){n.gatherTrack(e,e.kind||t.toLowerCase())})):e.getTracks().forEach((function(e){n.gatherTrack(e)}))},gatherWebrtc:function(){this._webrtc._localStream&&this.gatherWebrtcMediaStream(this._webrtc._localStream),this._webrtc._remoteStream&&this.gatherWebrtcMediaStream(this._webrtc._remoteStream)},_gather_inbound_rtp_packageLossRate:function(e){if(!e||0===e.length)return 0;var t=0,n=0;if(e.length>1)for(var r=1;r<e.length;r++){var i=e[r],o=e[r-1];i.packageLossRate.packetsReceived!=o.packageLossRate.packetsReceived?(t+=(i.packageLossRate.packetsLost-o.packageLossRate.packetsLost)/(i.packageLossRate.packetsReceived-o.packageLossRate.packetsReceived),n++):(t=0,n=0)}return e.length>=emedia.config.statsSeconds&&e.shift(),0==n?0:t/n},_gatherBytesRate:function(e,t,n){if(!n||0===n.length)return 0;var r=n[n.length-1][t]-n[0][t],i=n[n.length-1].timestamp-n[0].timestamp;return n.length>=emedia.config.statsSeconds&&n.shift(),0===i?0:b()(1e3*r/i).toFixed(2)},_gather:function(e,t,n){var r=function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)}("_gather",e=e.replace(/[^\w]/g,"_"),t=t.replace(/[^\w]/g,"_")).join("_");if("function"==typeof this[r])return this[r](n);if(t.startsWith("bytesRate"))return this._gatherBytesRate(e,t,n);var i=n.shift();return i&&i[t]||0},_statsCount:function(){var e=this;Xt(e.samplesDatas,(function(t,n){!function(t,n,r){Xt(r,(function(r,i){var o=n[i]||(n[i]={});!function(t,n,r,i){Xt(i,(function(i,o){var s=n[o]=e._gather(r,o,i);e._onGatherResult(t,r,o,s)}))}(t,o,i,r)}))}(n,e.gatherResults[n]=e.gatherResults[n]||{},t)}))},gather:function(){this.gatherWebrtc(),this._statsCount()},intervalGather:function(e){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this.gather.bind(this),e||1e3)},stopIntervalGather:function(){this._intervalId&&clearInterval(this._intervalId)}}),Zt={},en=Qt.echo=function(e){e.forEach((function(e,t){var n;!Zt[e.id]&&e._webrtc&&!e._webrtc.closed&&e.getMediaStream()?(Zt[e.id]=n=new Qt({_webrtc:e._webrtc}),n._mediaStream=e.getMediaStream()):!Zt[e.id]||e._webrtc&&!e._webrtc.closed&&e.getMediaStream()||ht(Zt,e.id)}));var t=[];Xt((function(n,r){e&&e[r]?(n.gatherWebrtcMediaStream(n._mediaStream),n._statsCount()):t.push(r)})),t.forEach((function(e,t){ht(Zt,e)}))};Qt.intervalEcho=function(e,t){return setInterval((function(){return en(e)}),t)},["inbound","outbound"].forEach((function(e,t){["Audio","Video"].forEach((function(t,n){!function(e,t){var n;Qt[e+t]=n=function(r,i,o){var s;n.__intervalIds||(n.__intervalIds={}),s=this instanceof emedia.Service?this:emedia.useCurrentXService;var a=r.id+"___"+s.namespace,c=n.__intervalIds&&n.__intervalIds[a];return c&&clearInterval(c),c=setInterval((function(){var o,u=n[a];!u&&r&&r._webrtc&&!r._webrtc.closed&&r.getMediaStream()?(n[a]=u=new Qt({_webrtc:r._webrtc,_inbound_:"inbound"===e,_outbound_:"outbound"===e}),u._service=s,i&&(u.onGatherResult=i),u._mediaStream=r.getMediaStream()):!u||r&&r._webrtc&&!r._webrtc.closed&&r._webrtc.__id===u._webrtc.__id&&r.getMediaStream()&&u._mediaStream&&u._mediaStream.id===r.getMediaStream().id||(ht(n,a),u=null),u?(u.gatherWebrtcMediaStream(u._mediaStream,t),u._statsCount()):r&&s&&(o=s.getStreamById(r.id))?r=o:c&&clearInterval(c)}),o),n.__intervalIds[a]=c,c}}(e,t)}))}));const tn=Qt;function nn(e){e.getAudioTracks().forEach((function(t){t.stop(),ct.info("Media stream stop audio track. stream =",e.id,"track =",t.id,t.kind)}))}function rn(e){e.getAudioTracks().forEach((function(t){t.stop(),removeTrack(t),ct.info("Media stream stop and remove audio tracks. stream =",e.id,"track =",t.id,t.kind)}))}function on(e){try{if(!e||!1===e.active)return void ct.debug("stream tracks had been stoped. it ",e&&e.id);e.getTracks().forEach((function(t){t.stop(),ct.info("Media stream stop track. stream =",e.id," track =",t.id,t.kind)})),e._bindAttendee&&(ht(e._bindAttendee._openedRtcMediaStreams,e.id),e._bindAttendee=null),ct.info("stream tracks stoped. it ",e.id)}catch(e){ct.error(e)}}function sn(e,t){null==e||e.getVideoTracks().forEach((function(n){if("function"==typeof n.enable)return n.enable(),ct.info("Media stream enable video track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t));n.enabled===t||(n.enabled=t)}))}function an(e,t){null==e||e.getAudioTracks().forEach((function(n){if("function"==typeof n.enable)return n.enable(),ct.info("Media stream enable audio track. stream =",e.id,"track =",n.kind,n.enabled,n.id),void(n.enabled===t||n.enable(t));n.enabled===t||(n.enabled=t)}))}function cn(e){if(!e||"function"!=typeof e.getAudioTracks)return!1;if(!e.active)return!1;var t=e.getAudioTracks();if(0===t.length)return!1;for(var n in t)if("function"==typeof t[n].enable&&t[n].enable(),t[n].enabled)return!0;return!1}function un(){var e=function(){if(emedia._logContext&&emedia._logContext instanceof Array&&!(void 0===emedia._logContextIndex||emedia._logContextIndex<0)){var e=0,t=emedia._logContextIndex;emedia._logContextIndex>=emedia._logContext.length&&(e=emedia._logContextIndex-emedia._logContext.length+1);for(var n="",r=e;r<=t;r++){var i=r%emedia._logContext.length;n+=emedia._logContext[i].join("\r\n")+"\r\n"}return emedia._logContext.loadlogs&&emedia._logContext.loadlogs instanceof Array&&(n+="-------------------------------------------------------------\r\n",n+=emedia._logContext.loadlogs.join("\r\n")+"\r\n"),n}}();if(e){var t=encodeURIComponent(e),n=document.createElement("a");n.style.display="none",n.download="emedia-"+(new Date).toJSON()+".log",n.href="data:text/plain;charset=utf-8,"+t,document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)}}const dn=Ne["__core-js_shared__"];var ln,fn=(ln=/[^.]+$/.exec(dn&&dn.keys&&dn.keys.IE_PROTO||""))?"Symbol(src)_1."+ln:"";var pn=Function.prototype.toString;const hn=function(e){if(null!=e){try{return pn.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var mn=/^\[object .+?Constructor\]$/,vn=Function.prototype,_n=Object.prototype,gn=vn.toString,yn=_n.hasOwnProperty,bn=RegExp("^"+gn.call(yn).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Sn=function(e){return!(!Bt(e)||(t=e,fn&&fn in t))&&(Jt(e)?bn:mn).test(hn(e));var t},Cn=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return Sn(n)?n:void 0},wn=function(){try{var e=Cn(Object,"defineProperty");return e({},"",{}),e}catch(e){}}(),kn=function(e,t,n){"__proto__"==t&&wn?wn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n},In=function(e,t){return e===t||e!=e&&t!=t};var xn=Object.prototype.hasOwnProperty;const Rn=function(e,t,n){var r=e[t];xn.call(e,t)&&In(r,n)&&(void 0!==n||t in e)||kn(e,t,n)},Mn=function(e,t,n,r){var i=!n;n||(n={});for(var o=-1,s=t.length;++o<s;){var a=t[o],c=r?r(n[a],e[a],a,n,e):void 0;void 0===c&&(c=e[a]),i?kn(n,a,c):Rn(n,a,c)}return n},Tn=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)};var En=Math.max;const Pn=wn?function(e,t){return wn(e,"toString",{configurable:!0,enumerable:!1,value:(n=t,function(){return n}),writable:!0});var n}:_t;var An=Date.now;const On=(jn=Pn,Ln=0,Dn=0,function(){var e=An(),t=16-(e-Dn);if(Dn=e,t>0){if(++Ln>=800)return arguments[0]}else Ln=0;return jn.apply(void 0,arguments)});var jn,Ln,Dn;const Vn=function(e,t){return On(function(e,t,n){return t=En(void 0===t?e.length-1:t,0),function(){for(var r=arguments,i=-1,o=En(r.length-t,0),s=Array(o);++i<o;)s[i]=r[t+i];i=-1;for(var a=Array(t+1);++i<t;)a[i]=r[i];return a[t]=n(s),Tn(e,this,a)}}(e,t,_t),e+"")},Fn=(Nn=function(e,t){Mn(t,Yt(t),e)},Vn((function(e,t){var n=-1,r=t.length,i=r>1?t[r-1]:void 0,o=r>2?t[2]:void 0;for(i=Nn.length>3&&"function"==typeof i?(r--,i):void 0,o&&function(e,t,n){if(!Bt(n))return!1;var r=typeof t;return!!("number"==r?$t(n)&&Et(t,n.length):"string"==r&&t in n)&&In(n[t],e)}(t[0],t[1],o)&&(i=r<3?void 0:i,r=1),e=Object(e);++n<r;){var s=t[n];s&&Nn(e,s)}return e})));var Nn;const Wn=function(e,t){for(var n=e.length;n--;)if(In(e[n][0],t))return n;return-1};var Un=Array.prototype.splice;function Bn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Bn.prototype.clear=function(){this.__data__=[],this.size=0},Bn.prototype.delete=function(e){var t=this.__data__,n=Wn(t,e);return!(n<0||(n==t.length-1?t.pop():Un.call(t,n,1),--this.size,0))},Bn.prototype.get=function(e){var t=this.__data__,n=Wn(t,e);return n<0?void 0:t[n][1]},Bn.prototype.has=function(e){return Wn(this.__data__,e)>-1},Bn.prototype.set=function(e,t){var n=this.__data__,r=Wn(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};const Gn=Bn,qn=Cn(Ne,"Map"),zn=Cn(Object,"create");var Hn=Object.prototype.hasOwnProperty;var Jn=Object.prototype.hasOwnProperty;function $n(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}$n.prototype.clear=function(){this.__data__=zn?zn(null):{},this.size=0},$n.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},$n.prototype.get=function(e){var t=this.__data__;if(zn){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Hn.call(t,e)?t[e]:void 0},$n.prototype.has=function(e){var t=this.__data__;return zn?void 0!==t[e]:Jn.call(t,e)},$n.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=zn&&void 0===t?"__lodash_hash_undefined__":t,this};const Yn=$n,Xn=function(e,t){var n,r,i=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof t?"string":"hash"]:i.map};function Kn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Kn.prototype.clear=function(){this.size=0,this.__data__={hash:new Yn,map:new(qn||Gn),string:new Yn}},Kn.prototype.delete=function(e){var t=Xn(this,e).delete(e);return this.size-=t?1:0,t},Kn.prototype.get=function(e){return Xn(this,e).get(e)},Kn.prototype.has=function(e){return Xn(this,e).has(e)},Kn.prototype.set=function(e,t){var n=Xn(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};const Qn=Kn;function Zn(e){var t=this.__data__=new Gn(e);this.size=t.size}Zn.prototype.clear=function(){this.__data__=new Gn,this.size=0},Zn.prototype.delete=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n},Zn.prototype.get=function(e){return this.__data__.get(e)},Zn.prototype.has=function(e){return this.__data__.has(e)},Zn.prototype.set=function(e,t){var n=this.__data__;if(n instanceof Gn){var r=n.__data__;if(!qn||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new Qn(r)}return n.set(e,t),this.size=n.size,this};const er=Zn;function tr(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new Qn;++t<n;)this.add(e[t])}tr.prototype.add=tr.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},tr.prototype.has=function(e){return this.__data__.has(e)};const nr=tr,rr=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1},ir=function(e,t,n,r,i,o){var s=1&n,a=e.length,c=t.length;if(a!=c&&!(s&&c>a))return!1;var u=o.get(e),d=o.get(t);if(u&&d)return u==t&&d==e;var l=-1,f=!0,p=2&n?new nr:void 0;for(o.set(e,t),o.set(t,e);++l<a;){var h=e[l],m=t[l];if(r)var v=s?r(m,h,l,t,e,o):r(h,m,l,e,t,o);if(void 0!==v){if(v)continue;f=!1;break}if(p){if(!rr(t,(function(e,t){if(s=t,!p.has(s)&&(h===e||i(h,e,n,r,o)))return p.push(t);var s}))){f=!1;break}}else if(h!==m&&!i(h,m,n,r,o)){f=!1;break}}return o.delete(e),o.delete(t),f},or=Ne.Uint8Array,sr=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n},ar=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n};var cr=We?We.prototype:void 0,ur=cr?cr.valueOf:void 0;const dr=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e},lr=function(e,t,n){var r=t(e);return kt(e)?r:dr(r,n(e))},fr=function(){return[]};var pr=Object.prototype.propertyIsEnumerable,hr=Object.getOwnPropertySymbols,mr=hr?function(e){return null==e?[]:(e=Object(e),function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var s=e[n];t(s,n,e)&&(o[i++]=s)}return o}(hr(e),(function(t){return pr.call(e,t)})))}:fr;const vr=mr,_r=$e(Object.keys,Object);var gr=Object.prototype.hasOwnProperty;const yr=function(e){return $t(e)?Ut(e):function(e){if(!qt(e))return _r(e);var t=[];for(var n in Object(e))gr.call(e,n)&&"constructor"!=n&&t.push(n);return t}(e)},br=function(e){return lr(e,yr,vr)};var Sr=Object.prototype.hasOwnProperty;const Cr=Cn(Ne,"DataView"),wr=Cn(Ne,"Promise"),kr=Cn(Ne,"Set"),Ir=Cn(Ne,"WeakMap");var xr="[object Map]",Rr="[object Promise]",Mr="[object Set]",Tr="[object WeakMap]",Er="[object DataView]",Pr=hn(Cr),Ar=hn(qn),Or=hn(wr),jr=hn(kr),Lr=hn(Ir),Dr=Je;(Cr&&Dr(new Cr(new ArrayBuffer(1)))!=Er||qn&&Dr(new qn)!=xr||wr&&Dr(wr.resolve())!=Rr||kr&&Dr(new kr)!=Mr||Ir&&Dr(new Ir)!=Tr)&&(Dr=function(e){var t=Je(e),n="[object Object]"==t?e.constructor:void 0,r=n?hn(n):"";if(r)switch(r){case Pr:return Er;case Ar:return xr;case Or:return Rr;case jr:return Mr;case Lr:return Tr}return t});const Vr=Dr;var Fr="[object Arguments]",Nr="[object Array]",Wr="[object Object]",Ur=Object.prototype.hasOwnProperty;const Br=function(e,t,n,r,i,o){var s=kt(e),a=kt(t),c=s?Nr:Vr(e),u=a?Nr:Vr(t),d=(c=c==Fr?Wr:c)==Wr,l=(u=u==Fr?Wr:u)==Wr,f=c==u;if(f&&Mt(e)){if(!Mt(t))return!1;s=!0,d=!1}if(f&&!d)return o||(o=new er),s||Nt(e)?ir(e,t,n,r,i,o):function(e,t,n,r,i,o,s){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!o(new or(e),new or(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return In(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var a=sr;case"[object Set]":var c=1&r;if(a||(a=ar),e.size!=t.size&&!c)return!1;var u=s.get(e);if(u)return u==t;r|=2,s.set(e,t);var d=ir(a(e),a(t),r,i,o,s);return s.delete(e),d;case"[object Symbol]":if(ur)return ur.call(e)==ur.call(t)}return!1}(e,t,c,n,r,i,o);if(!(1&n)){var p=d&&Ur.call(e,"__wrapped__"),h=l&&Ur.call(t,"__wrapped__");if(p||h){var m=p?e.value():e,v=h?t.value():t;return o||(o=new er),i(m,v,n,r,o)}}return!!f&&(o||(o=new er),function(e,t,n,r,i,o){var s=1&n,a=br(e),c=a.length;if(c!=br(t).length&&!s)return!1;for(var u=c;u--;){var d=a[u];if(!(s?d in t:Sr.call(t,d)))return!1}var l=o.get(e),f=o.get(t);if(l&&f)return l==t&&f==e;var p=!0;o.set(e,t),o.set(t,e);for(var h=s;++u<c;){var m=e[d=a[u]],v=t[d];if(r)var _=s?r(v,m,d,t,e,o):r(m,v,d,e,t,o);if(!(void 0===_?m===v||i(m,v,n,r,o):_)){p=!1;break}h||(h="constructor"==d)}if(p&&!h){var g=e.constructor,y=t.constructor;g==y||!("constructor"in e)||!("constructor"in t)||"function"==typeof g&&g instanceof g&&"function"==typeof y&&y instanceof y||(p=!1)}return o.delete(e),o.delete(t),p}(e,t,n,r,i,o))},Gr=function e(t,n,r,i,o){return t===n||(null==t||null==n||!Xe(t)&&!Xe(n)?t!=t&&n!=n:Br(t,n,r,i,e,o))},qr=function(e,t){return Gr(e,t)};var zr=n(3029),Hr=n.n(zr),Jr=n(3497),$r=n.n(Jr),Yr=n(200),Xr=n(4255);function Kr(e,t){return Kr=Xr||function(e,t){return e.__proto__=t,e},Kr(e,t)}function Qr(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Yr(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Kr(e,t)}function Zr(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ei(e,t){return!t||"object"!==v(t)&&"function"!=typeof t?Zr(e):t}var ti=n(4100);function ni(e){return ni=Xr?ti:function(e){return e.__proto__||ti(e)},ni(e)}function ri(e){var t=function(){if("undefined"==typeof Reflect||!$r())return!1;if($r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call($r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=ni(e);if(t){var i=ni(this).constructor;n=$r()(r,arguments,i)}else n=r.apply(this,arguments);return ei(this,n)}}var ii=function(){function e(t){s(this,e),d(this,"msg",""),this.day=new Date,this.registerProps(t)}return u(e,[{key:"registerProps",value:function(e){for(var t in e)this[t]=e[t]}},{key:"execTime",value:function(){var e=this.day.getHours();e<10&&(e="0"+e);var t=this.day.getMinutes();t<10&&(t="0"+t);var n=this.day.getSeconds();return n<10&&(n="0"+n),e+":"+t+":"+n}}]),e}(),oi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"_webrtcDesc",value:function(){return this.webrtc,this.webrtc.getRtcId()}}]),n}(ii),si=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" : Network chanage ("+this.preIp+" -> "+this.nowIp+")."}}]),n}(ii),ai=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){var e=this.execTime()+" WSClose: Websocket close ("+(this.retry||0)+").";return this.online||(e+=" offline."),this.event&&(e+=" wscode: "+this.event.code),this.cause&&(e+=" cause: "+this.cause.message),this.url&&(e+=" url: "+this.url),e+=" retry: "+(this.retry||0),this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}]),n}(ii),ci=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){var e=this.execTime()+" WSError: Websocket error. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState)+". online = "+this.online;return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),this.url&&(e+=" url: "+this.url),e}}]),n}(ii),ui=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){var e=this.execTime()+" WSConnected: Websocket success. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState);return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}]),n}(ii),di=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICEChanage: "+this._webrtcDesc()+" state: "+this.state}}]),n}(oi),li=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" AddIceCandError: "+this._webrtcDesc()+", add cand error"}}]),n}(oi),fi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICEConnectFail: "+this._webrtcDesc()+" failed"}}]),n}(oi),pi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICEConnected: "+this._webrtcDesc()+" connected"}}]),n}(oi),hi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICEDisconnected: "+this._webrtcDesc()+" disconnected"}}]),n}(oi),mi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICEClosed: "+this._webrtcDesc()+" closed"}}]),n}(oi),vi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ICERemoteMediaStream: "+this._webrtcDesc()+" got remote stream"}}]),n}(oi),_i=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" StreamState:  stream "+this.stream.id+" state: "+this.state+" "+this.msg}},{key:"iceFail",value:function(){this.state=1,this.msg="network anomaly. media lost"}}]),n}(ii),gi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" OpenMediaError:  open media error. caused by "+(this.event.name?this.event.name:this.event.message?this.event.message:this.event.toString())}}]),n}(ii),yi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.self?"hangup id = "+(this.self.id||"--")+" reason："+(this.reason||0):this.execTime()+" Hangup: "+(this.parnter&&(this.parnter.name||this.parnter.id||" ")||"")+" hangup, reason："+(this.reason||0)}}]),n}(ii),bi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" ServerRefuseEnter: server refuse, cause："+this.failed+", msg:"+(this.msg||"")}}]),n}(ii),Si=function(e){Qr(n,e);var t=ri(n);function n(e){var r;return s(this,n),(r=t.call(this,e)).day=new Date,r.failed=r.response.result,r.msg=r.response.msg||r.response.message||"--",r}return u(n,[{key:"message",value:function(){return this.execTime()+" RspFail: "+this.request.tsxId+", "+(this.response.sessId||"--")+" op: "+this.request.op+", cause: "+this.failed+" "+this.msg}}]),n}(ii),Ci=function(e){Qr(n,e);var t=ri(n);function n(e){var r;return s(this,n),(r=t.call(this,e)).day=new Date,r.failed=r.response.result,r.msg=r.response.msg,r}return u(n,[{key:"message",value:function(){return this.request?this.execTime()+" RecvResponse: "+(this.request&&this.request.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.request&&this.request.op)+", cause: "+this.failed+" "+this.msg:this.execTime()+" RecvMessage: "+(this.response&&this.response.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.response&&this.response.op)+" "+this.msg}}]),n}(ii),wi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" EnterFail: enter fail："+(this.cause?this.cause.message():"unkown")}}]),n}(ii),ki=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" EnterSuccess: enter success "+(this.ip?", ip = "+this.ip:"")}}]),n}(ii),Ii=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" PushSuccess: push success, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId}}]),n}(ii),xi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" PushFail: push fail, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}]),n}(ii),Ri=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" RemoteControlFail: "+(this.type||"remote control")+" fail, "+(this.stream?this.stream.id:"")+" failed = "+this.failed+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}]),n}(ii),Mi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" SubSuccess: sub success, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId}}]),n}(ii),Ti=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" SubFail: sub fail, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}]),n}(ii),Ei=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" SubFailNotSupportVCodes: sub fail, streamId = "+this.stream.id+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}]),n}(ii),Pi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" SubFailSafariNotAllowSubBeforePub: sub fail, streamId = "+this.stream.id+" cause：Safari without access to capture devices, WebKit only exposes Server Reflexive and TURN ICE candidates, which expose IPs that could already be gathered by websites."}}]),n}(ii),Ai=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" SwitchVCodes: pub streamId = "+this.stream.id}}]),n}(ii),Oi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" CurrentCalling: warn! current calling..."}}]),n}(ii),ji=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" OpenDesktopMedia: shared desktop, desktopStreamId = "+desktopStreamId}}]),n}(ii),Li=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" OpenDesktopMediaAccessDenied: shared desktop not allow"}}]),n}(ii),Di=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" other device answer, webrtc = "+this.rtcId}}]),n}(ii),Vi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" audio mixer stream not allow sub, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}]),n}(ii),Fi=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" audio mixer stream not allow only sub video, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}]),n}(ii),Ni=function(e){Qr(n,e);var t=ri(n);function n(){return s(this,n),t.apply(this,arguments)}return u(n,[{key:"message",value:function(){return this.execTime()+" audio mixer stream repeat publish"}}]),n}(ii);const Wi={__ICEEvent:oi,NetworkChanaged:si,WSClose:ai,WSError:ci,WSConnected:ui,ICEChanage:di,AddIceCandError:li,ICEConnectFail:fi,ICEConnected:pi,ICEDisconnected:hi,ICEClosed:mi,ICERemoteMediaStream:vi,StreamState:_i,OpenMediaError:gi,Hangup:yi,ServerRefuseEnter:bi,RspFail:Si,RecvResponse:Ci,EnterFail:wi,EnterSuccess:ki,PushSuccess:Ii,PushFail:xi,RemoteControlFail:Ri,SubSuccess:Mi,SubFail:Ti,SubFailNotSupportVCodes:Ei,SubFailSafariNotAllowSubBeforePub:Pi,SwitchVCodes:Ai,CurrentCalling:Oi,OpenDesktopMedia:ji,OpenDesktopMediaAccessDenied:Li,OtherDeviceAnswer:Di,AudioMixerStreamNotAllowSub:Vi,AudioMixerStreamNotAllowOnlySubVideo:Fi,AudioMixerStreamRepeatPublish:Ni};var Ui=at("Session"),Bi=0,Gi=function(){function e(){s(this,e)}return u(e,[{key:"setSessId",value:function(e){return e&&(this.sessId=e),this}},{key:"setOp",value:function(e){return e&&(this.op=e),200===e&&(this.res={type:emedia.config.clientType,ver:window._emediaVersion||emedia.config.version,agent:navigator.userAgent,ops:emedia.config.acptOps}),this}},{key:"setTsxId",value:function(e){return e&&(this.tsxId=e),this}},{key:"setTicket",value:function(e){return e&&(this.tkt=e),this}},{key:"setSdp",value:function(e){return e&&(this.sdp=e),this}},{key:"setCands",value:function(e){return e&&(this.cands=e),this}},{key:"setSubSId",value:function(e){return e&&(this.subSId=e),this}},{key:"setMemId",value:function(e){return e&&(this.memId=e),this}},{key:"setPubS",value:function(e){e&&(this.pubS=f()({},e));var t=this.pubS;return t.ext&&nt(t.ext)&&(t.ext=je()(t.ext)),t&&mt(t,(function(e,n){(nt(n)||"function"==typeof n)&&ht(t,e)})),t&&ht(t,"localStream"),t&&ht(t,"_localMediaStream"),t&&ht(t,"_webrtc"),this}},{key:"setRtcId",value:function(e){return e&&(this.rtcId=e),this}},{key:"setCver",value:function(e){return e&&(this.cver=e),this}},{key:"setEndReason",value:function(e){return e&&(this.endReason=e),this}},{key:"setNickName",value:function(e){return e&&(this.nickName=e),this}},{key:"setResource",value:function(e){return e&&(this.resource=e),this}},{key:"setReason",value:function(e){return e&&(this.reason=e),this}},{key:"setConfrId",value:function(e){return e&&(this.confrId=e),this}},{key:"setVoff",value:function(e){return void 0===e||(this.voff=e?1:0),this}},{key:"setAoff",value:function(e){return void 0===e||(this.aoff=e?1:0),this}},{key:"setFlag",value:function(e){return 0===e&&(this.flag=0),1===e&&(this.flag=1),this}},{key:"setExt",value:function(e){return e&&nt(e)&&(e=je()(e)),e&&(this.ext=e),this}}]),e}();function qi(e,t,n){var r=this;function i(e,i){try{r.onWebsocketEvent(new Wi.WSClose({url:r.thisWsUri,retry:n,online:r.online,cause:e,event:i,session:r}))}finally{t&&t(new Wi.WSClose({url:r.thisWsUri,retry:n,online:r.online,cause:e,event:i,session:r}))}}function o(e){if(r.connected(r.thisWsUri)){if(nt(e)&&!(e instanceof Gi))throw Ui.error("message not a Messages"),"message not a Messages";if(r.sessId&&e.sessId!=r.sessId)Ui.warn("self.sessId && message.sessId != self.sessId",e);else{var t=je()(e);r.thisWsUri===r._websocket.url&&r._websocket.send(t),r.thisWsUri===r._websocket.url&&Ui.debug("Done send req:",t,r._websocket.url),r.thisWsUri===r._websocket.url||Ui.debug("Donot send(url not equal): req:",t,r._websocket.url)}}else Ui.debug("current dont connect. the message = ",e)}if(r.connected(r.thisWsUri))return e&&e(r),Ui.info("Session connected. dont continue connect"),void(r.notifyNewMessage&&r.notifyNewMessage());if(r.online){r.notifyNewMessage=function(){if(r.connected(r.thisWsUri)){if(0===r._bufferedMessages.length)return;for(var e,t=[];e=r._bufferedMessages.shift();)if(e.sessId||r.sessId||200==e.op){if(200===e.op){o(e);break}r.sessId&&!e.sessId&&(e.sessId=r.sessId);var i=o(e);i&&t.push(i)}else t.push(e),Ui.warn("tmp store message, util enter success!",e);t.length>0&&Array.prototype.push.apply(r._bufferedMessages,t)}else if(0!==n&&r.online)r.connected();else{var s=f()({},r._callbacks),a=[];for(var c in s){var u=s[c];n>0&&!r.online?a.push(u):r.onMessage({op:1001,tsxId:c,result:-9527,msg:"sdk rsp fail. retry fail or online = "+r.online})}r._bufferedMessages=r._bufferedMessages||[],a.length>0&&Array.prototype.push.apply(r._bufferedMessages,a)}},Ui.info("Session begin connect.");var s=r._websocket;s&&(Ui.warn("will close. websocket state",s.readyState,s.url,r.thisWsUri),s.close(1e3));try{Ui.info("Connecting",r.thisWsUri,n),s=r._websocket=new WebSocket(r.thisWsUri)}catch(e){return Ui.warn(e),void i(e)}s.onopen=function(n){var i=this.url;if(i===r.thisWsUri)try{Ui.info("websocket connected:",i),t&&(t=null),e&&e(r),r.onWebsocketEvent(new Wi.WSConnected({event:n,session:r}))}finally{}else Ui.warn("ignore the onopen. caused by websocket url not ",r.thisWsUri,i)},s.onmessage=function(e){var t=this.url;if(t===r.thisWsUri){Ui.debug("recv data",e.data);var n=JSON.parse(e.data);n&&1001==n.op&&Ui.debug("recv message: rsp:",n),n&&1001!=n.op&&Ui.debug("recv message: evt:",n),r.onMessage(n)}else Ui.warn("ignore recv data. caused by websocket url not ",r.thisWsUri,t,e.data)},s.onclose=function(e){var t=this.url;Ui.info("Disconnected:",t,r.thisWsUri,e),t===r.thisWsUri?(r.notifyNewMessage(),1e3!==e.code&&i(void 0,e)):Ui.warn("ignore onclose. caused by websocket url not ",r.thisWsUri,t)},s.onerror=function(e){Ui.info("On error:",e),r.onWebsocketEvent(new Wi.WSError({event:e,online:r.online,session:r,url:this.url}))}}else i()}var zi=function(){function e(t){s(this,e),d(this,"_events",{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",300:"onEnter",301:"onExit",302:"onPub",303:"onUnpub",304:"onMems",204:"onClose",400:"onStreamControl",401:"onJoin",412:"onRoleUpdate",1002:"onRemoteControl",1003:"onRecvRemoteMessage"});var n=this;n._bufferedMessages=[],n._callbacks={},navigator.onLine?n.online=!0:n.online=!1,window.addEventListener("online",(function(e){n.online=!0,Ui.warn("online online online"),n.closed||n._reconnect(emedia.config.reconnect)}),!0),window.addEventListener("offline",(function(e){n.online=!1,Ui.warn("offline offline offline"),n.__checkConnectIntervalId&&clearTimeout(n.__checkConnectIntervalId),n.__retryConnectIntervalId&&clearTimeout(n.__retryConnectIntervalId),n.__retryConnectIntervalId&&delete n.__retryConnectIntervalId,n._websocket&&n._websocket.close(1e3)}),!0),Ui.info("online status = ",n.online),this.registerProps(t)}return u(e,[{key:"registerProps",value:function(e){for(var t in e)this[t]=e[t]}},{key:"_nextWsUri",value:function(){var e=this.ticket.url,t=emedia.config&&emedia.config.convertWebsocketURLOfTicket||emedia.convertWebsocketURLOfTicket;if("function"==typeof t){var n=e;e=t(e),Ui.warn(n,"--\x3e",e)}if(e.startsWith("/")){if(emedia.config.wsorigin)e=emedia.config.wsorigin+e;else{var r=window.location.href,i=r.startsWith("https")?"wss://":"ws://",o=r.indexOf("://")+3,s=r.indexOf("/",o);e=i+r.substring(o,s)+e}Ui.warn("websocket url. update. {} -> {}",this.ticket.url,e)}else emedia.config.wsorigin&&Ui.warn("emedia.config.wsorigin invalidate. causeby server url {}",e);return e.indexOf("?")>=0?e+="&"+Bi++:e+="?"+Bi++,e}},{key:"_reconnect",value:function(e){var t=this;function n(){Ui.warn("Reconnected. at ",e,t._websocket.url),t.__retryConnectIntervalId&&clearTimeout(t.__retryConnectIntervalId),t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId;var n=t.newMessage().setOp(200).setSessId(t._sessionId).setTicket(t.ticket).setNickName(t.nickName||t.ticket.memName).setResource(t.resource).setExt(t.owner.ext);t.postMessage(n,(function(e){if(0==e.result)t.onEvent(new Wi.EnterSuccess({ip:t.owner.ip})),t.owner.onMembers(e.cver,e.mems),t.owner.onStreams(e.cver,e.streams),t.notifyNewMessage();else try{t.onEvent(new Wi.EnterFail({me:t.owner,cause:new Wi.RspFail({request:n,response:e})}))}finally{-9527!==e.result&&t.onEvent(new Wi.ServerRefuseEnter({failed:e.result,msg:e.msg}))}}))}t.connect(n,(function r(i){if(e<=0)return Ui.warn("Reconnect end. but fail.",i.url,e),void(t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId);e&&(t.__retryConnectIntervalId=setTimeout((function(){t.connect(n,r,--e)}),emedia.config.reconnectDelay))}),--e)}},{key:"__checkConnect",value:function(){var e=this;e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),emedia.config.checkConnectIntervalMillis&&(e.__checkConnectIntervalId=setTimeout((function(){try{e.online&&!e.connected()&&(e.__retryConnectIntervalId&&Ui.debug("online, reconnecting..."),e.__retryConnectIntervalId||Ui.debug("online, but disconnect. will reconnect"),e.__retryConnectIntervalId||e._reconnect(emedia.config.reconnect))}finally{e.__checkConnect()}}),emedia.config.checkConnectIntervalMillis))}},{key:"connect",value:function(e,t,n){var r=this,i=r.thisWsUri=r._nextWsUri();void 0!==n&&Ui.warn("begin connect... at retry = ",n,i),qi.call(r,(function(){try{e.apply(r,arguments)}finally{r.__checkConnect()}}),(function(e){try{t.apply(r,arguments)}finally{n||e.url!==i||r.onEvent(new Wi.ServerRefuseEnter({failed:-95270,msg:"sdk reconnect fail. "+i+"|"+e.url}))}}),n)}},{key:"connected",value:function(e){var t=this;return t.online&&t._websocket&&(!e||e===t._websocket.url)&&t._websocket.readyState==WebSocket.OPEN}},{key:"onWebsocketEvent",value:function(e){this.onEvent(e)}},{key:"register",value:function(e){if("object"===v(e))for(var t in e)this.bind(t,e[t])}},{key:"bind",value:function(e,t){var n;if(!(n=this._events[e]))throw Ui.error("Not supported event = ",e),"Not supported event = "+e;this[n]=t}},{key:"getSessionId",value:function(){return this._sessionId}},{key:"newMessage",value:function(e){return new Gi(e)}},{key:"__modifyMessage",value:function(e){if(e&&e.sdp&&("string"==typeof e.sdp&&(e.sdp=JSON.parse(e.sdp)),e.sdp.type&&(e.sdp.type=e.sdp.type.toLowerCase()),e.cctx&&(e.sdp.cctx=e.cctx)),e&&e.cands){"string"==typeof e.cands&&(e.cands=JSON.parse(e.cands));for(var t=0;t<e.cands.length;t++)"string"==typeof e.cands[t]&&(e.cands[t]=JSON.parse(e.cands[t])),e.cands[t].sdpMLineIndex=e.cands[t].mlineindex,e.cands[t].sdpMid=e.cands[t].mid,delete e.cands[t].mlineindex,delete e.cands[t].mid,e.cctx&&(e.cands[t].cctx=e.cctx)}if(e&&e.mems){if(!dt()(e.mems))return;var n=e.mems;e.mems={},mt(n,(function(t,n){n.name&&(n.memName=n.name),e.mems[n.id]=n;var r=n.acptOps={};if(mt(emedia.config.baseAcptOps,(function(e,t){r[t]=!0})),n.res&&mt(n.res.ops,(function(e,t){r[t]=!0})),n&&n.ext)try{e.mems[n.id].ext=JSON.parse(n.ext)}catch(e){Ui.debug(e)}}))}if(e&&e.mem){e.mem.name&&(e.mem.memName=e.mem.name);var r=e.mem.acptOps={};if(mt(emedia.config.baseAcptOps,(function(e,t){r[t]=!0})),e.mem.res&&mt(e.mem.res.ops,(function(e,t){r[t]=!0})),e.mem&&e.mem.ext)try{e.mem.ext=JSON.parse(e.mem.ext)}catch(e){Ui.debug(e)}}if(e&&e.streams){if(!dt()(e.streams))return;var i=e.streams;e.streams={},mt(i,(function(t,n){if(e.streams[n.id]=n,n&&n.ext)try{e.streams[n.id].ext=JSON.parse(n.ext)}catch(e){Ui.debug(e)}}))}if(e&&e.pubS&&e.pubS&&e.pubS.ext)try{e.pubS.ext=JSON.parse(e.pubS.ext)}catch(e){Ui.debug(e)}if(e&&e.ext)try{e.ext=JSON.parse(e.ext)}catch(e){Ui.debug(e)}return e}},{key:"onMessage",value:function(e){var t=this;function n(e){var n,r=e.op;(n=t._events[r])&&(n=t[n])?n.call(t,e):Ui.warn("Not supported event = ",e)}if(1001!=e.op&&!e.sessId)throw Ui.error("message sessId error. server evt data error"),"message sessId error. server evt data error";if(1001!=e.op&&t._sessionId&&t._sessionId!=e.sessId)throw Ui.error("message sessId error. server and local not equal"),"message sessId error. server and local not equal";if(1004!==e.op){var r;e=t.__modifyMessage(e);var i=ht(t._callbacks,e.tsxId);if(i&&200===i.op){t._sessionId=e.sessId;var o="string"==typeof e.yourIp?e.yourIp:void 0;if("string"==typeof t._session_ip&&o!=t._session_ip&&(r=t._session_ip),Ui.info(t._sessionId,"ip is",o,r),t._session_ip=o,t.owner.ip=o,0===e.result){for(var s in t._bufferedMessages){var a=t._bufferedMessages[s];a.sessId||200===a.op||(a.sessId=e.sessId)}setTimeout((function(){t.notifyNewMessage()}),100)}else for(var c;c=t._bufferedMessages.shift();)200!==c.op&&t.onMessage({op:1001,tsxId:c.tsxId,result:-9527,msg:"sdk enter fail. sdk callback. enter result = "+e.result})}if(t.owner&&t.owner.closed)Ui.warn("self closed. me is "+t.owner.getMemberId()+", session_id = "+t.getSessionId()+". drop message",e);else{if(t.onEvent(new Wi.RecvResponse({request:i,response:e})),i&&i.__callback__&&1004!==e.op)return i.__callback__(e),void(r&&t.onWebsocketEvent(new Wi.NetworkChanaged({preIp:r,nowIp:t._session_ip})));e.op&&1001!=e.op?(n(e),r&&t.onWebsocketEvent(new Wi.NetworkChanaged({preIp:r,nowIp:t._session_ip}))):Ui.debug("Igron message. caused by op not found.",e)}}else n(e)}},{key:"__modifyMessageForPost",value:function(e){if(e.cands){for(var t=[],n=e.cands,r=0;r<n.length;r++){var i;0==r&&n[r].cctx&&(e.cctx=n[r].cctx),i="string"==typeof n[r]?{type:"candidate",candidate:n[r],mlineindex:0,mid:"audio"}:{type:"candidate",candidate:n[r].candidate,mlineindex:n[r].sdpMLineIndex,mid:n[r].sdpMid},t.push(je()(i))}e.cands=t}if(e.sdp&&"string"!=typeof e.sdp){var o={type:e.sdp.type,sdp:e.sdp.sdp};e.sdp.cctx&&(e.cctx=e.sdp.cctx),e.sdp=o,e.sdp.type=e.sdp.type.toUpperCase(),e.sdp=je()(e.sdp)}return e.pubS&&ht(e.pubS,"_located"),e.pubS&&ht(e.pubS,"mutedMuted"),e.pubS&&ht(e.pubS,"mediaStream"),e.pubS&&ht(e.pubS,"isRepublished"),e.pubS&&ht(e.pubS,"optimalVideoCodecs"),"function"==typeof e.post&&ht(e,"post"),e}},{key:"postMessage",value:function(e,t,n){var r=this,i=emedia.__session_globalCount=0;if(e.tsxId||(e.tsxId="MSG"+Hr()()+"-"+i++),e.memId){var o=r.owner._cacheMembers[e.memId];if(!o)return Ui.warn("Member not found at local. memberId = "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not found at local. memberId = "+e.memId}));var s=e._reqOps;for(var a in s||(s=[]).push(e.op),s){var c=s[a];if(!o.acptOps[c])return Ui.warn("Member not accept op "+c+", "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not accept op "+c+", "+e.memId}))}}if(ht(e,"_reqOps"),r._sessionId&&r._sessionId!=e.sessId)return Ui.warn("sessionId not excepted. self._sessionId = "+r._sessionId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"sessionId not excepted."}));if(r.closed)return Ui.warn("session closed.",e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"session closed"}));var u=f()({},e);if(!(e=r.__modifyMessageForPost(e)))return Ui.warn("Message drop. callback success.",e),void(t&&t({op:1001,tsxId:u.tsxId,result:0,msg:"Message drop. callback success."}));200===e.op?(r._bufferedMessages.unshift(e),t&&setTimeout((function(){r._callbacks[e.tsxId]&&(Ui.error("Enter timeout. fail."),r.onMessage({op:1001,tsxId:e.tsxId,result:-9527,msg:"enter timeout. millis = "+emedia.config.enterTimeout}))}),emedia.config.enterTimeout)):r._bufferedMessages.push(e),t&&(r._callbacks[e.tsxId]=f()(e,{__callback__:t.bind(r.owner)})),r.notifyNewMessage&&r.notifyNewMessage(),n&&t&&setTimeout((function(){var e=r._callbacks[e.tsxId];e&&e.__callback__&&e.__callback__({op:1001,tsxId:u.tsxId,result:-408,msg:"Message request timeout."}),ht(r._callbacks,e.tsxId)}),n)}},{key:"close",value:function(e){Ui.warn("sessiong closing, reason = ",e);var t=this;t.notifyNewMessage&&t.notifyNewMessage(),t.closed=!0,t.seqno=0,t._websocket&&(0==e||100==e?t._websocket.close(1e3):t._websocket.close()),t.__retryConnectIntervalId&&clearTimeout(t.__retryConnectIntervalId),t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId,t.__checkConnectIntervalId&&clearTimeout(t.__checkConnectIntervalId),t.__checkConnectIntervalId&&delete t.__checkConnectIntervalId,t.owner=null,t._bufferedMessages=[],t._callbacks={},Ui.warn("session closed")}}]),e}();function Hi(e){this.context=e,this.instant=0,this.slow=0,this.clip=0,this.script=e.createScriptProcessor(2048,1,1);var t=this;this.script.onaudioprocess=function(e){var n,r=e.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=r[n]*r[n],Math.abs(r[n])>.99&&(o+=1);t.instant=Math.sqrt(i/r.length),t.slow=.95*t.slow+.05*t.instant,t.clip=o/r.length}}Hi.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(e){console.error(e),void 0!==t&&t(e)}},Hi.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()};const Ji=Hi;emedia.subscribed=function(e){return!(!e._located&&(2===e.type?e._located||!e._webrtc:void 0===e._webrtc))};var $i=function(){function e(t){var n=this;s(this,e),d(this,"voff",0),d(this,"aoff",0);var r=t.__audioContext,i=t._mediaStream;if(this.__audioContext=r,this._mediaStream=i,!this._mediaStream)throw _logger.error("_mediaStream empty"),"_mediaStream empty";if(this.hasEnabledTracks(this._mediaStream)){if(!this.__audioContext)throw _logger.error("require audioContext"),"require audioContext";this.__soundMeter=new Ji(this.__audioContext),this.__soundMeter.connectToSource(this._mediaStream,(function(e){if(e)throw e;n.__worked=n.__soundMeter.__worked=!0}))}}return u(e,[{key:"hasEnabledTracks",value:function(e){return emedia.hasEnabledTracks(e)}},{key:"getSoundMeters",value:function(){if(this.__soundMeter&&this.__worked)if(this._mediaStream.active){if(this.hasEnabledTracks(this._mediaStream))return{instant:this.__soundMeter.instant,slow:this.__soundMeter.slow,clip:this.__soundMeter.clip}}else this.__worked&&this._finally()}},{key:"_finally",value:function(){this.__soundMeter&&(this.__soundMeter.stop(),this.__worked=this.__soundMeter.__worked=!1)}}]),e}(),Yi=ft.prototypeExtend({__undefinedEQDelete:!0,located:function(){return this._located||!1},webrtc:function(e){return e&&(this._webrtc=e),this},getMediaStream:function(){return void 0!==this.mediaStream?this.mediaStream:this._located?this._localMediaStream:this._webrtc&&(this._webrtc.getRemoteStream()||this._webrtc.getLocalStream())},requestFrame:function(){this._localMediaStream&&this._localMediaStream.getVideoTracks().forEach((function(e){"function"==typeof e.requestFrame&&e.requestFrame()}))},getLocalMediaStream:function(){return this._localMediaStream},getRemoteMediaStream:function(){if(this._webrtc&&void 0!==this._webrtc.getRemoteStream())return this._webrtc.getRemoteStream()},mutedNeed:function(){return this.mutedMuted||!1},ifMediaStream:function(e){void 0===this.mediaStream?this._located&&void 0!==this._localMediaStream?e(this._localMediaStream):this._located||!this._webrtc||void 0===this._webrtc.getRemoteStream()||e(this._webrtc.getRemoteStream()):e(this.mediaStream)},subscribed:function(){return emedia.subscribed(this)},updateAttributes:function(){for(var e=this,t=0;t<arguments.length;t++){var n=arguments[t];if(nt(n))for(var r in n){var i=n[r];e[r]=i}}},getHtmlDOMID:function(){return"_m_"+this.owner.id+"_s_"+this.id},MediaSoundMeter:$i,StreamSoundMeter:ft.prototypeExtend({__init__:function(){var e=this;if(!e._stream||"function"!=typeof e._stream.getMediaStream)throw _logger.error("_stream empty or not found method getMediaStream"),"_stream empty or not found method getMediaStream";if(e._streamId=e._stream.id,e._streamCreateId=e._stream.__create_id,e._mediaStream=e._mediaStream,2===e._stream.type&&!e._stream.located()&&!e._webrtc)throw _logger.error("require webrtc. when type = 2 and not located"),"require webrtc. when type = 2 and not located";e.__mediaSoundMeter=e.__mediaSoundMeter||new $i({__audioContext:e.__audioContext,_mediaStream:e._mediaStream}),e.__mediaSoundMeter.useCount=(e.__mediaSoundMeter.useCount||0)+1},onSoundMeters:function(e){var t=this,n={instant:0,slow:0,clip:0};if(t._stream.aoff)return t._finally(),e(n),n;if(2!==t._stream.type&&t._stream.subArgs&&void 0!==t._stream.subArgs.subSAudio&&!t._stream.subArgs.subSAudio)return t._finally(),e(n),n;if(0==t._stream.id||2===t._stream.type&&!t._stream.located()&&(!t._stream.subArgs||!t._stream.subArgs.subSAudio)){var r,i=t._webrtc.getReceiversOfPeerConnection();if(!i||0===i.length)return e(n),n;for(var o in i)"audio"===i[o].track.kind&&(r=i[o]);if(!r)return e(n),n;if("function"==typeof r.getContributingSources){var s,a=r.getContributingSources();if(emedia.config._printSoundData&&ct.debug(t._stream.id,t._stream.csrc,"rtpContributingSources ",a),!a||0===a.length)return e(n),n;for(var o in a)a[o].source==t._stream.csrc&&(s=t._stream.csrc);if(emedia.config._printSoundData&&ct.debug(t._stream.id,t._stream.csrc,"source ",s),void 0===s)return e(n),n}}var c=t.__mediaSoundMeter.getSoundMeters()||n,u=2===t._stream.type?t._webrtc:t._stream._webrtc;(emedia.meterWithTrackAudioLevel||0===c.instant)&&u&&!u.closed&&u._rtcPeerConnection&&u._rtcPeerConnection.getStats().then((function(t){t.size>0&&t.forEach((function(t){"track"!==t.type||"audio"!==t.kind&&"audio"!==t.trackIdentifier||(c.trackAudioLevel=t.audioLevel,c.trackTotalAudioEnergy=t.totalAudioEnergy,e(c))}))})),e(c)},_finally:function(){var e=this;2===e._stream.type&&e._stream.located()&&e._remoteMediaSoundMeters&&e._remoteMediaSoundMeters._finally(),e.__mediaSoundMeter.useCount--,0===e.__mediaSoundMeter.useCount&&e.__mediaSoundMeter._finally()}})}),Xi=function(){function e(t){s(this,e);var n=t.aoff,r=t.voff,i=t._stream,o=t.mediaStream;this.aoff=n,this.voff=r,this._stream=i,this.mediaStream=o}return u(e,[{key:"ifAoff",value:function(e){this.if("aoff",e)}},{key:"ifVoff",value:function(e){this.if("voff",e)}},{key:"ifMediaStream",value:function(e){this.if("mediaStream",e)}},{key:"if",value:function(e,t){void 0!==this[e]&&t(this[e])}}]),e}();const Ki=Yi;var Qi=at("Handler");const Zi=function(){function e(t){var n=this;s(this,e),d(this,"handleEvent",(function(e){var t=n;if(e instanceof Wi.RecvResponse)t._onRecvResponse(e);else if(e instanceof Wi.ServerRefuseEnter)Qi.warn("Server refuse, ",e.failed,e.msg),t.onServerRefuseEnter(e);else if(e instanceof Wi.NetworkChanaged)Qi.warn("Network chanaged, ",e.preIp,e.nowIp),t.onNetworkChanaged(e);else if(e instanceof Wi.EnterFail)Qi.warn("Enter fail, result = ",e.failed),t.onEnterFail();else if(e instanceof Wi.WSClose)t.onWSClose();else if(e instanceof Wi.WSConnected)Qi.warn("Websocket connected");else if(e instanceof Wi.ICEConnected){var r=e.webrtc;t.onICEConnected(r)}else if(e instanceof Wi.ICEConnectFail)r=e.webrtc,t.onICEConnectFail(r);else if(e instanceof Wi.ICEDisconnected)r=e.webrtc,t.onICEDisconnected(r);else if(e instanceof Wi.ICEClosed)r=e.webrtc,t.onICEClosed(r);else if(e instanceof Wi.ICERemoteMediaStream)t.onICERemoteMediaStream(e.webrtc);else if(e instanceof Wi.PushSuccess){t.context._cacheStreams[e.stream.id]=t.context._linkedStreams[e.stream.id]=e.stream;var i=t.context.newStream(e.stream);if(e.hidden&&!t.context._maybeNotExistStreams[e.stream.id]&&!i.isRepublished)return void t.context._onAddStream(i);emedia._yetGetUserMedia=!0;try{var o=new Xi({voff:i.voff,aoff:i.aoff,mediaStream:i.getMediaStream()});!0!==e.hidden&&i&&t.context.onUpdateStream(i,o)}finally{Me&&mt(t.context._cacheStreams,(function(e,n){!0===n._autoSubWhenPushStream&&(ht(n,"_autoSubWhenPushStream"),t.context.createWebrtcAndSubscribeStream(n.id))}))}}else if(e instanceof Wi.SubSuccess)t.context._linkedStreams[e.stream.id]=e.stream,e.stream.updateAttributes({_zoom:1});else if(e instanceof Wi.PushFail){if(!0!==e.hidden){var s=ht(t.context._linkedStreams,e.stream.id);Qi.warn("PushFail remove from _linkedStreams",e.stream.id,s),s&&(i=t.context.newStream(e.stream),t.context.onRemoveStream(i))}}else if(e instanceof Wi.SubFail)!0!==e.hidden&&(ht(t.context._linkedStreams,e.stream.id),Qi.warn("SubFail remove from _linkedStreams",e.stream.id),(i=t.context.newStream(e.stream)).updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0}),t.context.onUpdateStream(i,new Xi(i)));else if(e instanceof Wi.SubFailNotSupportVCodes){var a=e.stream;Qi.warn("Rtc donot support pub VCodes. close. sub fail.",a.rtcId," -> ",a.id);try{t.onNotSupportPublishVideoCodecs&&t.onNotSupportPublishVideoCodecs(a)}catch(e){Qi.warn(e)}}else if(e instanceof Wi.EnterSuccess)t.onEnterSuccess();else if(e instanceof Wi.SwitchVCodes){a=e.stream;var c,u=e.useVCodes;if(r=a._webrtc,Qi.warn("Rtc switch VCodes. ",a.id,u),u&&0!=u.length||Qi.warn("Rtc switch VCodes. error! useVCodes is empty ",a.id,u),emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(c=emedia.config.forceUseVideoCodecs,dt()(c)||(c=[]).push(emedia.config.forceUseVideoCodecs)),c){if("string"==typeof c&&c!==u[0])return void Qi.warn("Rtc switch VCodes. igrone . useVCodes !== forceUseVideoCodecs ",a.id,r._rtcId,u,c);if(dt()(c)&&c[0]!==u[0])return void Qi.warn("Rtc switch VCodes. igrone ddd . useVCodes == forceUseVideoCodecs ",a.id,r._rtcId,u,c)}if(r&&r.optimalVideoCodecs){if("string"==typeof r.optimalVideoCodecs&&r.optimalVideoCodecs==u[0])return void Qi.warn("Rtc switch VCodes. igrone . useVCodes == optimalVideoCodecs ",a.id,r._rtcId,u);if(dt()(r.optimalVideoCodecs)&&r.optimalVideoCodecs.length>0&&r.optimalVideoCodecs[0]==u[0])return void Qi.warn("Rtc switch VCodes. igrone ddd . useVCodes == optimalVideoCodecs ",a.id,r._rtcId,u)}a.updateAttributes({optimalVideoCodecs:u}),r&&t.context.closeWebrtc(r.getRtcId(),!0),setTimeout((function(){a.updateAttributes({iceRebuildCount:1}),t.iceRebuild(a),Qi.warn("Rtc switch VCodes. iceRebuild end.",a.id,u)}),300)}})),this.onEvent=this.onEvent.bind(this),this.context=t}return u(e,[{key:"onEvent",value:function(e){var t=this;function n(){try{t.handleEvent(e)}catch(e){Qi.warn(e)}}if(e&&Qi.info("[EVT]",e.message(),e.hidden||""),e instanceof Wi.ServerRefuseEnter&&e.failed&&-95270===e.failed&&(e.failed=-9527),e instanceof emedia.event.StreamState&&e.stream&&e.stream.located())n();else try{e.hidden||t.onNotifyEvent&&t.onNotifyEvent(e)}finally{n()}}},{key:"_onRecvResponse",value:function(e){var t=this,n=e.request,r=e.response;if(n&&r&&200!==n.op&&1002!==n.op&&0!==r.result){Qi.warn("Server refuse. when request = ",n);var i=e.failed;switch(i){case-9527:case-95270:break;case-500:case-502:case-504:case-508:case-510:t.context.close(4,i);break;case-506:case-501:t.context.close(11,i)}}}},{key:"onServerRefuseEnter",value:function(e){var t=this,n=e.failed;switch(n){case-9527:case-95270:t.context.close(4,-9527);break;case-500:case-502:case-504:case-508:case-510:t.context.close(4,n);break;case-506:t.context.close(11,n);break;default:t.context.close(2)}}},{key:"onEnterFail",value:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval)}},{key:"onNetworkChanaged",value:function(e){var t=this,n=e.nowIp;emedia.config.rebuildPeerConnectionWhenNetworkChanaged&&setTimeout((function(){var e={};mt(t.context._cacheStreams,(function(r,i){if(!t.context._maybeNotExistStreams[r]&&i._webrtc){var o=i._webrtc;e[i.rtcId]||(o.closed||"string"!=typeof o.useIp||o.useIp===n||(Qi.warn("network chanage. webrtc will rebuild.",o._rtcId,o.__id),t.onICEClosed(o)),e[i.rtcId]=!0)}}))}),100)}},{key:"onEnterSuccess",value:function(){var e=this;setTimeout((function(){e._failIcesRebuild()}),50),e.context.getCopyIntervalMillis&&e.context.getCopyIntervalMillis>0&&(Qi.warn("Run interval get copy. interval = ",e.context.getCopyIntervalMillis),e.__getCopyInterval&&clearInterval(e.__getCopyInterval),e.__getCopyInterval=setInterval((function(){e.context._session.connected()?e._sysCopy.apply(e):(Qi.warn("Warn! cannot get copy. cause offline."),e.__getCopyInterval&&clearInterval(e.__getCopyInterval))}),e.context.getCopyIntervalMillis)),e.context.getMediaMeterIntervalMillis&&e.context.getMediaMeterIntervalMillis>0&&e._intervalGetMediaMeters()}},{key:"_intervalGetMediaMeters",value:function(){var e=this;!function t(){e.__getMediaMetersIntervalFlag&&emedia.cancelAnimationFrame(e.__getMediaMetersIntervalFlag),e.context.getMediaMeterIntervalMillis?e.__getMediaMetersIntervalFlag=emedia.requestAnimationFrame((function(n){"function"==typeof Ee&&e._flushMediaMetersByAudioContext.apply(e),!1===e.context.closed&&t()}),e.context.getMediaMeterIntervalMillis):Qi.warn("Ontalking closed. please use getMediaMeterIntervalMillis")}()}},{key:"_flushMediaMetersByAudioContext",value:function(){var e=this;mt(e.context._cacheStreams,(function(t,n){e.context._monitSoundChanagedStreams&&!e.context._monitSoundChanagedStreams[t]||"0"!=n.id&&e._updateMetersOrNewOne.call(e,t,n)}));var t=[];mt(e.context._mediaMeters,(function(n,r){var i=e.context._cacheStreams[n];i&&e._updateMetersOrNewOne.call(e,n,i),i||t.push(n)})),mt(t,(function(t,n){ht(e.context._mediaMeters,n)}))}},{key:"_updateMetersOrNewOne",value:function(e,t){var n=this,r=n.context._mediaMeters[e];if(!(2!==t.type||t.located()||t.subArgs&&t.subArgs.subSAudio)){var i=n._oneAudioMixers();if(!i||r&&r._webrtc&&i._webrtc.__id!=r._webrtc.__id)return r&&r._finally(),ht(n.context._mediaMeters,e),void n.context._onSoundChanage(t.owner,t)}return r&&r._streamCreateId===t.__create_id&&r.__mediaSoundMeter.__worked?(r.onSoundMeters((function(e){n.context._onSoundChanage(t.owner,t,e)})),r):(r&&(r._streamCreateId!==t.__create_id||r.__mediaSoundMeter.__worked)&&(r&&r._finally(),ht(n.context._mediaMeters,e),n.context._onSoundChanage(t.owner,t)),t.aoff?void 0:((r=n._newMediaMeters(t))&&(n.context._mediaMeters[e]&&n.context._mediaMeters[e]._finally(),n.context._mediaMeters[e]=r),r))}},{key:"_newAudioContext",value:function(){if(emedia.__usingWebAudio)return emedia.__audioContext}},{key:"_newMediaMeters",value:function(e){var t,n=this;if(2===e.type&&e.subArgs&&e.subArgs.subSAudio&&e._webrtc&&e._webrtc.getRemoteStream())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._webrtc.getRemoteStream(),_webrtc:e._webrtc,__audioContext:n._newAudioContext()});if(2===e.type&&e.located())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._localMediaStream,__audioContext:n._newAudioContext()});if(2===e.type&&!e.located()){var r=n._oneAudioMixers();if(!r||!r._webrtc||r._webrtc.closed)return;if(r&&(void 0===r._remoteMediaSoundMeters||!r._remoteMediaSoundMeters.__worked)&&r._webrtc&&r._webrtc.getRemoteStream()&&(r._remoteMediaSoundMeters=new r.MediaSoundMeter({_mediaStream:r._webrtc.getRemoteStream(),__audioContext:n._newAudioContext()})),!r._remoteMediaSoundMeters)return;return new e.StreamSoundMeter({_stream:e,_webrtc:r._webrtc,__mediaSoundMeter:r._remoteMediaSoundMeters})}return!e.aoff&&(t=e.getMediaStream())?new e.StreamSoundMeter({_stream:e,_mediaStream:t,__audioContext:n._newAudioContext()}):void 0}},{key:"_oneAudioMixers",value:function(){var e=this,t=e.context._cacheStreams[0];if(t&&t._webrtc&&!t._webrtc.closed)return t;for(var n in e.context.audioMixers){var r=e.context.audioMixers[n];if(r.located())return r}}},{key:"onWSClose",value:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval),Qi.info("Websocket closed.")}},{key:"onICEDisconnected",value:function(e){var t=this;t.__networkWeakInterval&&clearTimeout(t.__networkWeakInterval),t.__networkWeakInterval=setTimeout((function(){t.onNetworkWeak&&t.onNetworkWeak()}),1e3),mt(t.context._linkedStreams,(function(n,r){r.rtcId==e.getRtcId()&&(t.context._maybeNotExistStreams[n]||(t.context._maybeNotExistStreams[n]=f()({},r)).updateAttributes({iceRebuildCount:1}),Qi.info("Stream maybe not exist. caused by disconnected",r.id))}))}},{key:"onICEConnectFail",value:function(e){var t=this;for(var n in t.context._linkedStreams){var r=t.context._linkedStreams[n];if(r.rtcId==e.getRtcId()){if(r._webrtc&&r._webrtc.__id!==e.__id){Qi.warn("Stream use other webrtc rtcId = ",r.rtcId,", id: ",r._webrtc.__id,e.__id);continue}var i;if((i=t.context._maybeNotExistStreams[n])||(i=t.context._maybeNotExistStreams[n]=f()({},r)).updateAttributes({iceRebuildCount:1}),i){var o=new Wi.StreamState({stream:i});o.iceFail(),t.onEvent(o)}if(Qi.info("ice fail. webrtc = ",e.getRtcId()," problem stream is ",i.iceRebuildCount,i.id),i.iceRebuildCount>emedia.config.iceRebuildCount)Qi.info("ice fail. webrtc = ",e.getRtcId()," rebuild fail. problem stream is ",i.id),i.located()?t.onEvent(new Wi.PushFail({stream:r,cause:"pub ice rebuild failed."})):t.onEvent(new Wi.SubFail({stream:r,cause:"sub ice rebuild failed."})),t.context.closeWebrtc(e.getRtcId(),!1);else{var s=t.context._records[i.id];i._localMediaStream?Qi.info("ice fail. webrtc = ",e.getRtcId()," will rebuild. remain local stream. ",i.id):Qi.info("ice fail. webrtc = ",e.getRtcId()," will rebuild.",i.id),t.context.closeWebrtc(e.getRtcId(),!0),s&&(t.context._records[i.id]=s),function(e){setTimeout((function(){t.iceRebuild(e)}),emedia.config.iceRebuildIntervalMillis)}(i),Qi.info("ice fail. webrtc = ",e.getRtcId()," will rebuilding. problem stream is ",i.id)}2===r.type&&ht(t.context.audioMixers,r.id)}}}},{key:"onICEClosed",value:function(e){var t=this;if(e.closed){Qi.warn("Webrtc will be removed. by __id = ",e.__id,", rtcId = ",e.getRtcId());var n=ht(t.context._ices,e.__id);n?Qi.warn("Webrtc removed. by id = ",n.__id,", rtcId = ",n.getRtcId()):Qi.warn("Webrtc removed. by id = ",e.__id,", rtcId = ",e.getRtcId());var r=t.context._ices[e.getRtcId()];r&&r.__id===n.__id&&(n=ht(t.context._ices,e.getRtcId()),Qi.warn("Webrtc removed. by rtcId = ",n.getRtcId(),", __id = ",n.__id))}else Qi.info("ICE self closed. not allow. will rebuild",e.getRtcId()),t.onICEConnectFail(e)}},{key:"onICEConnected",value:function(e){var t=this;mt(t.context._cacheStreams,(function(n,r){if(r.rtcId==e.getRtcId()){if(r.updateAttributes({finalVCodeChoices:e.finalVCodeChoices}),t.context._maybeNotExistStreams[n]){ht(t.context._maybeNotExistStreams,r.id),t.context._linkedStreams[n]=r,Qi.info("ice reconnected. webrtc = ",e.getRtcId(),"will update stream = ",r.id);var i=t.context._records[r.id];i&&i.rtcId!==r.rtcId&&(t.context.startRecord(r),Qi.warn("Re record. for ",r.id,", after rebuild ice.",i.rtcId,"->",r.rtcId))}else Qi.info("ice connected. webrtc = ",e.getRtcId(),r.id),r.located()&&t.onEvent(new Wi.PushSuccess({stream:r})),r.located()||t.onEvent(new Wi.SubSuccess({stream:r}));2===r.type&&(t.context.audioMixers[r.id]=r)}}))}},{key:"onICERemoteMediaStream",value:function(e){var t=this;mt(t.context._cacheStreams,(function(n,r){if(r.rtcId==e.getRtcId()&&(!r.located()||2===r.type)){var i=e.getRemoteStream();t.context._updateRemoteStream(r,i),r.onGotRemoteMediaStream?r.onGotRemoteMediaStream.call(r,i):((r=t.context.newStream(r)).updateAttributes({mediaStream:e.getRemoteStream()}),t.context.onUpdateStream(r,new Xi({mediaStream:r.mediaStream})))}}))}},{key:"_failIcesRebuild",value:function(){var e=this;mt(e.context._maybeNotExistStreams,(function(t,n){setTimeout((function(){e.iceRebuild(n)}),100)}))}},{key:"iceRebuild",value:function(e){var t=this;return t.context.connected()?t.context._linkedStreams[e.id]&&t.context._cacheStreams[e.id]?void(e.iceRebuildCount>emedia.config.iceRebuildCount?(Qi.info("ice rebuild fail. count too many. stream is ",e.id),e.located()?t.onEvent(new Wi.PushFail({stream:e,cause:"pub ice rebuild failed."})):t.onEvent(new Wi.SubFail({stream:e,cause:"sub ice rebuild failed."}))):t.context.connected()?(Qi.info("ice try rebuild. count",e.iceRebuildCount,". stream is ",e.id),t.rebuildIce(e),e.iceRebuildCount++):Qi.warn("ice rebuild. stop. cause by not websocket disconnect",e.id)):(Qi.info("ice rebuild fail. it yet closed. stream is ",e.id,e.rtcId),ht(t.context._maybeNotExistStreams,e.id),ht(t.context._linkedStreams,e.id),void Qi.warn("iceRebuild, remvoe from _linkedStreams",e.id)):(e.updateAttributes({iceRebuildCount:1}),void Qi.warn("Websocket disconnect. waiting. rebuild count reset",e.iceRebuildCount,e.id))}},{key:"rebuildIce",value:function(e){var t=this;t.context._cacheStreams[e.id]?(Qi.warn("Begin rebuild ice ",e.iceRebuildCount,e.id),e.located()?(e.updateAttributes({isRepublished:!0}),t.context.push(e,void 0,void 0,!0)):t.context.createWebrtcAndSubscribeStream(e.id),Qi.warn("Finish rebuild ice ",e.iceRebuildCount,e.id,t.context._cacheStreams[e.id].rtcId)):Qi.warn("Begin rebuild ice. not found stream at local",e.iceRebuildCount,e.id)}},{key:"_sysCopy",value:function(){var e=this,t=e.context.newMessage().setOp(1e3).setCver(e.context._cver||0);e.context.postMessage(t,(function(t){0==t.result?(e.context._cver||0)<t.cver&&(e.context._cver=t.cver,e.context.onMembers(t.cver,t.mems||{}),e.context.onStreams(t.cver,t.streams||{}),Qi.info("Got copy success.")):Qi.warn("Get copy fail. result = ",t.result)}))}}]),e}();var eo=n(3929),to=n.n(eo),no=at("SDPSection"),ro={headerSection:null,audioSection:null,videoSection:null,_parseHeaderSection:function(e,t,n){var r=t;return-1===n||(r=-1===t?n:Math.min(t,n)),r>=0?e.slice(0,r):e},_parseAudioSection:function(e,t,n){var r=t;if(r>=0)return e.slice(r,n<r?e.length:n)},_parseVideoSection:function(e,t,n){var r=n;if(r>=0)return e.slice(r,t<r?e.length:t)},spiltSection:function(e){this._preSDP=e;var t=this._preAudioIndex=e.indexOf("m=audio"),n=this._preVideoIndex=e.indexOf("m=video");this.headerSection=this._parseHeaderSection(e,t,n),this.audioSection=this._parseAudioSection(e,t,n),this.videoSection=this._parseVideoSection(e,t,n)},setVideoBitrate:function(e){e&&this.videoSection&&(this.videoSection=this.setBitrate(this.videoSection,e))},setVideoMinBitrate:function(e){this.setAllFmtpBitrate({"x-google-min-bitrate":e})},setVideoMaxBitrate:function(e){this.setAllFmtpBitrate({"x-google-max-bitrate":e})},setVideoStartBitrate:function(e){this.setAllFmtpBitrate({"x-google-start-bitrate":e})},setAllFmtpBitrate:function(e){if(this.videoSection){var t={};to()(e).forEach((function(n){var r=n+"="+e[n],i=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+n+"=\\d+)(;?\\S*)","g");t[n]={field:r,regex:i}})),this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,(function(e,n,r){return n.indexOf("apt=")>=0?e:(to()(t).forEach((function(e){var r=t[e],i=r.regex,o=r.field,s=n.replace(i,(function(e,t,n,r){return t+o+r}));s.indexOf(e)<0?(s.endsWith(";")||(s+=";"),n=s+o):n=s})),n+r)}))}},setFmtpBitrate:function(e,t){if(t&&this.videoSection){var n=e+"="+t,r=new RegExp("(a=fmtp\\:\\d+\\s\\S*;?)("+e+"=\\d+)(;?\\S*)","g");this.videoSection=this.videoSection.replace(/(a=fmtp\:\d+[^\r\n]+)([\r\n]+)/g,(function(t,i,o){var s=i.replace(r,(function(e,t,r,i){return t+n+i}));return s.indexOf(e)<0&&(s.endsWith(";")||(s+=";"),s+=n),s+o}))}},setAudioBitrate:function(e){e&&this.audioSection&&(this.audioSection=this.setBitrate(this.audioSection,e))},setBitrate0:function(e,t){return(e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1AS$2"+t)).indexOf("b=AS")<0&&(e=e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b=AS:"+t+"$2")),e},setBitrate:function(e,t){var n="AS";return xe&&(t=1e3*(t>>>0),n="TIAS"),(e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1"+n+"$2"+t)).indexOf("b="+n+":")<0&&(e=e.indexOf("c=IN ")<0?e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b="+n+":"+t+"$2"):e.replace(/c=IN ([^\r\n]+)([\r\n]+)/,"c=IN $1$2b="+n+":"+t+"$2")),e},updateVideoSection:function(e,t){this.videoSection&&(this.videoSection=this.videoSection.replace(e,t))},updateAudioSection:function(e,t){this.audioSection&&(this.audioSection=this.audioSection.replace(e,t))},updateVideoSendonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"sendonly"))},updateVideoRecvonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"recvonly"))},updateAudioSendonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"sendonly"))},updateAudioRecvonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"recvonly"))},updateACodes:function(e){if(e&&this.audioSection){"string"==typeof e&&((n=[]).push(e),e=n);for(var t={},n=this._parseLine(this.audioSection,/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi),r=0;r<n.length;r++){var i=n[++r];t[n[++r]]=i}var o=[];for(r=0;r<e.length;r++){var s=t[e[r]];s&&o.push(s)}0==o.length&&(this._webrtc?no.warn("Not found acodes map",e,this._webrtc._rtcId,this._webrtc.__id):no.warn("Not found acodes map",e));var a=this.audioSection.indexOf("\r"),c=this.audioSection.substring(0,a),u=c.split(" ");Array.prototype.push.apply(o,u.slice(3));var d=[],l={};o.forEach((function(e){0==d.length?(d.push(e),l[e]=!0):l[e]||(d.push(e),l[e]=!0)})),u.splice(3,u.length-3,d.join(" ")),c=u.join(" "),this._webrtc&&no.warn(c,this._webrtc._rtcId,this._webrtc.__id),this.audioSection=c+this.audioSection.substring(a)}},updateVCodes:function(e){if(e&&this.videoSection){"string"==typeof e&&((n=[]).push(e),e=n);for(var t={},n=this._parseLine(this.videoSection,/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi),r=0;r<n.length;r++){var i=n[++r];t[n[++r]]=i}var o=this._parseLine(this.videoSection,/a=fmtp:(\d+) .*profile-level-id=42e01f;?.*/gi);o&&o.length>=2&&(t.H264=o[1]);var s=[];for(r=0;r<e.length;r++){var a=t[e[r]];a&&s.push(a)}0==s.length&&(this._webrtc?no.warn("Not found vcodes map",e,this._webrtc._rtcId,this._webrtc.__id):no.warn("Not found vcodes map",e));var c=this.videoSection.indexOf("\r"),u=this.videoSection.substring(0,c),d=u.split(" ");Array.prototype.push.apply(s,d.slice(3));var l=[],f={};s.forEach((function(e){0==l.length?(l.push(e),f[e]=!0):f[e]||(l.push(e),f[e]=!0)})),d.splice(3,d.length-3,l.join(" ")),u=d.join(" "),this._webrtc&&no.warn(u,this._webrtc._rtcId,this._webrtc.__id),this.videoSection=u+this.videoSection.substring(c)}},removeSSRC:function(e){for(var t=[],n=e.split(/a=ssrc:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},removeField_msid:function(e){for(var t=[],n=e.split(/a=msid:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);for(e=t.join("\n"),t=[],n=e.split(/[\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},updateHeaderMsidSemantic:function(e){var t="a=msid-semantic: WMS "+e,n=this.headerSection.split(/a=msid\-semantic: WMS.*/g),r=[];switch(n.length){case 1:r.push(n[0]);break;case 2:r.push(n[0]),r.push(t),r.push("\n");break;case 3:r.push(n[0]),r.push(t),r.push("\n"),r.push(n[2]),r.push("\n")}return this.headerSection=r.join("")},updateAudioSSRCSection:function(e,t,n,r){this.audioSection&&(this.audioSection=this.removeSSRC(this.audioSection)),this.audioSection&&(this.audioSection=this.removeField_msid(this.audioSection)),this.audioSection&&(this.audioSection=this.audioSection+this.ssrcSection(e,t,n,r))},updateVideoSSRCSection:function(e,t,n,r){this.videoSection&&(this.videoSection=this.removeSSRC(this.videoSection)),this.videoSection&&(this.videoSection=this.removeField_msid(this.videoSection)),this.videoSection&&(this.videoSection=this.videoSection+this.ssrcSection(e,t,n,r))},getUpdatedSDP:function(e){var t,n,r;if(void 0!==e&&null!=e||(e=this._preAudioIndex<this._preVideoIndex),this.videoSection&&this.videoSection.replace(/a=mid:([^\r\n]+)/,(function(e,n){return t=n,e})),this.audioSection&&this.audioSection.replace(/a=mid:([^\r\n]+)/,(function(e,t){return n=t,e})),e){var i=["a=group:BUNDLE"];this.audioSection&&i.push(n),this.videoSection&&i.push(t),r=this.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,i.join(" ")),this.audioSection&&(r+=this.audioSection),this.videoSection&&(r+=this.videoSection)}else i=["a=group:BUNDLE"],this.videoSection&&i.push(t),this.audioSection&&i.push(n),r=this.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,i.join(" ")),this.videoSection&&(r+=this.videoSection),this.audioSection&&(r+=this.audioSection);return r},parseMsidSemantic:function(e){var t=this._parseLine(e,/a=msid\-semantic:\s*WMS (\S+)/gi);return t&&2==t.length&&(this.msidSemantic={line:t[0],WMS:t[1]}),this.msidSemantic},ssrcSection:function(e,t,n,r){return["a=ssrc:"+e+" cname:"+t,"a=ssrc:"+e+" msid:"+n+" "+r,"a=ssrc:"+e+" mslabel:"+n,"a=ssrc:"+e+" label:"+r,""].join("\n")},parseSSRC:function(e){var t=new RegExp("a=(ssrc):(\\d+) (\\S+):(\\S+)","ig"),n=this._parseLine(e,t);if(n){for(var r={lines:[],updateSSRCSection:this.ssrcSection},i=0;i<n.length;i++){var o=n[i];if(o.indexOf("a=ssrc")>=0)r.lines.push(o);else switch(o){case"ssrc":case"cname":case"msid":case"mslabel":case"label":r[o]=n[++i]}}return r}},_parseLine:function(e,t){for(var n,r=[];null!=(n=t.exec(e));)for(var i=0;i<n.length;i++)r.push(n[i]);if(r.length>0)return r}},io=function(e,t){f()(this,ro),this._webrtc=t,this.spiltSection(e)};io.isAudioVideo=function(e){return e.indexOf("m=audio")<e.indexOf("m=video")},io.isVideoPreAudio=function(e){var t=e.indexOf("m=audio"),n=e.indexOf("m=video");return t>=0&&n>=0&&n<t};const oo=io;var so=at("Webrtc"),ao=Ce.sdp.parseRtpParameters,co=emedia.__rtc_globalCount=0,uo=function(){function e(t){s(this,e),d(this,"closed",!1),d(this,"sdpConstraints",{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}}),d(this,"optimalVideoCodecs",null),d(this,"optimalAudioCodecs",null),d(this,"offerOptions",{offerToReceiveAudio:!0,offerToReceiveVideo:!0});var n=this;n._rtcId||(n._rtcId="RTC"+co++),n.__id="_i_"+co++,n.__setRemoteSDP=!1,n.__tmpRemoteCands=[],n.__tmpLocalCands=[],n._rtcPeerConnection=null,n.cctx=n.__id,emedia&&emedia.config&&emedia.config.forceUseVideoCodecs&&emedia.config.forceUseVideoCodecs.length>0&&(n.optimalVideoCodecs=emedia.config.forceUseVideoCodecs),emedia&&emedia.config&&emedia.config.forceUseAudioCodecs&&emedia.config.forceUseAudioCodecs.length>0&&(n.optimalAudioCodecs=emedia.config.forceUseAudioCodecs),emedia&&emedia.config&&"number"==typeof emedia.config.forceVideoBitrate&&(n.vbitrate=emedia.config.forceVideoBitrate),emedia&&emedia.config&&"number"==typeof emedia.config.forceMinVideoBitrate&&(n.vminBitrate=emedia.config.forceMinVideoBitrate),emedia&&emedia.config&&"number"==typeof emedia.config.forceAudioBitrate&&(n.abitrate=emedia.config.forceAudioBitrate),so.info("Webrtc created. optimal video codecs:",n.optimalVideoCodecs,"audio codecs:",n.optimalAudioCodecs,"vbitrate:",n.vbitrate,"vminBitrate:",n.vminBitrate,"abitrate:",n.abitrate,n._rtcId,n.__id),this.registerProps(t)}return u(e,[{key:"registerProps",value:function(e){for(var t in e)this[t]=e[t]}},{key:"getRtcId",value:function(){return this._rtcId}},{key:"iceState",value:function(){return this._rtcPeerConnection.iceConnectionState}},{key:"setSubArgs",value:function(e){this.subArgs=e}},{key:"getReceiversOfPeerConnection",value:function(){var e=this;if(e._rtcPeerConnection&&"closed"!=e._rtcPeerConnection.iceConnectionState)return e._rtcPeerConnection.getReceivers()}},{key:"updateRemoteBySubArgs",value:function(){var e=this;e.subArgs&&e._remoteStream&&(emedia.enableVideoTracks(e._remoteStream,!(e.subArgs&&!1===e.subArgs.subSVideo)),emedia.enableAudioTracks(e._remoteStream,!(e.subArgs&&!1===e.subArgs.subSAudio)),so.info("enable tracks remote stream",e._remoteStream,e.subArgs,e._rtcId,e.__id,e.closed))}},{key:"createRtcPeerConnection",value:function(e){var t=this;so.debug("begin create peer connection ......",t._rtcId,t.__id,t.closed),e||(e=t.iceServerConfig),e||Te?(e||(e={}),!e.iceServers&&(e.iceServers=[]),e.rtcpMuxPolicy="require",e.bundlePolicy="max-bundle",e.relayOnly&&(e.iceTransportPolicy="relay")):e=null,emedia&&emedia.config&&"function"==typeof emedia.config.reconfigRTCConfiguration&&(e=emedia.config.reconfigRTCConfiguration(e)),so.info("create pc, set config:",e,t._rtcId,t.__id,t.closed);var n=t._rtcPeerConnection=new RTCPeerConnection(e);function r(e){so.info("states: connectionState",n.connectionState,", iceConnectionState",n.iceConnectionState,"@",t._rtcId,t.__id,t.closed);try{var r=n.iceConnectionState||n.connectionState;"failed"!=n.connectionState&&"failed"!=n.iceConnectionState||(r="failed"),t.lastIceConnectionState!==r&&(t.lastIceConnectionState=r,t.onIceStateChange(r))}finally{}}n.__peerId=t._rtcId,so.debug("created local peer connection object",n,t._rtcId),n.onicecandidate=function(e){var n=e.candidate;if("icecandidate"!=e.type||n&&("string"!=typeof n.protocol||"tcp"!==n.protocol.toLowerCase())&&!/ TCP /.test(n.candidate)){if(!n.candidate)throw so.error("Not found candidate. candidate is error"),"Not found candidate. candidate is error,";if(n.cctx=t.cctx,!t.__setRemoteSDP)return(t.__tmpLocalCands||(t.__tmpLocalCands={})).push(n),void so.debug("On ICE candidate ok: but tmp buffer caused by not set remote sdp: ",n,t._rtcId,t.__id,t.closed);so.debug("On ICE candidate ok: ",n,t._rtcId,t.__id,t.closed),t._onIceCandidate(n)}else so.debug("On ICE candidate: drop",n,t._rtcId,t.__id,t.closed)},t.lastIceConnectionState="",n.onconnectionstatechange=r.bind(t),n.onicestatechange=r.bind(t),n.oniceconnectionstatechange=r.bind(t),n.onsignalingstatechange=function(e){so.info("states: signaling",n.signalingState,"@",t._rtcId,t.__id,t.closed)},null===n.ontrack&&t._onTrack&&(n.ontrack=function(e){t._onTrack(e)}),n.onaddstream=function(e){t._onGotRemoteStream(e)}}},{key:"addTrack",value:function(e,t){var n=this;e.forEach((function(e){n._rtcPeerConnection.addTrack(e,t),so.debug("Added track(",e.id,e.kind,e.label,") of stream(",t.id,") to RtcPeerConnection",n._rtcId,n.__id,n.closed)}))}},{key:"setLocalStream",value:function(e){var t=this;if(t._localStream=e,t._rtcPeerConnection.addTrack)e.getTracks().forEach((function(n){t._rtcPeerConnection.addTrack(n,e),so.debug("Added track(",n.enabled,n.id,n.kind,n.label,") of localStream(",e.id,") to RtcPeerConnection",t._rtcId,t.__id,t.closed)}));else{t._rtcPeerConnection.addStream(e);var n=e.getVideoTracks(),r=e.getAudioTracks();n&&n.length>0&&so.debug("RtcPeerConnection video: ",n[0].enabled,n[0].id,n[0].kind,n[0].label,t._rtcId,t.__id,t.closed),r&&r.length>0&&so.debug("RtcPeerConnection audio: ",r[0].enabled,r[0].id,r[0].kind,r[0].label,t._rtcId,t.__id,t.closed)}so.debug("Added local stream to RtcPeerConnection",e.id,e.active,t._rtcId,t.__id,this.closed)}},{key:"removeStream",value:function(e){this._rtcPeerConnection.removeStream(e),so.debug("Remove stream from RtcPeerConnection",e,self._rtcId,self.__id,this.closed)}},{key:"getLocalStream",value:function(){return this._localStream}},{key:"getRemoteStream",value:function(){return this._remoteStream}},{key:"createOffer",value:function(e,t){var n=this;so.debug("createOffer start...",n.offerOptions,n._rtcId,n.__id);var r=f()({},n.offerOptions);return n.subArgs&&(r={offerToReceiveAudio:!0,offerToReceiveVideo:!0}),n._rtcPeerConnection.createOffer(r).then((function(t){if(n.offerDescription=t,Te&&(t.sdp=t.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f")),xe?n.fireFoxOfferVideoPreAudio=n.__offerVideoPreAudio=oo.isVideoPreAudio(t.sdp):n.__offerVideoPreAudio=oo.isVideoPreAudio(t.sdp),t.sdp=t.sdp.replace(/m=video 0/g,"m=video 9"),so.warn("setLocalDescription. modify offer. if 'm=video 0' -> 'm=video 9'; if H264, 'profile-level-id=42e01f'",n._rtcId,n.__id),n.optimalVideoCodecs&&n.optimalVideoCodecs.length>0||n.optimalAudioCodecs&&n.optimalAudioCodecs.length>0||n.offerOptions&&(!1===n.offerOptions.offerToReceiveVideo||!1===n.offerOptions.offerToReceiveAudio)){var r=new oo(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),n.offerOptions&&!1===n.offerOptions.offerToReceiveVideo&&r.updateVideoSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),n.offerOptions&&!1===n.offerOptions.offerToReceiveAudio&&r.updateAudioSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),t.sdp=r.getUpdatedSDP()}so.debug("setLocalDescription start",n._rtcId,n.__id,n.closed,n.optimalVideoCodecs,n.optimalAudioCodecs),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){t.cctx=n.cctx,(e||n.onCreateOfferSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,r))}},{key:"createPRAnswer",value:function(e,t){var n=this;return so.info(" createPRAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then((function(t){so.debug("_____________PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),t.type="pranswer",t.sdp=t.sdp.replace(/a=recvonly/g,"a=inactive");var r=new oo(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),t.sdp=r.getUpdatedSDP(),n.__prAnswerDescription=t,so.debug("inactive PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),so.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP(),so.debug("Send PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreatePRAnswerSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))}},{key:"createAnswer",value:function(e,t){var n=this;return so.info("createAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then((function(t){so.debug("_____________________Answer ",n._rtcId,n.__id,n.closed),t.type="answer";var r=new oo(t.sdp,n);n.optimalVideoCodecs&&r.updateVCodes(n.optimalVideoCodecs),n.optimalAudioCodecs&&r.updateACodes(n.optimalAudioCodecs),Ie?function(e){var n=e.parseMsidSemantic(e.headerSection);if(n){"*"==n.WMS&&e.updateHeaderMsidSemantic(n.WMS="MS_0000");var r=e.parseSSRC(e.audioSection),i=e.parseSSRC(e.videoSection);r&&e.updateAudioSSRCSection(1e3,"CHROME0000",n.WMS,r.label||"LABEL_AUDIO_1000"),i&&e.updateVideoSSRCSection(2e3,"CHROME0000",n.WMS,i.label||"LABEL_VIDEO_2000"),t.sdp=e.getUpdatedSDP()}}(r):t.sdp=r.getUpdatedSDP(),n.__answerDescription=t,so.debug("Answer ",n._rtcId,n.__id,n.closed),so.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n,t)).then((function(){Ie&&(r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP()),so.debug("Send Answer ",n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreateAnswerSuccess.bind(n))(t)}))}),t||n._onCreateSessionDescriptionError.bind(n,n.sdpConstraints))}},{key:"_printStats",value:function(e){var t=this;t.confrAttendee&&emedia.config.remainLastStatsCount&&e&&e.getTracks().forEach((function(e){t._printTrackStats(e)}))}},{key:"_printTrackStats",value:function(e){var t=this;if(t.confrAttendee&&emedia.config.remainLastStatsCount){var n=t.confrAttendee._trackStats&&t.confrAttendee._trackStats[e.id];if(n){for(var r in n){var i=n[r];for(var o in i){var s=i[o];if(s)for(var a=s.curIndex,c=0;c<emedia.config.remainLastStatsCount;c++){var u=s[a=(a-1)%emedia.config.remainLastStatsCount];if(!u||void 0===u.data)break;so.info("[track]",t._rtcId,t.__id,e.kind,e.id,r,o,u.data,u.timestamp.toLocaleString())}}}ht(t.confrAttendee._trackStats,e.id)}}}},{key:"close",value:function(e,t,n){var r=this;if(so.warn("webrtc closing",r._rtcId,r.__id,r.closed),r.__iceWaitIntervalId&&clearTimeout(r.__iceWaitIntervalId),!r.closed){t=!0===t,r.closed=!0;try{var i=function(){r._rtcPeerConnection&&r._rtcPeerConnection.close(),so.info("peer connection close. it is",r._rtcPeerConnection&&r._rtcPeerConnection.__peerId),!n&&Me&&(r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState,setTimeout((function(){r._rtcPeerConnection.iceConnectionState||r._rtcPeerConnection.connectionState,r.onIceStateChange&&r.onIceStateChange("closed")}),200))},o=r._localStream,s=r._remoteStream;emedia.config.printStatsWhenPCClose?r.getStats((function(){i(),o&&r._printStats(o),s&&r._printStats(s)})):i()}catch(e){so.warn(e)}finally{r._localStream&&!1===e&&emedia.stopTracks(r._localStream),r._remoteStream&&emedia.stopTracks(r._remoteStream),r._remoteStream=null,t||r.onClose&&r.onClose(),!0===n&&(so.info("Webrtc close. but retry build. will onIceStateChange(failed). eg. emedia.config iceWaitBuildMillis",r._rtcId,r.__id),r.onIceStateChange&&r.onIceStateChange("failed")),so.warn("webrtc closed. closed:",r._rtcId,r.__id,r.closed)}}}},{key:"addIceCandidate",value:function(e){var t=dt()(e)?e:[e];if(emedia&&emedia.config&&"function"==typeof emedia.config.reChanageCandidate){for(var n=[],r=0;r<t.length;r++){e=t[r];var i=emedia.config.reChanageCandidate(e);i&&(so.info("Candidate rechanage. addons. it =",e,"->",i),dt()(i)?Array.prototype.push.apply(n,i):n.push(i))}t=n}this._addIceCandidate(t)}},{key:"_addIceCandidate",value:function(e){var t=this;if(t._rtcPeerConnection){so.debug("Add ICE candidate: ",e,t._rtcId,t.__id,t.closed);var n=dt()(e)?e:[e];if(!t.__setRemoteSDP)return Array.prototype.push.apply(t.__tmpRemoteCands||(t.__tmpRemoteCands={}),n),void so.debug("Add ICE candidate but tmp buffer caused by not set remote sdp: ",e,t._rtcId,t.__id,t.closed);for(var r=0;r<n.length;r++)if((e=n[r]).cctx&&e.cctx!=t.cctx)so.warn("addIceCandidate fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);else{if(!0===t.fireFoxOfferVideoPreAudio){var i=e.sdpMLineIndex;e.sdpMLineIndex=g()(e.sdpMid.replace(/[^0-9]*/,"")),so.warn("Firefox sdp section video pre audio, sdp mline index update ",i,"->",e.sdpMLineIndex)}e.candidate&&""!==e.candidate?t._rtcPeerConnection.addIceCandidate(new RTCIceCandidate(e)).then(t.onAddIceCandidateSuccess.bind(t),t._onAddIceCandidateError.bind(t,e)):so.warn("Add ICE candidate fail. drop it ",e,t._rtcId,t.__id,t.closed)}}}},{key:"setRemoteDescription",value:function(e){return this._setRemoteDescription(e)}},{key:"_setRemoteDescription",value:function(e){var t=this;if(t.__iceWaitIntervalId&&(clearTimeout(t.__iceWaitIntervalId),t.__iceWaitIntervalId=null,so.info("emedia.config iceWaitBuildMillis, clear ice wait interval id",t._rtcId,t.__id)),so.debug("setRemoteDescription start. ",t._rtcId,t.__id,t.closed),t.offerDescription){if(e.cctx&&e.cctx!=t.cctx)return void so.warn("setRemoteDescription fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);if(!0===t.fireFoxOfferVideoPreAudio||!0===t.__offerVideoPreAudio){var n=new oo(e.sdp,t);e.sdp=n.getUpdatedSDP(!1),so.info("Remote sdp.2. switch audio video",e.sdp)}}else e.cctx&&(t.cctx=e.cctx);return e.sdp=e.sdp.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),so.warn("setRemoteDescription. UDP/TLS/RTP/SAVPF -> RTP/SAVPF; if firefox: switch audio video;",t._rtcId,t.__id),(t.vbitrate||t.abitrate||t.vminBitrate)&&(n=new oo(e.sdp,t),t.vbitrate&&n.setVideoBitrate(t.vbitrate),t.vminBitrate&&n.setVideoMinBitrate(t.vminBitrate),t.abitrate&&n.setAudioBitrate(t.abitrate),so.warn("vbitrate = ",t.vbitrate,"vminBitrate = ",this.vminBitrate,", abitrate = ",t.abitrate,t._rtcId,t.__id),e.sdp=n.getUpdatedSDP(void 0===t.__offerVideoPreAudio||null===t.__offerVideoPreAudio?void 0:!t.__offerVideoPreAudio)),so.debug("final remote sdp =",e.sdp,t._rtcId,t.__id),e=t.__remoteDescription=new RTCSessionDescription(e),t._rtcPeerConnection.setRemoteDescription(e).then((function(){t.__setRemoteSDP=!0,t._onSetRemoteSuccess.apply(t,arguments),t.__tmpLocalCands&&t.__tmpLocalCands.length>0&&(so.debug("After setRemoteDescription. send cands",t._rtcId,t.__id,t.closed),t._onIceCandidate(t.__tmpLocalCands),t.__tmpLocalCands=[]),t.__tmpRemoteCands&&t.__tmpRemoteCands.length>0&&(so.debug("After setRemoteDescription. add tmp cands",t._rtcId,t.__id,t.closed),t._addIceCandidate(t.__tmpRemoteCands),t.__tmpRemoteCands=[])}),t._onSetSessionDescriptionError.bind(t,e))}},{key:"iceConnectionState",value:function(){return this._rtcPeerConnection.iceConnectionState}},{key:"isConnected",value:function(){var e=this.lastIceConnectionState;return"connected"===e||"completed"===e}},{key:"_onGotRemoteStream",value:function(e){var t=this;t._remoteStream=e.stream||e.streams[0],t._remoteStream._rtcId=t._rtcId,t._remoteStream.__rtc_c_id=t.__id,so.debug("On got remote stream",t._remoteStream?t._remoteStream.id+"_"+t._remoteStream.active:"null",t._rtcId,t.__id),t._remoteStream&&t._remoteStream.getTracks().forEach((function(e){so.debug("remote stream",t._remoteStream.id," track =",e.enabled,e.id,e.kind,e.label,t._rtcId,t.__id)})),t.updateRemoteBySubArgs(),this.onGotRemoteStream(this._remoteStream,e),so.debug("received remote stream, you will see the other.",t._rtcId,t.__id,this.closed)}},{key:"_onSetRemoteSuccess",value:function(){so.info("onSetRemoteSuccess success",this._rtcId,this.__id),this.onSetRemoteSuccess.apply(this,arguments),this.offerDescription&&this.__remoteDescription&&this.__remoteDescription.sdp&&this._onAnswerCodes(this.__remoteDescription.sdp)}},{key:"_onAnswerCodes",value:function(e){var t=this,n=new oo(e,this);if(n.videoSection){var r=ao(n.videoSection);if(!r.codecs||0===r.codecs.length)return void so.info("not found any video codes. @ ",t._rtcId,t.__id);var i=[];r.codecs.forEach((function(e){return i.push(e.name)})),t.finalVCodeChoices=i,t.onVCodeChoices&&t.onVCodeChoices(i)}}},{key:"onSetRemoteSuccess",value:function(){}},{key:"onAddIceCandidateSuccess",value:function(){so.debug("addIceCandidate success",this._rtcId,this.__id)}},{key:"_onAddIceCandidateError",value:function(e,t){so.error("failed to add ICE Candidate: "+t.toString(),", error candidate:",e,this._rtcId,this.__id),this.onAddIceCandidateError(t)}},{key:"onAddIceCandidateError",value:function(e){}},{key:"_onIceCandidate",value:function(e){so.debug("onIceCandidate:",e,this._rtcId,this.__id),this.onIceCandidate(e)}},{key:"onIceCandidate",value:function(e){}},{key:"onIceStateChange",value:function(e){so.debug("onIceStateChange : ICE state ",e)}},{key:"_onCreateSessionDescriptionError",value:function(e,t){so.error("Failed to create session description: "+t.toString()," offerOptionsOrSDPConstraints:",e,this._rtcId,this.__id),this.onCreateSessionDescriptionError(t)}},{key:"onCreateSessionDescriptionError",value:function(e){}},{key:"onCreateOfferSuccess",value:function(e){so.debug("create offer success",this._rtcId,this.__id)}},{key:"onCreatePRAnswerSuccess",value:function(e){so.debug("create answer success",this._rtcId,this.__id)}},{key:"onCreateAnswerSuccess",value:function(e){so.debug("create answer success",this._rtcId,this.__id)}},{key:"_onSetSessionDescriptionError",value:function(e,t){so.error("onSetSessionDescriptionError : Failed to set session description: ",t.toString(),this._rtcId,this.__id),e&&e.type&&e.sdp&&so.error("error sdp: type=",e.type,"sdp=",e.sdp,this._rtcId,this.__id),this.onSetSessionDescriptionError(t)}},{key:"onSetSessionDescriptionError",value:function(e){}},{key:"_onSetLocalSessionDescriptionSuccess",value:function(){var e=this;so.debug("onSetLocalSessionDescriptionSuccess : setLocalDescription complete",this._rtcId,this.__id),emedia.config.iceWaitBuildMillis&&(this.__iceWaitIntervalId&&clearTimeout(this.__iceWaitIntervalId),this.__iceWaitIntervalId=setTimeout((function(){so.info("emedia.config iceWaitBuildMillis, timeout, will close webrtc, will retry build by onIceStateChange(failed)",e._rtcId,e.__id),e.onIceStateChange&&e.onIceStateChange("failed")}),emedia.config.iceWaitBuildMillis),so.info("emedia.config iceWaitBuildMillis, start timeout",e._rtcId,e.__id)),this.onSetLocalSessionDescriptionSuccess(),this.__answerDescription&&this.__answerDescription.sdp&&this._onAnswerCodes(this.__answerDescription.sdp)}},{key:"onSetLocalSessionDescriptionSuccess",value:function(){}},{key:"onGotRemoteStream",value:function(e){so.debug("Got remote stream. ",e,this._rtcId,this.__id)}},{key:"getStats",value:function(e){var t=this;return t._rtcPeerConnection?"function"!=typeof emedia.config.rtcStatsTypeMath?(so.warn("Get stats, but config rtcStatsTypeMather, ",this._rtcId,this.__id),void(e&&e())):void t._rtcPeerConnection.getStats(null).then((function(n){n.forEach((function(e,n){emedia.config.rtcStatsTypeMath(e,n)&&so.info("Rtc stats",e,t._rtcId,t.__id)})),e&&e(n)})):(so.warn("Get stats, but peer connection not exsits, ",this._rtcId,this.__id),void(e&&e()))}}]),e}();const lo=uo;var fo="object"==typeof exports&&exports&&!exports.nodeType&&exports,po=fo&&"object"==typeof module&&module&&!module.nodeType&&module,ho=po&&po.exports===fo?Ne.Buffer:void 0,mo=ho?ho.allocUnsafe:void 0;const vo=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)dr(t,vr(e)),e=Ye(e);return t}:fr,_o=function(e){return lr(e,Yt,vo)};var go=Object.prototype.hasOwnProperty;const yo=function(e){var t=new e.constructor(e.byteLength);return new or(t).set(new or(e)),t};var bo=/\w*$/;var So=We?We.prototype:void 0,Co=So?So.valueOf:void 0;const wo=function(e,t,n){var r,i,o=e.constructor;switch(t){case"[object ArrayBuffer]":return yo(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return function(e,t){var n=t?yo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function(e,t){var n=t?yo(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}(e,n);case"[object Map]":case"[object Set]":return new o;case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return(i=new(r=e).constructor(r.source,bo.exec(r))).lastIndex=r.lastIndex,i;case"[object Symbol]":return function(e){return Co?Object(Co.call(e)):{}}(e)}};var ko=Object.create,Io=function(){function e(){}return function(t){if(!Bt(t))return{};if(ko)return ko(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const xo=Io;var Ro=Vt&&Vt.isMap;const Mo=Ro?Ot(Ro):function(e){return Xe(e)&&"[object Map]"==Vr(e)};var To=Vt&&Vt.isSet;const Eo=To?Ot(To):function(e){return Xe(e)&&"[object Set]"==Vr(e)};var Po="[object Arguments]",Ao="[object Function]",Oo={};Oo[Po]=Oo["[object Array]"]=Oo["[object ArrayBuffer]"]=Oo["[object DataView]"]=Oo["[object Boolean]"]=Oo["[object Date]"]=Oo["[object Float32Array]"]=Oo["[object Float64Array]"]=Oo["[object Int8Array]"]=Oo["[object Int16Array]"]=Oo["[object Int32Array]"]=Oo["[object Map]"]=Oo["[object Number]"]=Oo["[object Object]"]=Oo["[object RegExp]"]=Oo["[object Set]"]=Oo["[object String]"]=Oo["[object Symbol]"]=Oo["[object Uint8Array]"]=Oo["[object Uint8ClampedArray]"]=Oo["[object Uint16Array]"]=Oo["[object Uint32Array]"]=!0,Oo["[object Error]"]=Oo[Ao]=Oo["[object WeakMap]"]=!1;const jo=function e(t,n,r,i,o,s){var a,c=1&n,u=2&n,d=4&n;if(r&&(a=o?r(t,i,o,s):r(t)),void 0!==a)return a;if(!Bt(t))return t;var l=kt(t);if(l){if(a=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&go.call(e,"index")&&(n.index=e.index,n.input=e.input),n}(t),!c)return function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}(t,a)}else{var f=Vr(t),p=f==Ao||"[object GeneratorFunction]"==f;if(Mt(t))return function(e,t){if(t)return e.slice();var n=e.length,r=mo?mo(n):new e.constructor(n);return e.copy(r),r}(t,c);if("[object Object]"==f||f==Po||p&&!o){if(a=u||p?{}:function(e){return"function"!=typeof e.constructor||qt(e)?{}:xo(Ye(e))}(t),!c)return u?function(e,t){return Mn(e,vo(e),t)}(t,function(e,t){return e&&Mn(t,Yt(t),e)}(a,t)):function(e,t){return Mn(e,vr(e),t)}(t,function(e,t){return e&&Mn(t,yr(t),e)}(a,t))}else{if(!Oo[f])return o?t:{};a=wo(t,f,c)}}s||(s=new er);var h=s.get(t);if(h)return h;s.set(t,a),Eo(t)?t.forEach((function(i){a.add(e(i,n,r,i,t,s))})):Mo(t)&&t.forEach((function(i,o){a.set(o,e(i,n,r,o,t,s))}));var m=l?void 0:(d?u?_o:br:u?Yt:yr)(t);return function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););}(m||t,(function(i,o){m&&(i=t[o=i]),Rn(a,o,e(i,n,r,o,t,s))})),a},Lo=function(e){return jo(e,5)};var Do=at("Member"),Vo=function(){function e(t){for(var n in s(this,e),d(this,"closed",!1),d(this,"_ices",{}),d(this,"supportVCodes",{}),d(this,"audioMixers",{}),t)this[n]=t[n];if(this.evtHandler=new Zi(this),!this.sessionFactory)throw Do.error("Require session"),"Require session";this._session=this.sessionFactory(this)}return u(e,[{key:"onEvent",value:function(){var e;(e=this.evtHandler).onEvent.apply(e,arguments)}},{key:"reflushSupportVCodes",value:function(e){var t=this;this.supportVCodes={},this._orderVCodes=e,e&&0!=e.length?e.forEach((function(e){return t.supportVCodes[e]=1})):Do.warn("Not config support vcodes")}},{key:"getOptimalVideoCodecs",value:function(){if(!this._orderVCodes||0==this._orderVCodes.length)return/Chrome/.test(navigator.userAgent)?"VP8":/Safari/.test(navigator.userAgent)?"H264":"VP8";for(var e,t=this._cacheMembers.length,n=0,r=0;r<this._orderVCodes.length;r++){var i=this._orderVCodes[r];if(0==n&&(n=this.supportVCodes[i]),this.supportVCodes[i]>t)return i;this.supportVCodes[i]>n&&(n=this.supportVCodes[i],e=i)}return e}},{key:"setMemberId",value:function(e){this._memberId=e}},{key:"getMemberId",value:function(){return this._memberId||this.id}},{key:"createWebrtc",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this;e._rebuildCount=t,!0===this._service.useRTCCfg&&this.__rtc_cfg?e.iceServerConfig=Lo(this.__rtc_cfg):nt(this._service.useRTCCfg)&&(e.iceServerConfig=Lo(this._service.useRTCCfg));var r=new lo({confrAttendee:this,useIp:this.ip,onIceStateChange:function(e){var t=e;Do.debug("evt.target ice state",t);try{if("failed"==t)return n.onEvent(new Wi.ICEConnectFail({webrtc:r})),void(r.onEvent&&r.onEvent(new Wi.ICEConnectFail({webrtc:r})));if("connected"==t)return n.onEvent(new Wi.ICEConnected({webrtc:r})),void(r.onEvent=null);if("closed"==t)return n.onEvent(new Wi.ICEClosed({webrtc:r})),void(r.onEvent&&r.onEvent(new Wi.ICEClosed({webrtc:r})));if("disconnected"==t)return n.onEvent(new Wi.ICEDisconnected({webrtc:r})),void(r.onEvent&&r.onEvent(new Wi.ICEDisconnected({webrtc:r})))}finally{n._onIceStateChange&&n._onIceStateChange(r,e)}},onIceCandidate:function(e){n._onIceCandidate&&e&&n._onIceCandidate(r,e)},onGotRemoteStream:function(e){Do.info("got stream.",r._rtcId,r.__id,e),r.onGotMediaStream&&r.onGotMediaStream(e),n.onEvent(new Wi.ICERemoteMediaStream({webrtc:r}))},onAddIceCandidateError:function(e){n.onEvent(new Wi.AddIceCandError({webrtc:r,event:e}))},onSetSessionDescriptionError:function(e){Do.warn("onSetSessionDescriptionError : Failed to set session description: "+e.toString()),n.onEvent&&n.onEvent(new Wi.ICEConnectFail({webrtc:r,event:e}))},onCreateSessionDescriptionError:function(e){Do.warn("Failed to create session description: "+e.toString()),n.onEvent&&n.onEvent(new Wi.ICEConnectFail({webrtc:r,event:e}))}},e);return this._ices||(this._ices={}),this._ices[r.getRtcId()]&&this._howDoWebrtcWhenCrtExsitsWebrtc(r),this._ices[r.getRtcId()]=r,this._ices[r.__id]=r,this._iceCreateRtcPeerConnection(r.getRtcId()),Do.debug("create rtc ",r),r}},{key:"_howDoWebrtcWhenCrtExsitsWebrtc",value:function(e){this.closeWebrtc(e.getRtcId(),!0,!1)}},{key:"connect",value:function(e,t){this._session.connect(e,t)}},{key:"connected",value:function(){return this._session.connected()}},{key:"newMessage",value:function(e){var t=this,n=this._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n}},{key:"message",value:function(e){var t=this,n=this._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n}},{key:"postMessage",value:function(e,t,n){try{e.sessId||(e.sessId=this._session._sessionId),this._session.postMessage(e,t,n)}catch(n){t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"post message. exception"}),Do.warn(n)}}},{key:"_onIceStateChange",value:function(e,t){Do.info(e.getRtcId(),t),this.onEvent(new Wi.ICEChanage({webrtc:e,state:t}))}},{key:"_onIceCandidate",value:function(e,t){var n,r=this;dt()(t)?n=t:(n=[]).push(t);var i=this.newMessage().setOp(105).setRtcId(e.getRtcId()).setCands(n);this.postMessage(i,(function(e){0!=e.result&&r.onEvent(new Wi.RspFail({request:i,response:e}))}))}},{key:"_initC",value:function(e,t,n,r,i,o){var s=this;if(t&&t.rtcId!==e.getRtcId())throw Do.error("stream and webrtc rtcId not equal."),"stream and webrtc rtcId not equal.";var a=this.newMessage().setOp(102).setRtcId(e.getRtcId()).setSdp(n).setSubSId(r);e.subArgs&&f()(a,e.subArgs),null!=t&&t.located()&&a.setPubS(t),this.postMessage(a,(function(n){if(0!=n.result)return s.onEvent(new Wi.RspFail({request:a,response:n})),void(i&&i(new Wi.RspFail({request:a,response:n,hidden:!0===n.retrying})));t&&!t.id&&n.streamId&&t.updateAttributes({id:n.streamId});try{o&&o()}catch(e){Do.warn(e)}n.sdp&&s.ansC(e.getRtcId(),n.sdp,n.cands),n.mems&&(null==s||s.onMembers(n.cver,n.mems)),n.streams&&(null==s||s.onStreams(n.cver,n.streams))}))}},{key:"_acptC",value:function(e,t,n){var r=this,i=this.newMessage().setOp(104).setRtcId(e.getRtcId()).setSdp(t);this.postMessage(i,(function(e){0!=e.result&&(r.onEvent(new Wi.RspFail({request:i,response:e})),n&&n(new Wi.RspFail({request:i,response:e})))}))}},{key:"_ansCAndPubstream",value:function(e,t,n,r,i){var o=this,s=this.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(n);e.subArgs&&f()(s,e.subArgs),null!=t&&t.located()&&(ht(t,"mutedMuted"),ht(t,"_located"),s.setPubS(t)),this.postMessage(s,(function(e){if(0!=e.result)return o.onEvent(new Wi.RspFail({request:s,response:e})),void(r&&r(new Wi.RspFail({request:s,response:e,hidden:!0===e.retrying})));t&&!t.id&&e.streamId&&t.updateAttributes({id:e.streamId});try{i&&i()}catch(e){Do.warn(e)}}))}},{key:"_ansC",value:function(e,t,n){var r=this,i=this.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(t);this.postMessage(i,(function(e){if(0!=e.result)return r.onEvent(new Wi.RspFail({request:i,response:e})),void(n&&n(new Wi.RspFail({request:i,response:e})))}))}},{key:"_termC",value:function(e,t,n){var r=this,i="string"==typeof e?e:e.getRtcId(),o=this.newMessage().setOp(107).setRtcId(i).setEndReason(t);this.postMessage(o,(function(e){0!=e.result&&(r.onEvent(new Wi.RspFail({request:o,response:e})),n&&n(new Wi.RspFail({request:o,response:e})))}))}},{key:"_iceCreateRtcPeerConnection",value:function(e){this._ices[e].createRtcPeerConnection(),Do.debug("create rtc peer connection",e)}},{key:"doOffer",value:function(e,t){this._ices[e].createOffer((function(e){return t(e)}))}},{key:"offerCall",value:function(e,t,n,r,i){var o=this,s=this._ices[e];s.createOffer((function(e){return o._initC&&o._initC(s,t,e,n,r,i)}))}},{key:"accept",value:function(e,t){var n=this,r=this._ices[e];r.createPRAnswer((function(e){return null==n?void 0:n._acptC(r,e,t)}))}},{key:"answerCall",value:function(e,t,n,r){var i=this,o=this._ices[e];o.createAnswer((function(e){return null==i?void 0:i._ansCAndPubstream(o,t,e,n,r)}))}},{key:"answer",value:function(e,t){var n=this,r=this._ices[e];r.createAnswer((function(e){return null==n?void 0:n._ansC(r,e,t)}))}},{key:"onTcklC",value:function(e,t){this._addIceCandidate(t,e)}},{key:"onAcptC",value:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)}},{key:"onAnsC",value:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)}},{key:"_addIceCandidate",value:function(e,t){if(e&&0!=e.length){var n=this._ices[t];n&&n.addIceCandidate(e)}else Do.warn("drop cands",e)}},{key:"closeWebrtc",value:function(e,t,n){var r=this,i=this._ices[e];if(mt(this._cacheStreams,(function(t,n){if(n.rtcId===e&&!n.located())try{var i=ht(r._mediaMeters,t);i&&i._finally()}catch(e){Do.warn(e)}n.rtcId===e&&2===n.type&&ht(r.audioMixers,n.id)})),!i||i.closed)return Do.warn("Webrtc not exsits or closed",i&&i.closed),n&&i&&mt(this._cacheStreams,(function(t,n){n.rtcId===e&&(ht(r._linkedStreams,t),Do.warn("Webrtc close, remvoe from _linkedStreams",t))})),void(n||this._termC(e,0));this._records&&mt(this._records,(function(t,n){n.rtcId===e&&function(e){try{this.stopRecord(e)}catch(e){Do.warn(e)}finally{ht(this._records,e.id)}}(n)}));try{n||i&&this._termC(i,t&&i._localStream?-10:0)}finally{i&&i.close(t),i&&this.onWebrtcTermC&&this.onWebrtcTermC(i),t||i&&mt(this._cacheStreams,(function(t,i){i.rtcId===e&&(i.located()&&(emedia.stopTracks(i._localMediaStream),i&&!i.closeReason&&i.updateAttributes({closeReason:"WebrtcClose"}),r._cacheStreams[t]&&r._linkedStreams[t]&&r.onRemoveStream(i),ht(r._cacheStreams,t),r._streamAutomators&&ht(r._streamAutomators,t),r._monitSoundChanagedStreams&&ht(r._monitSoundChanagedStreams,t),Do.info("Webrtc close. Remove stream",t,". from cache")),n&&(ht(r._linkedStreams,t),Do.info("Webrtc close. Remove stream",t,". from _linkedStreams")))}))}return i}},{key:"__close",value:function(e){if(Do.warn("closing, reason = ",e),!this.closed){if(this.closed=!0,this.__getCopyInterval&&(clearInterval(this.__getCopyInterval),Do.warn("Stop interval get copy")),this._ices)for(var t in this._ices)this.closeWebrtc(t,!1);var n=this.newMessage().setOp(201).setReason(e||0);this.postMessage(n)}}},{key:"exit",value:function(e){var t=this;e?(e&&this._closeMyConfr(11),setTimeout((function(){return t.close(0)}),100)):this.close(0)}},{key:"_closeMyConfr",value:function(e){var t=this.newMessage().setOp(204).setReason(e||0);this.postMessage(t,(function(e){return Do.warn("Close confr ",e.result,e.msg)}))}},{key:"close",value:function(e,t){var n=this;if(!this.closed)try{mt(this._cacheStreams||{},(function(e,t){t.located()&&t._localMediaStream&&emedia.stopTracks(t._localMediaStream)})),this.__close(e),mt(this._cacheStreams,(function(e,t){n.onRemoveStream(t)})),mt(this._cacheMembers,(function(e,t){n.onRemoveMember(t)}))}finally{try{setTimeout((function(){return null==n?void 0:n._session.close(e)}),500),this.onEvent(new Wi.Hangup({reason:e,failed:t,this:{id:this._memberId}})),null==this||this.onMeExit(e,t)}catch(e){Do.error(e)}finally{this._onFinally&&this._onFinally()}}}},{key:"webrtcState",value:function(e){return this._ices[e].iceConnectionState()}},{key:"_iceSetRemoteSDP",value:function(e,t){this._ices[t].setRemoteDescription(e)}},{key:"setLocalStream",value:function(e,t){this._ices[t].setLocalStream(e)}},{key:"onWebrtcTermC",value:function(e){}}]),e}();const Fo=Vo;var No=at("Me"),Wo=function(e){Qr(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!$r())return!1;if($r().sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call($r()(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=ni(t);if(n){var i=ni(this).constructor;e=$r()(r,arguments,i)}else e=r.apply(this,arguments);return ei(this,e)});function i(e){var t;s(this,i);var n=Zr(t=r.call(this,e)),o=e.listeners;if(n._session||n.sessionFactory&&(n._session=n.sessionFactory()),!n._session)throw No.error("Require session"),"Require session";return n._cver=0,n._cacheMembers={},n._cacheStreams={},n._streamAutomators={},n._mediaMeters={},n._openedRtcMediaStreams={},n._linkedStreams={},n._maybeNotExistStreams={},n._records={},n._ices={},n.audioMixers={},n.closed=!1,n._nextStreamSeqno=0,n.getMediaMeterIntervalMillis=n.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis,t.registerListeners(o),t}return u(i,[{key:"registerListeners",value:function(e){for(var t in e)this[t]=e[t]}},{key:"getCurrentMembers",value:function(){var e=[];return mt(this._cacheMembers,(function(t,n){var r=Lo(n);e.push(r)})),e}},{key:"newStream",value:function(e){var t=this;return new Ki(e,{__init__:function(){var e=this;if(e.rtcId||e._webrtc&&(e.rtcId=e._webrtc.getRtcId()),e._webrtc||e.rtcId&&(e._webrtc=t._ices[e.rtcId]),e.__create_id=t._nextStreamSeqno++,e.memId&&!e.owner&&(e.owner=f()({},t._cacheMembers[e.memId]),!e.owner&&!e.located()))throw No.error("Remote stream, not owner. it = ",e.id),"Remote stream, not owner. it = "+e.id}})}},{key:"getConfrId",value:function(){return this.ticket.confrId}},{key:"isCaller",value:function(){var e=this;return e.isP2P()&&e.ticket.caller==e.ticket.memName}},{key:"isCallee",value:function(){var e=this;return e.isP2P()&&e.ticket.callee==e.ticket.memName}},{key:"isP2P",value:function(){var e=this;return e.ticket&&("P2P"==e.ticket.type||"p2p"==e.ticket.type)}},{key:"isConfr",value:function(){var e=this;return e.ticket&&("CONFR"==e.ticket.type||"confr"==e.ticket.type)}},{key:"join",value:function(e,t){this._join(e,t)}},{key:"_join",value:function(e,t){No.debug("begin join ...");var n,r=this;if(r._memberId)return No.warn("Had joined. igrone it"),void(e&&e(r.memId));function i(e){try{if(e instanceof Wi.WSClose&&e.retry)return;e instanceof Wi.EnterFail||(e=new Wi.EnterFail({attendee:r,cause:e})),r.onEvent(e),t&&t(e)}finally{}}function o(t){if(0==t.result){r.reflushSupportVCodes(t.vcodes),r.setMemberId(t.memId),r.role=t.role,r.onEvent(new Wi.EnterSuccess({ip:r.ip})),e&&e(t.memId);try{r.__rtc_cfg=t.rtcCfg,"string"==typeof t.rtcCfg&&(r.__rtc_cfg=JSON.parse(t.rtcCfg))}finally{r.onMembers(t.cver,t.mems),r.onStreams(t.cver,t.streams)}}else try{i(new Wi.RspFail({request:n,response:t}))}finally{-9527!==t.result&&r.onEvent(new Wi.ServerRefuseEnter({failed:t.result,msg:t.msg}))}}r.connect((function(){n=r.newMessage().setOp(200).setTicket(r.ticket).setNickName(r.nickName||r.ticket.memName).setResource(r.resource).setExt(r.ext),r.postMessage(n,o)}),i),No.debug("join",r.ticket.url)}},{key:"withpublish",value:function(e){var t,n=this;if(!e||!e.localStream)throw No.error("pubS null or stream not open"),"pubS null or stream not open";var r,i=e&&e.localStream;return{join:function(o,s){if(1===arguments.length&&(s=o,o=void 0),n._memberId)return No.warn("Had joined. igrone it"),void(o&&o(n.memId));function a(e){try{if(e instanceof Wi.WSClose&&e.retry)return;e instanceof Wi.EnterFail||(e=new Wi.EnterFail({attendee:n,cause:e})),n.onEvent(e),s&&s(e)}finally{emedia.stopTracks(i),r&&n.closeWebrtc(r.getRtcId())}}var c=n.getOptimalVideoCodecs();function u(i){if(0==i.result){n.reflushSupportVCodes(i.vcodes),n.setMemberId(i.memId),n.role=i.role,n.onEvent(new Wi.EnterSuccess({ip:n.ip}));var s=n.newStream(e);s.updateAttributes({_localMediaStream:e.localStream,rtcId:r.getRtcId(),_webrtc:r,id:i.streamId,csrc:i.csrc,owner:{id:i.memId,nickName:n.nickName,name:n.sysUserId,ext:n.extObj},optimalVideoCodecs:c}),o&&o(i.memId,s),r.useIp=n.ip,n.onEvent(new Wi.PushSuccess({stream:s,hidden:!0})),i.sdp&&n.ansC(r.getRtcId(),i.sdp),i.cands&&n.tcklC(r.getRtcId(),i.cands);try{n.__rtc_cfg=i.rtcCfg,"string"==typeof i.rtcCfg&&(n.__rtc_cfg=JSON.parse(i.rtcCfg)),n.__rtc_cfg&&n.__rtc_cfg.iceServers&&n.__rtc_cfg.iceServers.length>0&&(No.warn("Server rsp one rtc cfg. publish will republish"),n._service&&setTimeout((function(){n._service._republish(s)}),200))}finally{n.onMembers(i.cver,i.mems),n.onStreams(i.cver,i.streams)}}else try{a(new Wi.RspFail({request:t,response:i}))}finally{-9527!==i.result&&n.onEvent(new Wi.ServerRefuseEnter({failed:i.result,msg:i.msg}))}}function d(){No.debug("enter and pubs");var i,o,s=e.localStream;2===e.type&&(i={offerToReceiveAudio:!0,offerToReceiveVideo:!1},o={subSVideo:!1,subSAudio:!0}),r=n.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:c,offerOptions:i,subArgs:o,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),n.setLocalStream(s,r.getRtcId()),n.doOffer(r.getRtcId(),(function(i){t=n.newMessage().setOp(200).setTicket(n.ticket).setNickName(n.nickName||n.ticket.memName).setResource(n.resource).setSdp(i).setRtcId(r.getRtcId()).setPubS(e).setExt(n.ext),n.postMessage(t,u)}))}n.connect(d,a),No.debug("join",n.ticket.url)}}}},{key:"push",value:function(e,t,n,r){No.debug("begin push ...");var i,o=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw No.error("pubS or stream open"),"pubS or stream open";var s,a=e.localStream;function c(t){try{var i=o.newStream(e);i.updateAttributes({_localMediaStream:e.localStream,_webrtc:s,rtcId:s&&s.getRtcId(),owner:{id:o.getMemberId(),nickName:o.nickName,name:o.sysUserId,ext:o.extObj}}),t=new Wi.PushFail({stream:i,cause:t,hidden:r&&!0===t.hidden}),o.onEvent(t),t.hidden||n&&n(t)}finally{a&&!0!==t.hidden&&emedia.stopTracks(a),s&&o.closeWebrtc(s.getRtcId(),!0===t.hidden)}}if(e.rtcId||2!==e.type||emedia.config.allowRepeatAudioMixerPublish||!o._service.hasAudioMixers()){var u=e.optimalVideoCodecs||o.getOptimalVideoCodecs();l(e),No.debug("push",o.ticket.url)}else c(new Wi.AudioMixerStreamRepeatPublish);function d(n,r){if(0==r.result){var s=o.newStream(e);s.updateAttributes({_localMediaStream:e.localStream,_webrtc:n,rtcId:n.getRtcId(),id:r.streamId,csrc:r.csrc,owner:{id:o.getMemberId(),nickName:o.nickName,name:o.sysUserId,ext:o.extObj},optimalVideoCodecs:u}),s.id&&2===s.type&&(o.audioMixers[s.id]=s);try{o.onEvent(new Wi.PushSuccess({stream:s,hidden:!0}))}finally{r.sdp&&o.ansC(n.getRtcId(),r.sdp),r.cands&&o.tcklC(n.getRtcId(),r.cands),t&&t(s)}}else c(new Wi.RspFail({request:i,response:r,hidden:!0===r.retrying}))}function l(e){No.debug("pubs");var t,n,r=e.localStream;2===e.type&&(t={offerToReceiveAudio:!0,offerToReceiveVideo:!1},n={subSVideo:!1,subSAudio:!0}),s=o.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:u,offerOptions:t,subArgs:n,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),o.setLocalStream(r,s.getRtcId()),o.doOffer(s.getRtcId(),(function(t){i=o.newMessage().setOp(102).setRtcId(s.getRtcId()).setSdp(t).setPubS(e),o.postMessage(i,(function(e){d(s,e)}))}))}}},{key:"someBrowsersRequireGetUserMedia",value:function(e,t){var n=this;if(function(){if(Me){var e=new RegExp("(Version)/([0-9.]+)","i"),t=navigator.userAgent.match(e);if(null!=t){var n=unescape(t[2]);return(n=g()(n))<13}}return!1}()&&!emedia._yetGetUserMedia){if(!0===n.__tryingOpenMedia)n.__tryingOpenMediaWaitSuceess=n.__tryingOpenMediaWaitSuceess||[],n.__tryingOpenMediaWaitFail=n.__tryingOpenMediaWaitFail||[],"function"==typeof e&&n.__tryingOpenMediaWaitSuceess.push(e),"function"==typeof t&&n.__tryingOpenMediaWaitFail.push(t);else{var r=function(t,r){emedia._yetGetUserMedia=!0,emedia.stopTracks(r),setTimeout((function(){n.__tryingOpenMedia=!1,e&&e.apply(n),n.__tryingOpenMediaWaitSuceess&&mt(n.__tryingOpenMediaWaitSuceess,(function(e,t){t.apply(n)})),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]}),300)},i=function(e){n.__tryingOpenMedia=!1,No.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail"),t&&t.call(n,e),n.__tryingOpenMediaWaitFail&&mt(n.__tryingOpenMediaWaitFail,(function(t,r){r.call(n,e)})),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]};n.__tryingOpenMedia=!0,n._service.__getUserMedia({audio:!0},r,(function(e){n._service.__getUserMedia({video:!0},r,i)}))}return!0}return!1}},{key:"createWebrtcAndSubscribeStream",value:function(e,t,n,r){var i=this;t||(t={});var o=i._cacheStreams[e],s=i._cacheMembers[o.memId],a=o;function c(n){No.warn("sub stream error",e,n),m&&a._webrtc&&a._webrtc.setSubArgs(m),m&&a.updateAttributes({subArgs:m}),n=new Wi.SubFail({stream:a,hidden:!0===n.hidden,cause:n}),t&&t.onEvent&&t.onEvent(n),i.onEvent&&i.onEvent(n)}function u(){a.updateAttributes(a.subArgs)}r=r||a.subArgs||{subSVideo:!0,subSAudio:2!==o.type};var d=o.vcodes||[],l=s&&s.vcodes||[],p=i.supportVCodes,h=i._getOptimalVideoCodecsSubset(d,l,p);r=r||a.subArgs;var m=a.subArgs,v=!(a.vcodes&&a.vcodes.length>0);Me&&(v=v||!!a.voff);var _={offerToReceiveAudio:!0,offerToReceiveVideo:r.subSVideo&&!v};function g(){var o=i.createWebrtc({iceServerConfig:n,optimalVideoCodecs:h,offerOptions:_,onGotMediaStream:function(e){t.onGotRemote&&t.onGotRemote(a)}},a.iceRebuildCount),c=o.getRtcId();No.warn(c," sub stream ",e,h),a.updateAttributes({_webrtc:o,rtcId:c,owner:f()({},s)}),r&&a._webrtc&&a._webrtc.setSubArgs(r),r&&a.updateAttributes({subArgs:r})}_.offerToReceiveAudio||_.offerToReceiveVideo||No.warn("offerToReceiveAudio == false and offerToReceiveVideo == false"),i.someBrowsersRequireGetUserMedia((function(){g(),i.offerCall(a.rtcId,null,e,c,u)}),(function(t){No.error("Some browsers must getUserMedia, gather cands. now try get audio. fail. subfail",e),c(t)}))||(g(),i.offerCall(a.rtcId,null,e,c,u))}},{key:"_getOptimalVideoCodecsSubset",value:function(e,t,n){var r=this,i=[];if(e&&e.length>0&&n[e[0]]&&i.push(e[0]),0==i.length)for(var o=0;o<r._orderVCodes.length;o++)mt(t,(function(e,t){t==r._orderVCodes[o]&&i.push(t)}));return i}},{key:"subscribeStream",value:function(e,t,n,r,i){var o=this,s=o._ices[e],a=o._cacheStreams[t],c=o._cacheMembers[a.memId],u=a;u.updateAttributes({_webrtc:s,rtcId:e,owner:f()({},c)});var d=u.subArgs;if(r=r||{subSVideo:!0,subSAudio:!0},u.updateAttributes({subArgs:u.subArgs||{subSVideo:!0,subSAudio:!0}}),u._webrtc&&u._webrtc.setSubArgs(u._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!u.subArgs.subSVideo&&r.subSVideo&&!u.voff){var l=a.vcodes,p=c.vcodes,h=o.supportVCodes;o._getOptimalVideoCodecsSubset(l,p,h)}r&&u._webrtc&&u._webrtc.setSubArgs(r),r&&u.updateAttributes({subArgs:r});var m=o.newMessage().setOp(205).setRtcId(e).setSubSId(t);r&&f()(m,r),o.postMessage(m,(function(e){if(0!=e.result){d&&u._webrtc&&u._webrtc.setSubArgs(d),d&&u.updateAttributes({subArgs:d});var t=new Wi.SubFail({stream:u,cause:new Wi.RspFail({request:m,response:e})});return n&&n(t),void o.onEvent(t)}u.updateAttributes(u.subArgs),t=new Wi.SubSuccess({stream:u,hidden:!0}),o._updateRemoteStream(u,u._webrtc.getRemoteStream()),o.onEvent(t),"function"==typeof i&&i()}))}},{key:"unsubscribeStream",value:function(e){var t=this,n=t._cacheStreams[e],r=n._webrtc&&n._webrtc.getRtcId();if(r){try{var i=t.newMessage().setOp(206).setRtcId(r).setSubSId(e);t.postMessage(i)}finally{t.closeWebrtc(r)}return r}}},{key:"onEnter",value:function(e,t){var n=this;if(e&&(n._cver=e),t&&!n._cacheMembers[t.id]){n._cacheMembers[t.id]=t;var r={};t.res&&t.res.vcodes&&t.res.vcodes.length>0&&mt(t.res.vcodes,(function(e,t){r[t]||(r[t]=!0,n.supportVCodes[t]&&n.supportVCodes[t]++)})),n.onAddMember(f()({},t))}}},{key:"_onFinally",value:function(){var e=this;e._cacheMembers={},e._cacheStreams={},e._linkedStreams={},e._ices={},e._maybeNotExistStreams={};var t=[];if(mt(e._openedRtcMediaStreams,(function(e,n){!1!==n.active&&t.push(n)})),t.length>0)for(var n=0;n<t.length;n++)try{var r=t[n];No.info("exit, close stream = ",r.id),emedia.stopTracks(r)}catch(e){No.error(e)}No.warn("finally. all clean.")}},{key:"_onRoleUpdate",value:function(e,t){var n=this;No.info("Role ",e," <-",n.role),No.info(t),n.role=e,n.roleToken=t,n.onRoleUpdate&&n.onRoleUpdate(e,t)}},{key:"onExit",value:function(e,t,n){var r=this;if(e&&(r._cver=e),t!=r.getMemberId()){var i=r._cacheMembers[t];i&&(i.res&&i.res.vcodes&&i.res.vcodes.length>0&&mt(i.res.vcodes,(function(e,t){r.supportVCodes[t]--})),r._onRemoveMember(i,n),r.onEvent(new Wi.Hangup({reason:n,parnter:i})))}else{No.warn("Me exit. ",n,t);try{r.closed||r.close(n)}catch(e){r.onEvent(new Wi.Hangup({reason:n,self:{id:r._memberId}})),r.onMeExit&&r.onMeExit(n),No.warn(e)}}}},{key:"onPub",value:function(e,t,n){var r=this;if(!r._cacheMembers[t])throw No.error("No found member. when pub"),"No found member. when pub";var i=r.newStream(n),o=r._cacheStreams[n.id];if(e&&(r._cver=e),o&&i.sver!==o.sver)return No.info("Onpub. the steam ",o.id," republish. sver ",o.sver,i.sver),!i||i.aoff===o.aoff&&i.voff==o.voff||r.onStreamControl(void 0,n.id,i.voff,i.aoff),f()(o,i),void r._onRepublishStream(o);var s=i;return s.updateAttributes({owner:r._cacheMembers[t]}),r._cacheStreams[n.id]=s,r._onAddStream(r.newStream(s)),r.autoSub&&r.createWebrtcAndSubscribeStream(n.id,{onGotRemote:function(e){}}),s}},{key:"onUnpub",value:function(e,t,n){var r=this,i=r._cacheStreams[n];r._onRemovePubstream(r._cacheMembers[t],i),e&&(r._cver=e)}},{key:"onClose",value:function(e,t,n){var r=this;try{r.close(n||0)}finally{r.onConfrClose&&r.onConfrClose(t,n)}}},{key:"__getWebrtcFor",value:function(e){var t=this._cacheStreams[e]&&this._cacheStreams[e]._webrtc;return t&&t.getRtcId()}},{key:"_getWebrtc",value:function(e){return this._cacheStreams[e]&&this._cacheStreams[e]._webrtc}},{key:"_updateRemoteStream",value:function(e,t){e.located()&&2===e.type?emedia.enableAudioTracks(t,!0):emedia.enableAudioTracks(t,!(e.aoff||e.subArgs&&!1===e.subArgs.subSAudio)),emedia.enableVideoTracks(t,!(e.voff||e.subArgs&&!1===e.subArgs.subSVideo))}},{key:"onStreamControl",value:function(e,t,n,r,i){var o=this,s=o._cacheStreams[t];s.updateAttributes({voff:n,aoff:r});var a=s._webrtc;a&&a._remoteStream&&o._updateRemoteStream(s,a._remoteStream);var c=o.newStream(s);o.onUpdateStream&&o.onUpdateStream(c,new Xi({voff:n,aoff:r})),e&&(o._cver=e),i&&s.updateAttributes({sver:i})}},{key:"aoff",value:function(e,t,n){var r=this,i=r.__getWebrtcFor(e.id);if(!i)throw No.error("pubS not publish",e.id),"pubS not publish"+e.id;r._linkedStreams[e.id].updateAttributes({aoff:t}),e.updateAttributes({aoff:t});var o=r.newMessage().setOp(400).setRtcId(i).setVoff(e.voff).setAoff(t);r.postMessage(o,n),r.onUpdateStream&&r.onUpdateStream(e,new Xi({aoff:t}))}},{key:"voff",value:function(e,t,n){var r=this,i=r.__getWebrtcFor(e.id);if(!i)throw No.error("pubS not publish",e.id),"pubS not publish"+e.id;r._linkedStreams[e.id].updateAttributes({voff:t}),e.updateAttributes({voff:t});var o=r.newMessage().setOp(400).setRtcId(i).setVoff(t).setAoff(e.aoff);r.postMessage(o,n),r.onUpdateStream&&r.onUpdateStream(e,new Xi({voff:t}))}},{key:"startRecord",value:function(e,t){var n=this,r=e.rtcId,i=n.newMessage().setOp(500).setRtcId(r).setFlag(1);n.postMessage(i,(function(i){No.warn("record ",r,i.result,i.msg),t&&t(0===i.result),0===i.result&&(n._records[e.id]=f()({},e))}))}},{key:"stopRecord",value:function(e,t){var n=this,r=e.rtcId,i=n.newMessage().setOp(500).setRtcId(r).setFlag(0);n.postMessage(i,(function(e){No.warn("stop record ",r,e.result,e.msg),t&&t(0===e.result)})),n._records[e.id]&&ht(n._records,e.id)}},{key:"onMembers",value:function(e,t){var n=this,r=[];mt(n._cacheMembers,(function(e,n){t[e]||r.push(n)})),mt(r,(function(e,t){n.onExit(void 0,t.id)}));var i=[];mt(t,(function(e,t){(t.name&&t.name!=n.memName||!t.name&&e!=n.getMemberId())&&(n._cacheMembers[e]||i.push(t),n._cacheMembers[e]&&f()(n._cacheMembers[e],t))})),mt(i,(function(e,t){n.onEnter(void 0,t)})),e&&(n._cver=e)}},{key:"onStreams",value:function(e,t){var n=this,r=[];mt(n._cacheStreams,(function(e,n){n.located()||t[e]||r.push(n)})),mt(r,(function(e,t){n.onUnpub(void 0,t.memId,t.id)}));var i=[];mt(t,(function(e,t){(t.memName&&t.memName!=n.memName||!t.memName&&t.memId!=n.getMemberId())&&(n._cacheStreams[e]||i.push(t),n._cacheStreams[e]&&f()(n._cacheStreams[e],t))})),mt(i,(function(e,t){n.onPub(void 0,t.memId,t)})),mt(n._cacheStreams,(function(e,r){var i;r.located()||(i=t[e]),!i||i.aoff===r.aoff&&i.voff==r.voff||n.onStreamControl(void 0,e,i.voff,i.aoff),i&&i.sver!==r.sver&&(f()(r,i),n._onRepublishStream(r))})),e&&(n._cver=e)}},{key:"_onRemoveMember",value:function(e,t){var n=this;No.info("remove",e,t);var r=[];mt(n._cacheStreams,(function(t,n){(n.memId||n.owner&&n.owner.id)===e.id&&r.push(n)})),mt(r,(function(e,r){n._onRemovePubstream(r.owner,r,t)})),ht(n._cacheMembers,e.id),n.onRemoveMember&&n.onRemoveMember(e,t)}},{key:"_onAddStream",value:function(e){No.info("add stream ",e.id),No.debug("add stream ",e),this.onAddStream(e)}},{key:"_onRemovePubstream",value:function(e,t,n){var r=this;if(t&&0!=t.id)try{var i=ht(r._mediaMeters,t.id);i&&i._finally()}finally{!function(e){2===e.type&&(ht(r.audioMixers,e.id),e.remotePlayAudioObject&&document.body.removeChild(e.remotePlayAudioObject)),n||(n="Unpub"),e&&!e.closeReason&&e.updateAttributes({closeReason:n}),r.unsubscribeStream(e.id),ht(r._cacheStreams,e.id),r._streamAutomators&&ht(r._streamAutomators,e.id),r._monitSoundChanagedStreams&&ht(r._monitSoundChanagedStreams,e.id),r.onRemoveStream&&(e=r.newStream(e),r.onRemoveStream(e))}(t)}}},{key:"_onRepublishStream",value:function(e){var t=this;!t._ices[e.rtcId]&&!emedia.subscribed(e)||t._maybeNotExistStreams[e.id]?t.onUpdateStream(e):(t.unsubscribeStream(e.id),t.createWebrtcAndSubscribeStream(e.id,{onGotRemote:function(e){}}))}},{key:"_onRecvRemoteMessage",value:function(e,t,n){var r=this;No.debug("Recv remote message",e,t);var i,o=r._cacheMembers[e];try{i=JSON.parse(t)}catch(e){}r.onRecvRemoteMessage&&r.onRecvRemoteMessage(o||e,i||t,n)}},{key:"_onSoundChanage",value:function(e,t,n){emedia.config._printSoundData&&No.info("Stream id "+t.id+", meter "+(n&&n.instant.toFixed(2)+" "+n.slow.toFixed(2)+" "+n.clip.toFixed(2)+" "+(n.trackAudioLevel||"--")+" "+(n.trackTotalAudioEnergy||"--"))),n||(n={instant:0,slow:0,clip:0}),emedia.config.logVolumeWhenInstantGE&&emedia.config.logVolumeWhenInstantGE>0&&n.instant>=emedia.config.logVolumeWhenInstantGE&&n.instant<3*emedia.config.logVolumeWhenInstantGE&&No.info("Stream id "+t.id+", webrtc = "+(t._webrtc?t._webrtc.getRtcId():"null")+", media streamId = "+(t.getMediaStream()?t.getMediaStream().id:"null")+", instant >= "+emedia.config.logVolumeWhenInstantGE+", meter instant="+n.instant+", slow="+n.slow+", clip="+n.clip);var r=this;0===n.instant&&(n.instant=n.trackAudioLevel||n.trackTotalAudioEnergy||0),r.onSoundChanage(e,t,n),r._service._judgeTalking(n)&&r.onTalking(e,t,n)}},{key:"onAddMember",value:function(e){}},{key:"onRemoveMember",value:function(e,t){}},{key:"onAddStream",value:function(e){}},{key:"onRemoveStream",value:function(e){}},{key:"onUpdateStream",value:function(e,t){}},{key:"onRecvRemoteMessage",value:function(e,t){}},{key:"onSoundChanage",value:function(e,t,n){}},{key:"onTalking",value:function(e,t,n){}}]),i}(Fo);const Uo=Wo;var Bo=n(5682);function Go(e,t,n,r,i,o,s){try{var a=e[o](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Bo.resolve(c).then(r,i)}function qo(e){return function(){var t=this,n=arguments;return new Bo((function(r,i){var o=e.apply(t,n);function s(e){Go(o,r,i,s,a,"next",e)}function a(e){Go(o,r,i,s,a,"throw",e)}s(void 0)}))}}var zo=n(490),Ho=n.n(zo);at("electron");var Jo=at("Service"),$o=function(){function e(t){for(var n in s(this,e),d(this,"AVPubstream",Ki.extend({__init__:function(){var e=this;e.type=0,e._located=!0,e.mutedMuted=!0,e.constaints&&(e.constaints.video||(e.voff=1),e.constaints.audio||(e.aoff=1)),e.constaints||(e.constaints={audio:!0,video:!0}),emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)}})),d(this,"AudioMixerPubstream",new Ki.extend({__init__:function(){var e=this;if(e.type=2,e._located=!0,e.mutedMuted=!0,e.constaints||(e.constaints={audio:!0,video:!1}),e.constaints){var t=!!e.constaints.audio;e.constaints.video||(e.constaints.video=!1),e.constaints.video||(e.voff=1),e.constaints.audio||(e.aoff=1),!1===t&&(e.aoff=1)}emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)},onGotRemoteMediaStream:function(e){var t=this;if(!t.remotePlayAudioObject){var n="__o_remote_play_audio_"+t.id,r=document.querySelector("#"+n);r||((r=document.createElement("audio")).style.display="none",r.id="__o_remote_play_audio_"+t.id,r.autoplay=!0,r.playsinline=!0,document.body.appendChild(r)),t.remotePlayAudioObject=r}t.remotePlayAudioObject.srcObject=e}})),d(this,"ShareDesktopPubstream",Ki.extend({voff:0,__init__:function(){var e=this;e.type=1,e._located=!0,e.mutedMuted=!0,e.constaints={audio:!this.aoff,video:!0},emedia.config.maxVideoBitrate&&(e.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(e.abitrate=emedia.config.maxAudioBitrate)}})),t)this[n]=t[n];var r=this;Jo.warn("emedia version: ",window._emediaVersion||"unkown"),Jo.warn("UserAgent: ",navigator.userAgent);var i,o,a=(i=new RegExp("(^|&)__log_level___=([^&]*)(&|$)","i"),null!=(o=window.location.search.substr(1).match(i))?unescape(o[2]):null);a&&(emedia.LOG_LEVEL=g()(a)),r.namespace=function(){for(var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),r=0,i=0;i<36;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,n[i]=t[19==i?3&e|8:e]);return n.join("")}(),emedia.useCurrentXService=r,void 0===r.useRTCCfg&&(r.useRTCCfg=emedia.config.useRTCCfgIfServerReturn),"string"==typeof r.useRTCCfg&&(r.useRTCCfg=JSON.parse(r.useRTCCfg)),r.inboundAudio=tn.inboundAudio.bind(r),r.inboundVideo=tn.inboundVideo.bind(r),r.outboundAudio=tn.outboundAudio.bind(r),r.outboundVideo=tn.outboundVideo.bind(r)}return u(e,[{key:"__assertCurrent",value:function(){if(!this.current)throw Jo.error("Please call emedia.service.setup(ticket)"),"Please call emedia.service.setup(ticket)";if(this.current.closed)throw Jo.error("current closed"),"current closed"}},{key:"hasAudioMixers",value:function(){var e=this;for(var t in e.__assertCurrent(),e.current.audioMixers){var n=e.current.audioMixers[t];if(n&&n.located())return!0}}},{key:"getMediaDevices",value:function(e,t,n){"function"==typeof e&&(n=t,t=e,e=void 0),navigator.mediaDevices.enumerateDevices().then((function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];e?e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||Jo.info("Some other kind of source/device: ",o):r.push(o)}t&&t(r)})).catch((function(e){Jo.warn("navigator.getUserMedia error: ",e),n&&n(e)}))}},{key:"_stopTracks",value:function(e){emedia.stopTracks(e),e&&Jo.warn("Stream tracks stop. it = ",e)}},{key:"_enableVideoTracks",value:function(e,t){emedia.enableVideoTracks(e,t)}},{key:"_enableAudioTracks",value:function(e,t){emedia.enableAudioTracks(e,t)}},{key:"openUserMedia",value:function(e){Jo.debug("begin open user media",e);var t=this;if(!e)throw Jo.error("require pubS"),"require pubS";return{then:function(n,r){function i(){n.apply(null,arguments);var r=e.localStream;r&&(r.oninactive=t._onStreamInactive.bind(t,e,r),r.onactive=t._onStreamActive.bind(t,e,r))}if(e instanceof t.AVPubstream)t._openCamera(e,i,r);else if(e instanceof t.ShareDesktopPubstream)t._openSharedDesktop(e,i,r);else{if(!(e instanceof t.AudioMixerPubstream))throw Jo.error("Unspported pubS"),"Unspported pubS";t._openCamera(e,i,r)}}}}},{key:"_openSharedDesktop",value:function(e,t,n){var r,i,o,s=this;function a(e){var r={audio:!0};e.constaints&&("object"===v(e.constaints.audio)&&e.constaints.audio||e.constaints.audio||(r.audio=!1)),s.__getUserMedia(r,(function(n,r){var i=new MediaStream;i._located=!0,r&&r.getAudioTracks().forEach((function(e){i.addTrack(e)})),e.localStream&&e.localStream.getVideoTracks().forEach((function(e){i.addTrack(e)})),e.localStream=i,t&&t(s.current,i)}),n)}if(e._localMediaStream&&(r=e._localMediaStream.getVideoTracks())&&r.length>0)return e.localStream=e._localMediaStream,void(e.constaints.audio?a(e):t&&t(s.current,stream));i=null==e?void 0:e.screenOptions,o=function(r){var i=null!=r&&r.electronShareId?{video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r.electronShareId}},audio:!1}:{share:!0,video:!0,audio:!1};s.__getUserMedia(i,(function(n,r){e.localStream=r,e.constaints.audio?a(e):t&&t(s.current,r)}),(function(e){n(e)}))},navigator.userAgent.indexOf("Electron")>-1?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["screen","window"],t=arguments.length>1?arguments[1]:void 0;window.require("electron").desktopCapturer.getSources({types:e}).then(function(){var e=qo(Ho().mark((function e(n,r){return Ho().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r){e.next=3;break}return t(new Wi.OpenDesktopMediaAccessDenied({error:r})),e.abrupt("return");case 3:if("function"==typeof emedia.chooseElectronDesktopMedia){e.next=6;break}return t(new Wi.OpenDesktopMedia({desktopStreamId:n[0].id})),e.abrupt("return");case 6:n.map((function(e){return e.dataURLImg=e.thumbnail.toDataURL()})),emedia.chooseElectronDesktopMedia(n,(function(e){var n=e.id;new Wi.OpenDesktopMedia({desktopStreamId:n}),t({electronShareId:n})}),(function(){t(new Wi.OpenDesktopMediaAccessDenied({message:"User denied access"}))}));case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()).catch((function(e){"function"!=typeof emedia.chooseElectronDesktopMedia&&t(new Wi.OpenDesktopMedia({desktopStreamId:sources[0].id}))}))}(i,o):o()}},{key:"_openCamera",value:function(e,t,n){var r=this,i=e.constaints||{audio:!0,video:!0};r.__getUserMedia(i,function(n,i){r.__controlStream(e,i),e.localStream=i,t&&t(r.current,i)}.bind(i),n)}},{key:"__controlStream",value:function(e,t){emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)}},{key:"__getUserMedia",value:function(e,t,n){Jo.debug("get user media. using constaints",e);var r,i=this;function o(e){Jo.debug("[WebRTC-API] getUserMedia() error: ",e),emedia.stopTracks(r),i.current&&i.current.onEvent(new Wi.OpenMediaError({member:i.current,event:e})),n&&n(new Wi.OpenMediaError({member:i.current,event:e}))}e=ft.extend({},e),i.__sysGetUserMedia(e,(function(n){i.current&&!i.current.closed&&(i.current._openedRtcMediaStreams[n.id]=n,n._bindAttendee=i.current,n._bindAttendeeId=i.current.getMemberId(),Jo.info("stream bind attendee.",n.id,i.current.ticket&&i.current.ticket.id,i.current.getMemberId(),i.current.memName)),emedia._yetGetUserMedia=!0,r=n;var s=n.getVideoTracks(),a=n.getAudioTracks();if(s.length>0){var c=s[0];Jo.debug(n.id,"using video device: ",c.id,c.label,c.kind,c.enabled)}if(a.length>0){var u=a[0];Jo.debug(n.id,"using audio device: ",u.id,u.label,u.kind,u.enabled)}if(n._located=!0,"boolean"==typeof n.active&&!n.active)return Jo.error("media stream not active. it is",n.id),void o({constraint:e,name:"NotAllowedStreamNonactive",message:"stream non-active"});t&&t(i.current,n)}),o)}},{key:"_onStreamInactive",value:function(e,t,n){var r=this;Jo.warn("media stream inactive. it =",t.id),e.onMediaInactive&&r.current&&mt(r.current._cacheStreams,(function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&(o._webrtc&&o._webrtc.closed||e.onMediaInactive.call(o,t,n,r))}))}},{key:"_onStreamActive",value:function(e,t,n){var r=this;Jo.warn("media stream active. it =",t.id),e.onMediaActive&&r.current&&mt(r.current._cacheStreams,(function(i,o){o.located()&&o.localStream&&o.localStream.id===t.id&&e.onMediaActive.call(o,t,n,r)}))}},{key:"__sysGetUserMedia",value:function(e,t,n){function r(e,t,n){"object"===v(emedia.config.globalConstraints)&&("object"===v(emedia.config.globalConstraints.audio)&&e.audio&&("boolean"==typeof e.audio?e.audio=ft.extend({},emedia.config.globalConstraints.audio):e.audio=ft.extend({},emedia.config.globalConstraints.audio,e.audio)),"object"===v(emedia.config.globalConstraints.video)&&e.video&&("boolean"==typeof e.video?e.video=ft.extend({},emedia.config.globalConstraints.video):e.video=ft.extend({},emedia.config.globalConstraints.video,e.video))),Jo.info("navigator.mediaDevices.getUserMedia constaints = ",je()(e)),e.share?navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1}).then(t).catch(n):navigator.mediaDevices.getUserMedia(e).then(t).catch(n)}if(Me){if((e=Fn({},e)).audio){var i={audio:e.audio};r(i,a.bind(i),c)}if(e.video){var o={video:e.video};r(o,a.bind(o),c)}e.video||e.audio||c("Failed to execute 'getUserMedia' on 'MediaDevices': At least one of audio and video must be requested")}else r(e,t,n);function s(){var n=new MediaStream;e.audioStream&&e.audioStream.getAudioTracks().forEach((function(e){n.addTrack(e)})),e.videoStream&&e.videoStream.getVideoTracks().forEach((function(e){n.addTrack(e)})),t&&t(n)}function a(t){e.failed?emedia.stopTracks(t):(this.audio&&(e.audioStream=t,!e.video)||this.video&&(e.videoStream=t,!e.audio)||e.audioStream&&e.videoStream)&&s()}function c(t){e.failed||(e.failed=!0,n(t))}}},{key:"setup",value:function(e,t){var n=this;Jo.count(),Jo.debug("recv ticket",e,t),Jo.debug("use sdk version",window._emediaVersion),Jo.debug(navigator.userAgent);var r,i,o=t=t||{};if(nt(t))t=je()(t);else try{o=JSON.parse(t)}catch(e){}if("string"==typeof e&&(e=JSON.parse(e)),r=i=e.memName,emedia._lastSetupConfr=e.confrId,emedia._lastSetupMemName=i,emedia._lastSetupDate=new Date,emedia._lastSetupTktId=e.tktId,n.current&&!n.current.closed){var s=new Wi.CurrentCalling;throw n.current.onEvent(s),Jo.error("confr not close. calling..."),s}return n.current=new Uo({_service:n,service:n,autoSub:emedia.config.autoSub,getCopyIntervalMillis:emedia.config.getCopyIntervalMillis,sysUserId:r,memName:i,resource:n.resource,nickName:n.nickName,ticket:e,ext:t,extObj:o,sessionFactory:function(t){return n.newSession(t,e)},listeners:n.listeners||{}})}},{key:"getStreamById",value:function(e){var t=this.current&&this.current._cacheStreams[e];return t&&ft.extend(!1,{},t)}},{key:"getStreamsByRtcId",value:function(e){if(this.current&&this.current._cacheStreams){var t=[];return mt(this.current._cacheStreams,(function(n,r){r.rtcId===e&&t.push(r)})),t}}},{key:"getMemberById",value:function(e){var t=this.current&&this.current._cacheMembers[e];return t&&ft.extend(!1,{},t)}},{key:"exit",value:function(e){Jo.warn("User click exit ",e),this.current&&this.current.exit(e)}},{key:"join",value:function(e,t){Jo.debug("begin join ...");var n=this;if(n.__assertCurrent(),n.current._memberId)return Jo.warn("Had joined. igrone it"),void(e&&e(n.memId));n.current._session._sessionId=void 0,n.current.join(e,t)}},{key:"withpublish",value:function(e){var t=this;if(!e||!e.localStream)throw Jo.error("pubS null or stream not open"),"pubS null or stream not open";return t.__assertCurrent(),t.current._memberId?Jo.warn("Had joined. igrone it"):t.current._session._sessionId=void 0,t.current.withpublish(e)}},{key:"push",value:function(e,t,n){Jo.debug("begin push ...");var r=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw Jo.error("pubS or stream open"),"pubS or stream open";r.__assertCurrent(),r.current.push(e,t,n,!1)}},{key:"subscribe",value:function(e,t,n,r){var i=this;if(Jo.info("begin subscribe ",e,r),t&&nt(t)&&(r=t,t=n=void 0),n&&nt(n)&&(r=n,n=t,t=void 0),Me){var o=function(){try{var e=u.shift();e&&e.onSub&&e.onSub.apply(e,arguments)}finally{a()}},s=function(){try{var e=u.shift();e&&e.subfail&&e.subfail.apply(e,arguments)}finally{a()}},a=function(){u.length>0&&i.__subscribe(u[0].streamId,o,s,u[0].subArgs)},c={streamId:e,onSub:t,subfail:n,subArgs:r},u=i.__safari_subs||(i.__safari_subs=[]);u.push(c),1===u.length&&a()}else i.__subscribe(e,t,n,r)}},{key:"__subscribe",value:function(e,t,n,r){var i=this;i.__assertCurrent(),2==arguments.length&&(n=t,t=void 0),t&&nt(t)&&(r=t,t=void 0),n&&nt(n)&&(r=n,n=void 0),r||(r={subSVideo:!0,subSAudio:!0});var o=i.current._getWebrtc(e),s=o&&o.isConnected(),a=s&&o.getRemoteStream();if(a&&(s=a.active)){var c=a.getAudioTracks().length,u=a.getVideoTracks().length;(c||!0!==r.subSAudio)&&(u||!0!==r.subSVideo)||(s=!1)}if(Jo.info("sub stream",e,", use prertcpeer =",s),s)return i.current.subscribeStream(o._rtcId,e,n,r,t),void(t&&t());o&&!o.closed&&i.current.closeWebrtc(o.getRtcId(),!0,!1),i.current.createWebrtcAndSubscribeStream(e,{onGotRemote:function(e){t&&t(e)},onEvent:function(e){n&&n(e)}},void 0,r)}},{key:"closePubstream",value:function(e){emedia.stopTracks(e)}},{key:"hungup",value:function(e){var t=this.getStreamById(e);try{this._hungup(e)}finally{this.onHungup&&t&&this.onHungup(t)}}},{key:"_hungup",value:function(e){var t=this;t.__assertCurrent();var n=t.current,r=n._cacheStreams[e];r&&!r.closeReason&&r.updateAttributes({closeReason:"UserHangup"});var i=r&&r.rtcId;if(i&&(n.closeWebrtc(i),r.located()&&(1!==r.type&&r._localMediaStream&&emedia.stopTracks(r._localMediaStream),r.remotePlayAudioObject&&document.body.removeChild(r.remotePlayAudioObject),n._cacheStreams[e]&&n.onRemoveStream(r),ht(n._cacheStreams,e),t._streamAutomators&&ht(t._streamAutomators,e))),r&&!r.located()){if(n._linkedStreams[r.id]&&ht(n._linkedStreams,r.id),Jo.warn("Hangeup remove from _linkedStreams. stream = ",r.id),!(r=n._cacheStreams[e]))return;r.updateAttributes({rtcId:void 0,_webrtc:void 0,mediaStream:void 0});var o=new Ki(r);n.onUpdateStream(o,new o.Update(o))}}},{key:"postMessage",value:function(e,t,n,r){var i=t;"string"!=typeof t&&(t=je()(t)),this.__assertCurrent();var o,s=this.current,a=s._linkedStreams[e];o=a&&a.owner?a.owner.id:e,t=s.newMessage({op:1003,memId:o,arg:t}),s.postMessage(t,(n||r)&&function(e){if(r&&r(e,i),0!=e.result){var a=new Wi.RemoteControlFail({memId:o,failed:e.result,cause:e.msg,type:"postMessage",postMessage:t});return s.onEvent(a),void(n&&n(a,i))}})}},{key:"torchRemote",value:function(e,t,n,r){"function"==typeof t&&(r=n,n=t,t=void 0),void 0!==t&&(t=t?1:0),this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw Jo.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var s=o.torch,a={op2:20,streamId:e,tor:t=void 0===t?o.torch?0:1:t},c=i.newMessage({op:1002,memId:o.owner.id,arg:je()(a),_reqOps:[100206]});o.updateAttributes({torch:t}),i.postMessage(c,(function(e){if(0!=e.result){var t=new Wi.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"torch_control"});return i.onEvent(t),o.updateAttributes({torch:s}),void(r&&r(t,o.torch))}n&&n(o.torch)}))}},{key:"freezeFrameRemote",value:function(e,t,n){this.__assertCurrent();var r=this.current,i=r._linkedStreams[e];if(!i||i.located())throw Jo.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var o=!i.freezeFrame,s={op2:20,streamId:e,frz:o?1:0},a=r.newMessage({op:1002,memId:i.owner.id,arg:je()(s),_reqOps:[100204]});i.updateAttributes({freezeFrame:o}),r.postMessage(a,(function(e){if(0!=e.result){var o=new Wi.RemoteControlFail({stream:i,failed:e.result,cause:e.msg,type:"freeze_control"});return r.onEvent(o),i.updateAttributes({freezeFrame:!i.freezeFrame}),void(n&&n(o,i.freezeFrame))}t&&t(i.freezeFrame)}))}},{key:"base64Img2Blob",value:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],r=window.atob(t[1]),i=r.length,o=new Uint8Array(i),s=0;s<i;++s)o[s]=r.charCodeAt(s);return new Blob([o],{type:n})}},{key:"blob2URL",value:function(e){return URL.createObjectURL(e)}},{key:"imagesPngContext2URL",value:function(e){return this.blob2URL(this.blob2URL(e))}},{key:"downloadFile",value:function(e,t,n){var r=document.createElement("a");r.style.display="none";var i,o=t?this.base64Img2Blob(t):n;r.download=e,r.href=i=this.blob2URL(o),r.rel="noopener";var s=document.createEvent("HTMLEvents");s.initEvent("click",!1,!1),r.dispatchEvent(s),document.body.appendChild(r),r.click(),r.parentNode.removeChild(r),setTimeout((function(){URL.revokeObjectURL&&URL.revokeObjectURL(i)}),4e4)}},{key:"videoCaptureBase64Context2URL",value:function(e){return this.imagesPngContext2URL(this.getCaptureBase64Context(e))}},{key:"getCaptureBase64Context",value:function(e){var t=document.createElement("canvas");return t.id="__capture_video_"+(new Date).getTime(),t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("images/png")}},{key:"captureVideo",value:function(e,t,n){var r=this.getCaptureBase64Context(e);return t&&(n=n||"capture_"+(new Date).getTime(),this.downloadFile(n,r)),r}},{key:"capturePictureRemote",value:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw Jo.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var s={op2:20,streamId:e,pic:1,rspBase64Pic:!0===t},a=i.newMessage({op:1002,memId:o.owner.id,arg:je()(s),_reqOps:[100205]});i.postMessage(a,(function(e){if(0!=e.result){var s=new Wi.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"capture_control"});return i.onEvent(s),void(r&&r(s))}if(t)if(e.arg){var a=JSON.parse(e.arg);n&&n(a.pic)}else r&&r(new Wi.RemoteControlFail({stream:o,failed:e.result,cause:"Not found base64 pic"}));else n&&n()}))}},{key:"zoomRemote",value:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw Jo.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";o._zoom||o.updateAttributes({_zoom:1});var s=o._zoom*t;if(!(s<1)){o.updateAttributes({_zoom:s});var a={op2:20,streamId:e,zoom:Math.round(1e4*s)},c=i.newMessage({op:1002,memId:o.owner.id,arg:je()(a),_reqOps:[100201]});i.postMessage(c,(function(e){if(0!=e.result){var t=new Wi.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"zoom_control"});return i.onEvent(t),void(n&&n(t))}r&&r()}))}}},{key:"_getPosition",value:function(e){for(var t=0,n=0;e;)n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent;return{clientX:n,clientY:t}}},{key:"eventXYAtMedia",value:function(e,t){var n=Pe(t),r=n.width,i=n.height,o=t.videoWidth,s=t.videoHeight;if(s/o>i/r){var a=o/s;o=(s=i)*a}else a=s/o,s=(o=r)*a;var c,u,d=e;if((c=pt(d.x))&&(d.x=d.x*r),(u=pt(d.y))&&(d.y=d.y*i),!(Math.abs(d.x)<(r-o)/2||r-Math.abs(d.x)<(r-o)/2||Math.abs(d.y)<(i-s)/2||i-Math.abs(d.y)<(i-s)/2))return d.x=d.x<0?Math.floor(d.x+(r-o)/2):Math.floor(d.x-(r-o)/2),d.y=d.y<0?Math.floor(d.y+(i-s)/2):Math.floor(d.y-(i-s)/2),c&&(d.x=d.x/o),u&&(d.y=d.y/s),{x:d.x,y:d.y,width:o,height:s}}},{key:"eventXYAtVideo",value:function(e,t){var n,r,i=Pe(t),o=i.width,s=i.height,a=t.videoWidth,c=t.videoHeight;if(c/a>s/o){var u=a/c;a=(c=s)*u}else u=c/a,c=(a=o)*u;return(n=pt(e.x))&&(e.x=e.x*a),(r=pt(e.y))&&(e.y=e.y*c),e.x=e.x<0?Math.floor(e.x-(o-a)/2):Math.floor(e.x+(o-a)/2),e.y=e.y<0?Math.floor(e.y-(s-c)/2):Math.floor(e.y+(s-c)/2),n&&(e.x=e.x/o),r&&(e.y=e.y/s),e}},{key:"getClickXY",value:function(e,t){var n=t||window.event,r=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,o=n.pageX||n.clientX+r,s=n.pageY||n.clientY+i,a=this._getPosition(e);Jo.info("Video tag position ",a.clientX,":",a.clientY);var c=e.videoWidth,u=e.videoHeight;if(u/c>e.offsetHeight/e.offsetWidth){var d=c/u;c=(u=e.offsetHeight)*d,a.clientX+=(e.offsetWidth-c)/2}else d=u/c,u=(c=e.offsetWidth)*d,a.clientY+=(e.offsetHeight-u)/2;return Jo.info("Media position ",a.clientX,":",a.clientY),Jo.info("Media xy ",c,":",u),Jo.info("Click position ",o,":",s),{mediaWidth:c,mediaHeight:u,x:o-a.clientX,y:s-a.clientY}}},{key:"focusExpoRemote",value:function(e,t,n,r,i){var o=n||window.event,s=document.documentElement.scrollLeft||document.body.scrollLeft,a=document.documentElement.scrollTop||document.body.scrollTop,c=o.pageX||o.clientX+s,u=o.pageY||o.clientY+a,d=this._getPosition(t);Jo.info("Video tag position ",d.clientX,":",d.clientY);var l=t.videoWidth,f=t.videoHeight;if(f/l>t.offsetHeight/t.offsetWidth){var p=l/f;l=(f=t.offsetHeight)*p,d.clientX+=(t.offsetWidth-l)/2}else p=f/l,f=(l=t.offsetWidth)*p,d.clientY+=(t.offsetHeight-f)/2;Jo.info("Media position ",d.clientX,":",d.clientY),Jo.info("Media xy ",l,":",f),Jo.info("Click position ",c,":",u),this._focusExpo(e,l,f,c-d.clientX,u-d.clientY,r,i)}},{key:"_focusExpo",value:function(e,t,n,r,i,o,s){if(!(r<=0||r>t||i<=0||i>n)){this.__assertCurrent();var a=this.current,c=a._linkedStreams[e];if(!c||c.located())throw Jo.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var u={op2:20,streamId:e,focus:1,expo:1,x:0===t?0:Math.round(1e4*r/t),y:0===n?0:Math.round(1e4*i/n)},d=a.newMessage({op:1002,memId:c.owner.id,arg:je()(u),_reqOps:[100202,100203]});a.postMessage(d,(function(e){if(0!=e.result){var t=new Wi.RemoteControlFail({stream:c,failed:e.result,cause:e.msg,type:"focus_expo_control"});return a.onEvent(t),void(o&&o(t))}s&&s()}))}}},{key:"_republish",value:function(e,t,n){Jo.info("Republish stream. it = ",e.id);var r,i,o=this;if(e.id){var s=o.current.__getWebrtcFor(e.id);s&&o.current.closeWebrtc(s,!0),r=o.current._getWebrtc(e.id)}switch(e.type){case 0:emedia.stopTracks(e._localMediaStream),i=new o.AVPubstream(e);break;case 1:emedia.stopAndRemoveAudioTracks(e._localMediaStream),i=new o.ShareDesktopPubstream(e);break;case 2:emedia.stopTracks(e._localMediaStream),i=new o.AudioMixerPubstream(e)}setTimeout((function(){o.openUserMedia(i).then((function(){e.localStream=i.localStream,e.isRepublished=!0,e.optimalVideoCodecs=e.optimalVideoCodecs||r&&r.optimalVideoCodecs,o.push(e,t,n)}),n)}),100)}},{key:"switchMobileCamera",value:function(e,t,n){var r=this;if("string"==typeof e?e=r.current._cacheStreams[e]:e.id&&(e=r.current._cacheStreams[e.id]),e.voff)Jo.warn("Stream id = ",e.id," voff, do not chanage camera.");else{e.constaints||(e.constaints={});var i=ft.extend({},e.constaints);e._lastConstaints=i,e.constaints.video="object"===v(e.constaints.video)?e.constaints.video:{},"user"!==e.constaints.video.facingMode&&e.constaints.video.facingMode?e.constaints.video.facingMode="user":e.constaints.video.facingMode={exact:"environment"},r._republish(e,(function(e){n&&n(e)}),(function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=i),t&&t(n)}))}}},{key:"changeCamera",value:function(e,t,n){var r=this;"string"==typeof e?e=r.current._cacheStreams[e]:e.id&&(e=r.current._cacheStreams[e.id]),e.voff?Jo.warn("Stream id = ",e.id," voff, do not chanage camera."):r.getMediaDevices("videoinput",(function(i){if(i.length<=1)Jo.warn("Only video input. not chanage");else{var o=e._cameraIndex;if(null===e._cameraIndex||void 0===e._cameraIndex){var s=e.getLocalMediaStream(),a=(l=s&&s.getVideoTracks())&&l.length&&l[0];if(a&&a.getCapabilities&&"function"==typeof a.getCapabilities){var c=a.getCapabilities(),u=c&&c.deviceId;for(var d in i)if((p=i[d]).deviceId===u||p.label==a.label){o=g()(d);break}}else for(var d in i)if((p=i[d]).label==a.label){o=g()(d);break}}for(;o<i.length;){var l,f=i[o],p=i[o=(o+1)%i.length];if(!(l=e.getLocalMediaStream().getVideoTracks())||0===l.length||p.label!=l[0].label)break}var h=(p=i[o]).label;Jo.warn("Stream ",e.id,f.label,">>",h),e._cameraIndex=o,e.constaints||(e.constaints={});var m=ft.extend({},e.constaints);e._lastConstaints=m,e.constaints.video="object"===v(e.constaints.video)?e.constaints.video:{},e.constaints.video.deviceId={exact:p.deviceId},r._republish(e,(function(e){n&&n(e)}),(function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints=m),t&&t(n)}))}}),t)}},{key:"chanageConstraints",value:function(e,t,n,r){var i=this;if("string"==typeof e?e=i.current._cacheStreams[e]:e.id&&(e=i.current._cacheStreams[e.id]),e){if(Jo.info("chanage pubstream constraints. it",e.id,t),isObject(t)&&!qr(e.constaints,t)){var o=e.constaints||{},s=e.voff,a=e.aoff;return e._lastConstaints=o,e.constaints=ft.extend(!0,{},o,t),e.aoff=e.constaints.audio?0:1,e.voff=e.constaints.video?0:1,void i._republish(e,(function(e){c(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints=o,e.aoff=a,e.voff=s),n&&n(t)}))}c(),r&&r(e.getMediaStream())}else Jo.warn("Not found pubS");function c(){var t=e.getMediaStream();emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)}}},{key:"voff",value:function(e,t,n,r){var i=this;"string"==typeof e&&(e=i.current._cacheStreams[e]);var o=e.voff;function s(){t!=o?(emedia.enableVideoTracks(e.getMediaStream(),!t),i.current&&i.current.voff(e,t)):Jo.info("pubstream voff not chanage.")}if(t=t?1:0,e.voff=t,!t&&e.constaints&&!e.constaints.video){var a=e.constaints.video;return e.constaints.video=!0,void i._republish(e,(function(e){s(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.video=a,e.voff=o),n&&n(t)}))}s(),r&&r(e.getMediaStream())}},{key:"aoff",value:function(e,t,n,r){var i=this;"string"==typeof e&&(e=i.current._cacheStreams[e]);var o=e.aoff;function s(){t!=o?(emedia.enableAudioTracks(e.getMediaStream(),!t),i.current&&i.current.aoff(e,t)):Jo.info("pubstream aoff not chanage.")}if(t=t?1:0,e.aoff=t,!t&&e.constaints&&!e.constaints.audio){var a=e.constaints.audio;return e.constaints.audio=!0,void i._republish(e,(function(e){s(),r&&r(e)}),(function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.audio=a,e.aoff=o),n&&n(t)}))}s(),r&&r(e.getMediaStream())}},{key:"iceing",value:function(e){return nt(this.current._linkedStreams[e])}},{key:"recording",value:function(e){return nt(this.current._records[e])}},{key:"startRecord",value:function(e,t){var n=this.current._linkedStreams[e];if(!n)throw Jo.error("not at linked streams",e),e+" not at linked streams";n._webrtc||t&&t(!1),this.current.startRecord(n,t)}},{key:"stopRecord",value:function(e,t){var n=this.current._records[e];if(!n)throw Jo.error("not at recording streams",e),e+" not at recording streams";this.current.stopRecord(n,t)}},{key:"getCurrentMembers",value:function(){return this.current.getCurrentMembers()}},{key:"_onCapturePicture",value:function(e){var t,n=this,r=e.arg.rspBase64Pic,i=e.arg.streamId,o=n.current._cacheStreams[i];if(r){var s;if("function"!=typeof n.getHTMLVideo||!(s=n.getHTMLVideo(i)))return void Jo.warn("Not support capture picture. caused by htmlVideo not found");t=n.getCaptureBase64Context(s)}else{if("function"!=typeof n.onCapturePicture)return void Jo.warn("Not support capture picture. caused by onCapturePicture not found");n.onCapturePicture(o)}var a=n.current.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,arg:je()(t?{pic:t}:{}),result:0});return n.current.postMessage(a,(function(e){Jo.warn("Send remote control onCapturePicture response. the result = ",e.result,e.msg||"")})),!0}},{key:"newSession",value:function(e,t){var n=this;return new(n.Session||zi)({ticket:t,owner:e,onTcklC:function(t){e.onTcklC(t.rtcId,t.cands)},onAcptC:function(t){e.onAcptC(t.rtcId,t.sdp,t.cands)},onAnsC:function(t){e.onAnsC(t.rtcId,t.sdp,t.cands)},onTermC:function(t){Jo.info("Server termc rtc: ",t.rtcId,t.message||t.msg),21===t.endReason||22===t.endReason?mt(e._cacheStreams,(function(n,r){var i;r.rtcId===t.rtcId&&(i=21===t.endReason?new emedia.event.SwitchVCodes({stream:r,useVCodes:t.useVCodes}):new emedia.event.SubFailNotSupportVCodes({stream:r}),e.onEvent(i))})):e.closeWebrtc(t.rtcId,!1,!0)},onEnter:function(t){e.onEnter(t.cver,t.mem)},onExit:function(t){e.onExit(t.cver,t.memId,t.reason||0)},onPub:function(t){e.onPub(t.cver,t.memId,t.pubS)},onUnpub:function(t){e.onUnpub(t.cver,t.memId,t.pubSId)},onMems:function(e){},onClose:function(t){e.onClose(t.cver,t.confrId)},onEvent:function(t){e.onEvent(t)},onStreamControl:function(t){e.onStreamControl(t.cver,t.streamId,t.voff,t.aoff,t.sver)},onRoleUpdate:function(t){e._onRoleUpdate(t.role,t.roleToken)},onRemoteControl:function(t){if("string"==typeof t.arg&&(t.arg=JSON.parse(t.arg)),20!==t.arg.op2||!t.arg.pic||!n._onCapturePicture.call(n,t)){if(30===t.arg.op2&&n._onRemotePannelControl)try{return void n._onRemotePannelControl.call(n,t)}catch(e){Jo.warn(e)}Jo.warn("Not support remote control");var r=e.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,arg:je()(t.arg),result:t&&t.arg&&30===t.arg.op2?-405:-507,msg:"Not support the remote control."});e.postMessage(r,(function(e){Jo.warn("Send remote control response. the result = ",e.result,e.msg||"")}))}},onRecvRemoteMessage:function(t){e._onRecvRemoteMessage&&e._onRecvRemoteMessage(t.memId,t.arg,t)}})}},{key:"_judgeTalking",value:function(e){return!!e&&e.instant>=emedia.config.judgeTalkingByInstantGE}},{key:"graffitiVideo",value:function(e,t,n){var r=this.getStreamById(e),i=new MediaStream;i._located=!0,r._localMediaStream.getAudioTracks().forEach((function(e){i.addTrack(e)})),n.captureStream(25).getVideoTracks().forEach((function(e){i.addTrack(e)})),t.srcObject=i,r.updateAttributes({localStream:i,isRepublished:!0,optimalVideoCodecs:r.optimalVideoCodecs}),this.push(r)}},{key:"resetCanvas",value:function(e){var t;if(arguments.length>1)for(var n=0;n<arguments.length;n++)"function"==typeof(t=arguments[n])&&t(e),"function"!=typeof t&&nt(t)&&mt(t,(function(t,n){Jo.debug("Canvas set ",t," = ",n),e.setAttribute(t,n)}))}},{key:"requestFrame",value:function(e,t){var n,r=this;if("string"==typeof e)n=this.current._cacheStreams[e];else{if(!e.id)return;n=this.current._cacheStreams[e.id]}function i(){n.requestFrame(),n.canvas&&redraw(3,3)}n&&(t?setTimeout((function(){i(),r.requestFrame(n,t)}),t):i())}},{key:"graffitiCanvas",value:function(e,t){Ae(e)&&(t=e,e=!1);var n=this,r=new n.ShareDesktopPubstream({voff:0,aoff:e?0:1});t||(t=document.createElement("canvas")),t.getContext("2d"),r.canvas=t;var i=function(){};return i.prototype.setCanvas=function(e){return this.canvasTag=t,n.resetCanvas(t,e),this},i.prototype.push=function(e,t){this._push(e,t)},i.prototype._push=function(i,o){"function"==typeof i&&(o=i,i=void 0),t.captureStream&&(t.captureStream.enabled=!0);var s=t.captureStream(i||25);function a(n){n.canvas=t,o&&o(n,t,s),e&&n.requestFrame()}function c(e,t){var r=new MediaStream;r._located=!0,e._localMediaStream&&e._localMediaStream.getAudioTracks().forEach((function(e){r.addTrack(e)})),s.getVideoTracks().forEach((function(e){r.addTrack(e)})),e._localMediaStream=r,e.localStream=r,n.push(e,t)}return e?n.__getUserMedia({audio:!0},(function(e,t){r._localMediaStream=t,c(r,a)})):c(r,a),this},new i}},{key:"blobRecorder",value:function(e,t,n,r){var i=this;Ae(e)&&(e=e.srcObject),t||(t={mimeType:"video/webm;codecs=vp9"}),MediaRecorder.isTypeSupported(t.mimeType)||(Jo.info(t.mimeType," is not Supported"),t={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(t.mimeType)||(Jo.info(t.mimeType," is not Supported"),t={mimeType:"video/webm"},MediaRecorder.isTypeSupported(t.mimeType)||(Jo.info(t.mimeType," is not Supported"),t={mimeType:""})));try{var o=new MediaRecorder(e,t)}catch(e){return void Jo.error("Exception while creating MediaRecorder: ",e)}var s=[];function a(){this.blobs=s}return o.onstop=r||function(e){Jo.info("Recorder stopped: ",e)},o.ondataavailable=n||function(e){e.data&&e.data.size>0&&s.push(e.data)},a.prototype.start=function(e){o.start(e)},a.prototype.stop=function(){o.stop()},a.prototype.playurl=function(e){var t=new Blob(this.blobs,e||{type:"video/webm"});return window.URL.createObjectURL(t)},a.prototype.download=function(e,t){var n=new Blob(this.blobs,t||{type:"video/webm"});i.downloadFile(e,void 0,n)},new a}}]),e}();const Yo=$o,Xo=function(){function e(t){s(this,e),d(this,"event",Wi);var n=t.config,r=function(e){var t,n,r=f()({},p,e),i={};for(var o in r)i[o]=r[o],"logLevel"===o&&(i.LOG_LEVEL=r[o]);return r.loglastConfrCount&&(t=new Array(r.loglastConfrCount),n=-1),{mergedConfig:i,_logContext:t,_logContextIndex:n}}(n),i=r.mergedConfig,o=r._logContext,a=r._logContextIndex;this.config=i,this._logContext=o,this._logContextIndex=a,this.stopAudioTracks=nn,this.stopAndRemoveAudioTracks=rn,this.stopTracks=on,this.enableVideoTracks=sn,this.enableAudioTracks=an,this.hasEnabledTracks=cn,this.fileReport=un,this.PCStats=tn,this.Service=Yo,this.helper={PCStats:tn,pcstats:tn.echo,intervalPcstats:tn.intervalEcho,inboundAudio:tn.inboundAudio,inboundVideo:tn.inboundVideo,outboundAudio:tn.outboundAudio,outboundVideo:tn.outboundVideo},this.LOG_LEVEL=n.LOG_LEVEL,window.emedia=this,ct.count(),this.bAPI()}return u(e,[{key:"bAPI",value:function(){if(this.config.getMediaMeterIntervalMillis){this.__audioContext=new Ee,this.__usingWebAudio=!0;try{"function"==typeof Ee||(this.__usingWebAudio=!1)}catch(e){this.__usingWebAudio=!1}this.__usingWebAudio||console.warn("'new AudioContext()' failed. can not know who talking."),this.__audioContext&&"suspended"===this.__audioContext.state&&console.warn("audioContext.state is suspended. can not know who talking. You can resume() this.__audioContext, but only in response to a tap.")}window.requestAnimationFrame&&this.config._useRequestAnimationFrame?this.requestAnimationFrame=function(e){window.requestAnimationFrame(e)}:this.requestAnimationFrame=function(e,t){return setTimeout(e,t||this.config.getMediaMeterIntervalMillis)},window.cancelAnimationFrame&&this.config._useRequestAnimationFrame?this.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)}:this.cancelAnimationFrame=function(e){clearTimeout(e)}}}]),e}()})(),r.default})()}));
//# sourceMappingURL=EmediaSDK.js.map